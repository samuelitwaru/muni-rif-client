import{Q as F,a as S}from"./QBreadcrumbs.9c06453f.js";import{Q}from"./QPage.23d4180f.js";import{Q as P}from"./QSeparator.68732f5d.js";import{_ as b,aR as f,o as d,j as m,i as u,t as _,F as p,k as w,u as $,e as v,w as c,h as R,f as h,g as y,l as g,v as M,Q as T,aS as x,r as k}from"./index.1080353d.js";import{Q as V,d as O}from"./QDate.97cabd6f.js";import{Q as Y}from"./QPopupProxy.7d04538f.js";import{C}from"./ClosePopup.bf9ca0a2.js";import{Q as E}from"./QInput.1bee1665.js";import"./use-dark.6b0451ed.js";import"./use-form.ed2be5bd.js";import"./format.2bc25e5f.js";import"./QDialog.27353340.js";import"./use-prevent-scroll.b4dcc30f.js";import"./scroll.fa986778.js";import"./use-timeout.cd2175e4.js";import"./focusout.364dbcfd.js";import"./focus-manager.b507780d.js";import"./use-transition.32cb9394.js";import"./QMenu.9bbdcf7b.js";import"./selection.c4975593.js";import"./use-key-composition.29ef2a66.js";import"./use-split-attrs.338740ca.js";import"./uid.42677368.js";const N={props:["selectedYear","selectedMonth","monthName","markedDates","selectedDates"],data(){const e=new Date().getFullYear();return new Date().getMonth(),{years:Array.from({length:21},(t,i)=>e-10+i),months:["January","February","March","April","May","June","July","August","September","October","November","December"],weekDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],calendar:[],formData:{},selectedDate:{}}},created(){for(const[e,t]of Object.entries(this.selectedDates))this.formData[e]=f(t);console.log("this.formsData: ",this.formData)},methods:{setSelectedDateValue(e){console.log(this.formData);let t={};for(const[i,l]of Object.entries(this.formData))t[i]=new Date(l);console.log("data: ",t),this.$emit("update:selectedDates",{...t})},updateCalendar(){const e=this.selectedYear,t=this.selectedMonth,i=new Date(e,t,1),l=new Date(e,t+1,0);let o=[],a=[];const r=i.getDay();if(r!==0){const s=new Date(e,t,0);for(let D=r-1;D>=0;D--)a.push({date:new Date(s.getFullYear(),s.getMonth(),s.getDate()-D),otherMonth:!0})}for(let s=1;s<=l.getDate();s++)a.length===7&&(o.push(a),a=[]),a.push({date:new Date(e,t,s),otherMonth:!1});const n=7-a.length;for(let s=1;s<=n;s++)a.push({date:new Date(e,t+1,s),otherMonth:!0});o.push(a),this.calendar=o},isMarked(e){return this.markedDates.some(t=>t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate())},isSelected(e){let t="";return{result:Object.entries(this.selectedDates).some(l=>(t=l[0],l[1].getFullYear()===e.getFullYear()&&l[1].getMonth()===e.getMonth()&&l[1].getDate()===e.getDate())),label:t}},setDateValue(){const{key:e,date:t}=this.selectedDate;console.log("setDateValue: ",this.selectedDate),f(t),this.$emit("update:selectDates",{...this.selectedDate})}},mounted(){this.updateCalendar()}},U={class:"month-year-picker"},j={class:"calendar"},q={colspan:"7"},B={class:"row items-center justify-end q-gutter-sm"},I={key:1},G={key:2,class:"badge"},L={key:0};function A(e,t,i,l,o,a){return d(),m("div",U,[u("table",j,[u("tbody",null,[u("tr",null,[u("th",q,_(i.monthName)+" "+_(i.selectedYear),1)]),u("tr",null,[(d(!0),m(p,null,w(o.weekDays,r=>(d(),m("th",{key:r},_(r),1))),128))]),(d(!0),m(p,null,w(o.calendar,r=>(d(),m("tr",{key:r[0]},[(d(!0),m(p,null,w(r,n=>(d(),m("td",{key:n.date,class:$({"other-month":n.otherMonth,marked:a.isSelected(n.date).result&&!n.otherMonth})},[a.isSelected(n.date).result&&!n.otherMonth?(d(),v(g,{key:0,round:"",color:"primary"},{default:c(()=>[R(_(n.date.getDate())+" ",1),h(Y,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:c(()=>[h(V,{modelValue:o.formData[`${a.isSelected(n.date).label}`],"onUpdate:modelValue":[s=>o.formData[`${a.isSelected(n.date).label}`]=s,s=>a.setSelectedDateValue(`${a.isSelected(n.date).label}`)]},{default:c(()=>[u("div",B,[y(h(g,{label:"Cancel",color:"primary",flat:""},null,512),[[C]]),y(h(g,{label:"OK",color:"primary",flat:""},null,512),[[C]])])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)):(d(),m("div",I,_(n.date.getDate())+" ",1)),a.isSelected(n.date).result&&!n.otherMonth?(d(),m("div",G,_(a.isSelected(n.date).label),1)):M("",!0)],2))),128))]))),128)),o.calendar.length==5?(d(),m("tr",L,[(d(!0),m(p,null,w(o.weekDays,r=>(d(),m("td",{key:r}))),128))])):M("",!0)])])])}var J=b(N,[["render",A]]);const z={props:{name:{type:String,default:"Select Date"},date:{type:String,default:""},label:{type:String,default:"Select Date"}},data(){return{displayDate:"",showDatePicker:!1}},mounted(){this.updateDisplayDate(this.selectedDate)},created(){this.selectedDate=this.date},methods:{updateDisplayDate(e){const t={name:this.name,date:e};console.log("Selected date:",t),this.displayDate=O.formatDate(e,"MMM D, YYYY"),this.$emit("update:date",t)}}},H={class:"row items-center justify-end"};function K(e,t,i,l,o,a){return d(),m("div",null,[h(E,{modelValue:o.displayDate,"onUpdate:modelValue":t[3]||(t[3]=r=>o.displayDate=r),label:i.label,onClick:t[4]||(t[4]=r=>o.showDatePicker=!0),readonly:"",outlined:""},{append:c(()=>[h(T,{name:"event",class:"cursor-pointer",onClick:t[2]||(t[2]=x(r=>o.showDatePicker=!0,["stop"]))},{default:c(()=>[h(Y,{modelValue:o.showDatePicker,"onUpdate:modelValue":t[1]||(t[1]=r=>o.showDatePicker=r),"transition-show":"scale","transition-hide":"scale"},{default:c(()=>[h(V,{modelValue:e.selectedDate,"onUpdate:modelValue":[t[0]||(t[0]=r=>e.selectedDate=r),a.updateDisplayDate],mask:"YYYY-MM-DD","emit-value":""},{default:c(()=>[u("div",H,[y(h(g,{label:"Close",color:"primary",flat:""},null,512),[[C]])])]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["modelValue","label"])])}var W=b(z,[["render",K]]);const X={components:{MonthView:J,DatePicker:W},data(){return{selectedDates:{Start:new Date(2025,0,2),Submission:new Date(2025,0,5),Review:new Date(2025,0,10),Selection:new Date(2025,0,15),End:new Date(2025,0,31)},formData:{title:"",date_from:"",submission_date:"",review_date:"",selection_date:"",date_to:""},rules:{required:e=>!!e||"This field is required",dateRangeFrom:e=>this.validateDateFrom(e),dateRangeTo:e=>this.validateDateTo(e),submissionDate:e=>this.validateSubmisionDate(e),reviewDate:e=>this.validateReviewDate(e),selectionDate:e=>this.validateSelectionDate(e)},formError:{title:"",date_from:"",submission_date:"",review_date:"",selection_date:"",date_to:""},calendarMonths:[],markedDates:[new Date(2025,0,5),new Date(2025,0,15)]}},created(){this.getCall()},computed:{dateData(){return[{name:"date_from",label:"Start Date",value:this.formData.date_from},{name:"submission_date",label:"Submission Date",value:this.formData.submission_date},{name:"review_date",label:"Review Date",value:this.formData.review_date},{name:"selection_date",label:"Selection Date",value:this.formData.selection_date},{name:"date_to",label:"End Date",value:this.formData.date_to}]}},methods:{onDateChanged(e){this.formData[e.name]=e.date,this.updateCall()},getCall(){this.$api.get(`calls/${this.$route.params.call_id}/`).then(e=>{e.status==200&&(this.call=e.data,this.formData=e.data,this.formData.date_range={from:this.formData.date_from,to:this.formData.date_to},this.validateDates(),this.formData={title:this.call.title,date_from:this.call.date_from,submission_date:this.call.submission_date,review_date:this.call.review_date,selection_date:this.call.selection_date,date_to:this.call.date_to},console.log("formdata >>>",this.formData))})},validateDates(){this.formData.date_from&&this.formData.date_to&&new Date(this.formData.date_from)>new Date(this.formData.date_to)&&(this.formError.date_from="Start Date cannot be later than Stop Date.",this.formData.date_to=""),this.formData.date_from&&this.formData.submission_date&&new Date(this.formData.submission_date)<new Date(this.formData.date_from)&&(this.formData.submission_date=""),this.formData.submission_date&&this.formData.review_date&&new Date(this.formData.review_date)<new Date(this.formData.submission_date)&&(this.formData.review_date=""),this.formData.review_date&&this.formData.selection_date&&new Date(this.formData.selection_date)<new Date(this.formData.review_date)&&(this.formData.selection_date=""),this.formData.selection_date&&this.formData.date_to&&new Date(this.formData.date_to)<new Date(this.formData.selection_date)&&(this.formData.date_to=""),this.selectedDates={Start:new Date(this.formData.date_from)||null,Submission:new Date(this.formData.submission_date)||null,Review:new Date(this.formData.review_date)||null,Selection:new Date(this.formData.selection_date)||null,End:new Date(this.formData.date_to)||null},this.generateCalendar()},generateCalendar(){if(!this.formData.date_from||!this.formData.date_to){this.calendarMonths=[];return}const e=new Date(this.formData.date_from),t=new Date(this.formData.date_to),i=[];for(let l=new Date(e.getFullYear(),e.getMonth(),1);l<=t;l.setMonth(l.getMonth()+1)){const o=new Date(l.getFullYear(),l.getMonth()+1,0).getDate(),a=[];for(let r=1;r<=o;r++){const n=new Date(l.getFullYear(),l.getMonth(),r);let s=null;this.formData.submission_date&&n.toISOString().split("T")[0]===this.formData.submission_date?s="Submission":this.formData.review_date&&n.toISOString().split("T")[0]===this.formData.review_date?s="Review":this.formData.selection_date&&n.toISOString().split("T")[0]===this.formData.selection_date&&(s="Selection"),a.push({date:r,event:s})}i.push({name:l.toLocaleString("default",{month:"long"}),month:l.getMonth(),year:l.getFullYear(),days:a})}this.calendarMonths=i},updateSelectedDates(e){this.selectedDates=e,this.formData.date_from=f(e.Start,"-"),this.formData.submission_date=f(e.Submission,"-"),this.formData.review_date=f(e.Review,"-"),this.formData.selection_date=f(e.Selection,"-"),this.formData.date_to=f(e.End,"-"),console.log("final formdata",this.formData),this.generateCalendar()},updateCall(){this.validateDates(),console.log("formdata",this.formData),this.$api.put(`calls/${this.$route.params.call_id}/`,this.formData).then(e=>{e.status==200&&(this.call=e.data,this.$utilsStore.setLoading(!1))})},validateDateFrom(e){return!e||!this.formData.date_to||e<=this.formData.date_to||"Start date must be less than end date"},validateSubmisionDate(e){const t=this.formData.date_from.replace("/","-").replace("/","-"),i=this.formData.review_date;return(!t||e>t)&&(!i||e<i)||"Submission date must be greater than start date and less than review date"},validateReviewDate(e){const{submission_date:t,selection_date:i}=this.formData;return(!t||e>t)&&(!i||e<i)||"Review date must be greater than submission date and less than selection date"},validateSelectionDate(e){console.log("formdata",this.formData);const{date_from:t,submission_date:i,review_date:l,selection_date:o,date_to:a}=this.formData;return(!l||e>l)&&(!a||e<a)||"Selection date must be greater than review date and less than the end date"},validateDateTo(e){return!e||!this.formData.date_from||e>=this.formData.date_from||"End date must be greater than start date"}}},Z={class:"row q-gutter-sm justify-center"},ee={class:"row q-mt-sm q-gutter-sm justify-center"};function te(e,t,i,l,o,a){const r=k("DatePicker"),n=k("MonthView");return d(),m("div",null,[u("div",Z,[(d(!0),m(p,null,w(a.dateData,s=>(d(),v(r,{key:s.value,name:s.name,label:s.label,date:s.value,"onUpdate:date":t[0]||(t[0]=D=>a.onDateChanged(D))},null,8,["name","label","date"]))),128))]),h(P,{spaced:""}),u("div",ee,[(d(!0),m(p,null,w(o.calendarMonths,s=>(d(),v(n,{key:s.name,selectedYear:s.year,selectedMonth:s.month,monthName:s.name,markedDates:o.markedDates,selectedDates:o.selectedDates,"onUpdate:selectedDates":t[1]||(t[1]=D=>a.updateSelectedDates(D))},null,8,["selectedYear","selectedMonth","monthName","markedDates","selectedDates"]))),128))])])}var ae=b(X,[["render",te]]);const se={name:"UpdateCall",components:{CalendarGrid2:ae},data(){return{loading:!1,showDialog:!1,call:null}},computed:{},created(){this.getCall()},methods:{getCall(){this.$api.get(`calls/${this.$route.params.call_id}/`).then(e=>{e.status==200&&(this.call=e.data)})}},watch:{showPopup(e,t){this.showDialog=e},showDialog(e,t){this.$emit("showPopupChanged",e)}}},oe={class:"q-my-md"};function re(e,t,i,l,o,a){const r=k("CalendarGrid2");return o.call?(d(),v(Q,{key:0,padding:""},{default:c(()=>[u("div",oe,[h(F,null,{default:c(()=>[h(S,{icon:"home",to:"/",label:"Home"}),h(S,{label:"Calls",to:"/calls",icon:"campaign"}),h(S,{label:o.call.title,icon:"campaign"},null,8,["label"])]),_:1})]),h(r)]),_:1})):M("",!0)}var Fe=b(se,[["render",re]]);export{Fe as default};
