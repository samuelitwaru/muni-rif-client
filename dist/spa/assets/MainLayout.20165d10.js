import{n as M,m as Y,s as k,E as Z,y as ee,p as C,a7 as te,I as le,x as re,_ as q,r as b,o as s,j as _,f as t,w as l,F as z,k as F,g as v,e as f,h as m,t as D,v as Q,l as ne,Q as P,i as ae}from"./index.0c070ef5.js";import{Q as ie}from"./QToolbarTitle.42c6491d.js";import{Q as y,a as g}from"./QItem.80427ce1.js";import{Q as S}from"./QItemLabel.a3542404.js";import{Q as N}from"./QList.51e4b513.js";import{Q as R}from"./QBtnDropdown.4a85be1a.js";import{Q as oe,a as se,b as ue}from"./QLayout.ff91ea38.js";import{Q as ce}from"./QHeader.38f953e7.js";import{Q as de}from"./QDrawer.4c8f9947.js";import{C as w}from"./ClosePopup.30f5638f.js";import{a as B}from"./api.af531d4f.js";import{Q as E}from"./QSeparator.70cb9cc4.js";import{_ as fe}from"./logo.151e68dc.js";import"./use-dark.f75a96f1.js";import"./QBtnGroup.a75b0bd4.js";import"./QMenu.06d3a3b6.js";import"./selection.e8c2ee0a.js";import"./use-timeout.e38298e7.js";import"./focusout.5b955b74.js";import"./focus-manager.b507780d.js";import"./use-transition.aac813e1.js";import"./scroll.10606e11.js";import"./uid.42677368.js";import"./use-prevent-scroll.1187d5af.js";import"./TouchPan.2049a590.js";import"./touch.3df10340.js";import"./format.2bc25e5f.js";import"./axios.b87d4b0e.js";const he={ratio:[String,Number]};function me(e,n){return M(()=>{const d=Number(e.ratio||(n!==void 0?n.value:void 0));return isNaN(d)!==!0&&d>0?{paddingBottom:`${100/d}%`}:null})}const ge=16/9;var pe=Y({name:"QImg",props:{...he,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:ge},placeholderSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(e,{slots:n,emit:d}){const $=k(e.initialRatio),o=me(e,$);let a=null,c=!1;const i=[k(null),k(L())],u=k(0),p=k(!1),h=k(!1),H=M(()=>`q-img q-img--${e.noNativeMenu===!0?"no-":""}menu`),O=M(()=>({width:e.width,height:e.height})),V=M(()=>`q-img__image ${e.imgClass!==void 0?e.imgClass+" ":""}q-img__image--with${e.noTransition===!0?"out":""}-transition`),j=M(()=>({...e.imgStyle,objectFit:e.fit,objectPosition:e.position}));Z(()=>G(),I);function G(){return e.src||e.srcset||e.sizes?{src:e.src,srcset:e.srcset,sizes:e.sizes}:null}function L(){return e.placeholderSrc!==void 0?{src:e.placeholderSrc}:null}function I(r){a!==null&&(clearTimeout(a),a=null),h.value=!1,r===null?(p.value=!1,i[u.value^1].value=L()):p.value=!0,i[u.value].value=r}function W({target:r}){c!==!0&&(a!==null&&(clearTimeout(a),a=null),$.value=r.naturalHeight===0?.5:r.naturalWidth/r.naturalHeight,U(r,1))}function U(r,T){c===!0||T===1e3||(r.complete===!0?J(r):a=setTimeout(()=>{a=null,U(r,T+1)},50))}function J(r){c!==!0&&(u.value=u.value^1,i[u.value].value=null,p.value=!1,h.value=!1,d("load",r.currentSrc||r.src))}function K(r){a!==null&&(clearTimeout(a),a=null),p.value=!1,h.value=!0,i[u.value].value=null,i[u.value^1].value=L(),d("error",r)}function x(r){const T=i[r].value,A={key:"img_"+r,class:V.value,style:j.value,crossorigin:e.crossorigin,decoding:e.decoding,referrerpolicy:e.referrerpolicy,height:e.height,width:e.width,loading:e.loading,fetchpriority:e.fetchpriority,"aria-hidden":"true",draggable:e.draggable,...T};return u.value===r?(A.class+=" q-img__image--waiting",Object.assign(A,{onLoad:W,onError:K})):A.class+=" q-img__image--loaded",C("div",{class:"q-img__container absolute-full",key:"img"+r},C("img",A))}function X(){return p.value!==!0?C("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},le(n[h.value===!0?"error":"default"])):C("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},n.loading!==void 0?n.loading():e.noSpinner===!0?void 0:[C(re,{color:e.spinnerColor,size:e.spinnerSize})])}return I(G()),ee(()=>{c=!0,a!==null&&(clearTimeout(a),a=null)}),()=>{const r=[];return o.value!==null&&r.push(C("div",{key:"filler",style:o.value})),h.value!==!0&&(i[0].value!==null&&r.push(x(0)),i[1].value!==null&&r.push(x(1))),r.push(C(te,{name:"q-transition--fade"},X)),C("div",{class:H.value,style:O.value,role:"img","aria-label":e.alt},r)}}});const _e={name:"CallMenu",data(){return{calls:[],currentCall:null,currentUser:this.$authStore.currentUser}},computed:{otherCalls(){return this.currentCall?this.calls.filter(e=>e.id!=this.currentCall.id):[]},menuItems(){return this.$userHasAnyGroups(["applicant"])?[{name:"My Proposals",icon:"note",route:"/applicant/proposals"},{name:"Profile",icon:"person",route:"/account/profile"}]:this.$userHasAnyGroups(["reviewer"])?[{name:"Reviews",icon:"note",route:"/proposal-reviews"},{name:"Profile",icon:"person",route:"/account/profile"}]:this.$userHasAnyGroups(["grants_officer"])?[{name:"All Proposals",icon:"note",route:"/proposals"},{name:"Profile",icon:"person",route:"/account/profile"}]:[]}},created(){B().then(e=>{if(this.calls=e,this.calls.length){var n=this.calls[0];this.setCurrentCall(this.$dataStore.currentCall||n)}else this.setCurrentCall({title:"No Call Found"})})},methods:{navigateTo(e){this.$router.push(e)},changeCurrentCall(e){this.setCurrentCall(e),window.location="/"},setCurrentCall(e){this.currentCall=e,this.$dataStore.setCall(this.currentCall)}}},Ce={key:0},ve={key:0};function ye(e,n,d,$,o,a){const c=b("router-link");return o.currentUser&&e.$userHasAnyGroups(["grants_officer"])?(s(),_("div",Ce,[o.calls.length?(s(),_("div",ve,[t(N,null,{default:l(()=>[(s(!0),_(z,null,F(o.calls,i=>{var u;return v((s(),f(y,{key:i.id,active:i.id==((u=o.currentCall)==null?void 0:u.id),"active-class":"bg-primary text-white",clickable:"",onClick:p=>a.changeCurrentCall(i)},{default:l(()=>[t(g,null,{default:l(()=>[t(S,null,{default:l(()=>[m(D(i.title),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["active","onClick"])),[[w]])}),128))]),_:1}),t(E,{spaced:""})])):Q("",!0),t(N,null,{default:l(()=>[t(c,{to:"/calls"},{default:l(()=>[v((s(),f(y,{clickable:""},{default:l(()=>[t(g,null,{default:l(()=>[t(S,null,{default:l(()=>[m(" See all calls ...")]),_:1})]),_:1})]),_:1})),[[w]])]),_:1}),t(c,{to:"/calls/create"},{default:l(()=>[v((s(),f(y,{clickable:""},{default:l(()=>[t(g,null,{default:l(()=>[t(S,null,{default:l(()=>[m(" Create New Call ")]),_:1})]),_:1})]),_:1})),[[w]])]),_:1})]),_:1})])):Q("",!0)}var Se=q(_e,[["render",ye]]);const we={name:"CallMenu",data(){return{calls:[],currentCall:null,currentUser:this.$authStore.currentUser}},computed:{otherCalls(){return this.currentCall?this.calls.filter(e=>e.id!=this.currentCall.id):[]},menuItems(){return this.$userHasAnyGroups(["applicant"])?[{name:"My Proposals",icon:"note",route:"/applicant/proposals"},{name:"Profile",icon:"person",route:"/account/profile"}]:this.$userHasAnyGroups(["reviewer"])?[{name:"Reviews",icon:"note",route:"/proposal-reviews"},{name:"Profile",icon:"person",route:"/account/profile"}]:this.$userHasAnyGroups(["grants_officer"])?[{name:"All Proposals",icon:"note",route:"/proposals"},{name:"Profile",icon:"person",route:"/account/profile"}]:[]}},created(){B().then(e=>{if(this.calls=e,console.log("calls",e),this.calls.length){var n=this.calls[0];console.log("lastcall",this.$dataStore.currentCall),console.log("lastcall",n),this.setCurrentCall(this.$dataStore.currentCall||n)}else this.setCurrentCall({title:"No Call Found"})})},methods:{navigateTo(e){this.$router.push(e)},changeCurrentCall(e){this.setCurrentCall(e),window.location="/"},setCurrentCall(e){this.currentCall=e,this.$dataStore.setCall(this.currentCall)}}},$e={key:0},ke={key:0},be={key:0},Qe={key:1};function Me(e,n,d,$,o,a){const c=b("router-link");return o.currentCall?(s(),_("span",$e,[o.currentUser&&e.$userHasAnyGroups(["grants_officer"])?(s(),f(R,{key:0,split:"",color:"white",flat:"","no-caps":"",icon:"folder",label:o.currentCall.title,onClick:n[0]||(n[0]=i=>this.$router.push(`/calls/${o.currentCall.id}`))},{default:l(()=>[e.$userHasAnyGroups(["grants_officer"])?(s(),_("div",ke,[o.calls.length?(s(),_("div",be,[t(N,null,{default:l(()=>[(s(!0),_(z,null,F(o.calls,i=>{var u;return v((s(),f(y,{key:i.id,active:i.id==((u=o.currentCall)==null?void 0:u.id),"active-class":"bg-primary text-white",clickable:"",onClick:p=>a.changeCurrentCall(i)},{default:l(()=>[t(g,null,{default:l(()=>[t(S,null,{default:l(()=>[m(D(i.title),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["active","onClick"])),[[w]])}),128))]),_:1}),t(E,{spaced:""})])):Q("",!0),t(N,null,{default:l(()=>[t(c,{to:"/calls"},{default:l(()=>[v((s(),f(y,{clickable:""},{default:l(()=>[t(g,null,{default:l(()=>[t(S,null,{default:l(()=>[m(" See all calls ...")]),_:1})]),_:1})]),_:1})),[[w]])]),_:1}),t(c,{to:"/calls/create"},{default:l(()=>[v((s(),f(y,{clickable:""},{default:l(()=>[t(g,null,{default:l(()=>[t(S,null,{default:l(()=>[m(" Create New Call ")]),_:1})]),_:1})]),_:1})),[[w]])]),_:1})]),_:1})])):Q("",!0)]),_:1},8,["label"])):(s(),_("span",Qe," > "+D(o.currentCall.title),1))])):Q("",!0)}var Ne=q(we,[["render",Me]]);const He={name:"MainLayout",components:{CallMenu:Se,DropdownCallMenu:Ne},data(){return{leftDrawerOpen:!1,calls:[],currentCall:null}},computed:{otherCalls(){return this.currentCall?this.calls.filter(e=>e.id!=this.currentCall.id):[]}},created(){this.$authStore.currentUser||(location.href="/index/account/signin"),this.getEntity()},methods:{toggleLeftDrawer(){this.leftDrawerOpen=!this.leftDrawerOpen},async getEntity(){const e=await this.$api.get("entities/");this.entity=e.data[0],this.$dataStore.setEntity(this.entity),console.log("entity",this.entity),this.getCalls()},getCalls(){B().then(e=>{if(this.calls=e,this.calls.length)if(this.$userHasAnyGroups(["applicant","reviewer"])){var n=this.calls.find($=>$.id==this.entity.current_call);console.log("ac",n),n?this.setCurrentCall(n||{title:"No Call Found"}):this.$router.push("/no-call-found")}else{var d=this.calls[0];this.setCurrentCall(this.$dataStore.currentCall||d)}else this.setCurrentCall({title:"No Call Found"}),this.$userHasAnyGroups(["grants_officer"])?this.$router.push("/calls"):this.$router.push("/no-call-found")})},changeCurrentCall(e){this.setCurrentCall(e),window.location.reload()},setCurrentCall(e){this.currentCall=e,this.$dataStore.setCall(this.currentCall)},logout(){this.$utilsStore.setLoading(!0),this.$api.get("/accounts/logout/").then(e=>{this.$router.push("/index/account/signin"),this.$authStore.clearUserAndToken(),this.$utilsStore.setLoading(!1)})}}},Te={key:1},Ae={class:"text-orange-3 q-px-xs"};function De(e,n,d,$,o,a){const c=b("loading-component"),i=b("DropdownCallMenu"),u=b("CallMenu"),p=b("router-view");return o.currentCall?(s(),f(ue,{key:0,view:"hHh Lpr lFf"},{default:l(()=>[t(c),t(ce,{elevated:""},{default:l(()=>[t(oe,null,{default:l(()=>{var h,H;return[t(ne,{flat:"",dense:"",round:"",icon:"menu","aria-label":"Menu",onClick:a.toggleLeftDrawer},null,8,["onClick"]),t(ie,null,{default:l(()=>[m(" Muni RIF "),e.$userHasAnyGroups(["grants_officer"])?(s(),f(i,{key:0})):(s(),_("span",Te,[t(P,{name:"arrow_right",size:"md"}),m(" "+D(this.currentCall.title),1)]))]),_:1}),ae("div",Ae,[t(R,{split:"",color:"grey-2","text-color":"black",rounded:"",icon:"person",to:"/account/profile",label:`${(h=e.$authStore.currentUser)==null?void 0:h.first_name} ${(H=e.$authStore.currentUser)==null?void 0:H.last_name}`},{default:l(()=>[t(N,null,{default:l(()=>[v((s(),f(y,{clickable:"",to:"/account/profile"},{default:l(()=>[t(g,{side:""},{default:l(()=>[t(P,{name:"person"})]),_:1}),t(g,null,{default:l(()=>[t(S,null,{default:l(()=>[m("Profile")]),_:1})]),_:1})]),_:1})),[[w]]),v((s(),f(y,{clickable:"",onClick:a.logout},{default:l(()=>[t(g,{side:""},{default:l(()=>[t(P,{name:"logout"})]),_:1}),t(g,null,{default:l(()=>[t(S,null,{default:l(()=>[m("Logout")]),_:1})]),_:1})]),_:1},8,["onClick"])),[[w]])]),_:1})]),_:1},8,["label"])])]}),_:1})]),_:1}),t(de,{modelValue:o.leftDrawerOpen,"onUpdate:modelValue":n[0]||(n[0]=h=>o.leftDrawerOpen=h),class:"bg-grey-2",bordered:"",width:220},{default:l(()=>[t(pe,{src:fe,"spinner-color":"primary","spinner-size":"72px"}),t(u)]),_:1},8,["modelValue"]),t(se,null,{default:l(()=>[t(p)]),_:1})]),_:1})):Q("",!0)}var ot=q(He,[["render",De]]);export{ot as default};
