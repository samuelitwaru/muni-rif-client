import{_ as I,H as V,aL as D,r as i,o as r,e as n,w as s,f as o,l as u,i as c,h as f,t as p,n as h,j as d,F as _,k as w,g as $,R as g,Q as L}from"./index.e39be684.js";import{Q as T}from"./QChip.19e4d28f.js";import{Q as B}from"./QToolbarTitle.bd27c268.js";import{Q as q,a as H,b as N}from"./QLayout.debc0d67.js";import{Q as O}from"./QHeader.4b49045c.js";import{Q as R}from"./QCard.f9e0a707.js";import{Q as k,a as b}from"./QItem.c0795fab.js";import{Q}from"./QSeparator.13d6beeb.js";import{Q as v}from"./QList.521c8a93.js";import{Q as j}from"./QDrawer.499a1943.js";import{P as E}from"./ProposalHeader.459c8fe0.js";import"./use-dark.54601180.js";import"./scroll.eaa460d0.js";import"./use-prevent-scroll.92142e4c.js";import"./use-timeout.65a9f0b9.js";import"./TouchPan.6abfb632.js";import"./touch.3df10340.js";import"./format.2bc25e5f.js";import"./QMarkupTable.c371dead.js";const z=V({components:{ProposalHeader:E},name:"ProposalLayout",data(){return{leftDrawerOpen:!1,proposal:{},proposalFiles:[],score:{},sections:[],menuItems:[{icon:"reviews",label:"Reviews",name:"reviews",link:"#reviews"},{icon:"assignment",label:"Reports",name:"reports",link:"#reports"}]}},created(){D(this.$options.name),this.getProposal()},methods:{getProposal(){this.$utilsStore.setLoading(!0),this.$api.get(`proposals/${this.$route.params.proposal_id}/`).then(e=>{this.proposal=e.data,this.$proposalStore.setProposal(this.proposal),this.getProposalFiles(),this.getSections(),this.getScore(),this.$utilsStore.setLoading(!1)})},getProposalFiles(){this.$api.get(`files/?proposal_id=${this.$route.params.proposal_id}`).then(e=>{this.proposalFiles=e.data})},getScore(){var e;this.$api.get(`scores/?user=${((e=this.$authStore.currentUser)==null?void 0:e.id)||0}&proposal=${this.$route.params.proposal_id}`).then(a=>{a.data.length==1&&(this.score=a.data[0])})},deleteFile(e){confirm("Delete this File?")&&this.$api.delete(`files/${e}/`).then(a=>{this.getProposalFiles()})},getSections(){this.$api.get("sections/").then(e=>{this.sections=e.data})},downloadProposal(){this.$api.get(`proposals/${this.$route.params.proposal_id}/pdf/download/`).then(e=>{e.status==200&&window.open(e.data.file_url,"_blank")})},scrollInToView(e){document.getElementById(e).scrollIntoView({behavior:"smooth",block:"start"})},openFile(e){window.open(e)}}}),U={class:"flex"},G=["href"],M={class:"q-px-sm border q-my-auto q-mr-sm"};function A(e,a,J,K,W,X){const y=i("loading-component"),P=i("score-sheet"),S=i("router-link"),C=i("ProposalHeader"),F=i("router-view");return e.$proposalStore.currentProposal?(r(),n(N,{key:0,view:"lHh Lpr lFf"},{default:s(()=>[o(y),o(O,{elevated:""},{default:s(()=>[o(q,{class:"bg-white text-dark"},{default:s(()=>{var t;return[o(u,{flat:"",dense:"",round:"",icon:"menu","aria-label":"Menu",onClick:a[0]||(a[0]=l=>e.leftDrawerOpen=!e.leftDrawerOpen)}),o(B,{class:"flex justify-between"},{default:s(()=>{var l,m;return[c("div",null,[f(p((l=e.$proposalStore.currentProposal)==null?void 0:l.title)+" ",1),o(T,{color:"secondary",class:"text-white",size:"md",label:(m=e.$proposalStore.currentProposal)==null?void 0:m.status},null,8,["label"])])]}),_:1}),c("div",U,[o(P),((t=e.$proposalStore.currentProposal)==null?void 0:t.status)!="EDITING"?(r(),n(u,{key:0,color:"primary",icon:"download",dense:"",label:"download",onClick:e.downloadProposal},null,8,["onClick"])):h("",!0)])]}),_:1})]),_:1}),o(j,{modelValue:e.leftDrawerOpen,"onUpdate:modelValue":a[1]||(a[1]=t=>e.leftDrawerOpen=t),class:"bg-grey-2","show-if-above":"",bordered:"",width:220},{default:s(()=>[o(R,{flat:"",class:"q-py-sm"},{default:s(()=>[o(S,{to:"/go/proposals/submitted"},{default:s(()=>[o(u,{class:"q-mx-sm",block:"",color:"primary",flat:"",icon:"arrow_back",label:"Back"})]),_:1})]),_:1}),o(v,null,{default:s(()=>[(r(!0),d(_,null,w(e.sections,(t,l)=>(r(),d("span",{key:t.id,href:`/proposals/${e.$route.params.proposal_id}${t.ref}`},[$((r(),n(k,{clickable:"",onClick:m=>e.scrollInToView(t.name)},{default:s(()=>[c("div",M,p(l+1),1),o(b,null,{default:s(()=>[f(p(t.title),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[g]]),o(Q)],8,G))),128))]),_:1}),o(v,null,{default:s(()=>[(r(!0),d(_,null,w(e.menuItems,t=>(r(),d("span",{key:t.name},[$((r(),n(k,{class:"row q-gutter-x-sm justify-center items-center",clickable:"",onClick:l=>e.scrollInToView(t.name)},{default:s(()=>[o(L,{name:t.icon,size:"1.5rem"},null,8,["name"]),o(b,null,{default:s(()=>[f(p(t.label),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[g]]),o(Q)]))),128))]),_:1})]),_:1},8,["modelValue"]),o(H,null,{default:s(()=>[o(C),o(F)]),_:1})]),_:1})):h("",!0)}var _e=I(z,[["render",A]]);export{_e as default};
