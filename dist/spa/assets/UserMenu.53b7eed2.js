import{Q as w}from"./QChip.19e4d28f.js";import{Q as p}from"./QItemLabel.aff81a70.js";import{Q as f,a as m}from"./QItem.c0795fab.js";import{Q as v}from"./QList.521c8a93.js";import{Q as D}from"./QSeparator.13d6beeb.js";import{Q as I}from"./QBtnDropdown.85fcf977.js";import{C}from"./ClosePopup.3f3723a2.js";import{_ as P,r as R,o as s,j as u,e as i,w as t,f as a,F as k,k as L,n as c,g as _,h as S,t as A,C as O,s as b,z as Q,N as T,i as E,Q as M}from"./index.e39be684.js";const B={props:{color:{type:String,default:"primary"}},name:"CallMenu",data(){return{calls:[],currentCall:null,currentUser:this.$authStore.currentUser}},computed:{otherCalls(){return this.currentCall?this.calls.filter(e=>e.id!=this.currentCall.id):[]},activeCall(){return this.calls.find(e=>e.id==this.entity.current_call)},menuItems(){return this.$userHasAnyGroups(["applicant"])?[{name:"My Proposals",icon:"note",route:"/applicant/proposals"},{name:"Profile",icon:"person",route:"/account/profile"}]:this.$userHasAnyGroups(["reviewer"])?[{name:"Reviews",icon:"note",route:"/proposal-reviews"},{name:"Profile",icon:"person",route:"/account/profile"}]:this.$userHasAnyGroups(["grants_officer"])?[{name:"All Proposals",icon:"note",route:"/proposals"},{name:"Profile",icon:"person",route:"/account/profile"}]:[]}},created(){this.getEntity()},methods:{async getEntity(){const e=await this.$api.get("entities/");this.entity=e.data[0],this.$dataStore.setEntity(this.entity),this.getCalls()},getCalls(){this.$api.get("calls/").then(e=>{if(this.calls=e.data,this.calls.length){var o=this.getActiveCall();console.log("current call: ",this.$dataStore.currentCall.title),this.setCurrentCall(this.$dataStore.currentCall||o)}else this.setCurrentCall({title:"No Call Found"})})},getActiveCall(){return this.calls.find(e=>e.id==this.entity.current_call)},navigateTo(e){this.$router.push(e)},changeCurrentCall(e){this.setCurrentCall(e),window.location="/"},setCurrentCall(e){this.currentCall=e,this.$dataStore.setCall(this.currentCall)}}},V={key:0},x={key:0},H={key:0};function N(e,o,h,g,r,d){const l=R("router-link");return r.currentCall?(s(),u("span",V,[r.currentUser&&e.$userHasAnyGroups(["grants_officer"])?(s(),i(I,{key:0,split:"",color:h.color,outline:"","no-caps":"",icon:"folder",label:r.currentCall.title,onClick:o[0]||(o[0]=n=>this.$router.push("/calls/"))},{default:t(()=>[e.$userHasAnyGroups(["grants_officer"])?(s(),u("div",x,[r.calls.length?(s(),u("div",H,[a(v,null,{default:t(()=>[(s(!0),u(k,null,L(r.calls,n=>{var $;return _((s(),i(f,{key:n.id,active:n.id==(($=r.currentCall)==null?void 0:$.id),"active-class":"bg-primary text-white",clickable:"",onClick:y=>d.changeCurrentCall(n)},{default:t(()=>[a(m,null,{default:t(()=>[a(p,{class:"flex justify-between items-center"},{default:t(()=>{var y;return[S(A(n.title)+" ",1),((y=d.activeCall)==null?void 0:y.id)==n.id?(s(),i(w,{key:0,color:"secondary",size:"sm",class:"gloss",label:"Active"})):c("",!0)]}),_:2},1024)]),_:2},1024)]),_:2},1032,["active","onClick"])),[[C]])}),128))]),_:1}),a(D,{spaced:""})])):c("",!0),a(v,null,{default:t(()=>[a(l,{to:"/calls"},{default:t(()=>[_((s(),i(f,{clickable:""},{default:t(()=>[a(m,null,{default:t(()=>[a(p,null,{default:t(()=>[S(" See all calls ...")]),_:1})]),_:1})]),_:1})),[[C]])]),_:1}),a(l,{to:"/calls/create"},{default:t(()=>[_((s(),i(f,{clickable:""},{default:t(()=>[a(m,null,{default:t(()=>[a(p,null,{default:t(()=>[S(" Create New Call ")]),_:1})]),_:1})]),_:1})),[[C]])]),_:1})]),_:1})])):c("",!0)]),_:1},8,["color","label"])):c("",!0)])):c("",!0)}var ae=P(B,[["render",N]]);const q=["top","middle","bottom"];var W=O({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:e=>q.includes(e)}},setup(e,{slots:o}){const h=b(()=>e.align!==void 0?{verticalAlign:e.align}:null),g=b(()=>{const r=e.outline===!0&&e.color||e.textColor;return`q-badge flex inline items-center no-wrap q-badge--${e.multiLine===!0?"multi":"single"}-line`+(e.outline===!0?" q-badge--outline":e.color!==void 0?` bg-${e.color}`:"")+(r!==void 0?` text-${r}`:"")+(e.floating===!0?" q-badge--floating":"")+(e.rounded===!0?" q-badge--rounded":"")+(e.transparent===!0?" q-badge--transparent":"")});return()=>Q("div",{class:g.value,style:h.value,role:"status","aria-label":e.label},T(o.default,e.label!==void 0?[e.label]:[]))}});const G={data(){return{showPopup:!1,menuItems:[{name:"HOME",display_name:"HOME",route:"/",icon:"home",color:"secondary",roles:[]},{name:"PROPOSALS",display_name:"ALL PROPOSALS",route:"/go/proposals/submitted",icon:"description",color:"secondary",roles:["grants_officer"],count:0,click:()=>{this.$utilsStore.setStateData("ProposalList_status_query","SUBMITTED")}},{name:"REVIEWED",display_name:"REVIEWED",route:"/go/proposals/reviewed",icon:"search",color:"secondary",roles:["grants_officer"],click:()=>{this.$utilsStore.setStateData("ProposalList_status_query","REVIEWED")}},{name:"SELECTED",display_name:"SELECTED",route:"/go/proposals/selected",icon:"check_circle_outline",color:"secondary",roles:["grants_officer"],click:()=>{this.$utilsStore.setStateData("ProposalList_status_query","SELECTED")}},{name:"CALLS",display_name:"CALLS",route:"/calls",icon:"campaign",color:"secondary",roles:["grants_officer"],count:0},{name:"THEMES",display_name:"THEMES",route:"/themes",icon:"apps",color:"secondary",roles:["grants_officer"]},{name:"REVIEWERS",display_name:"REVIEWERS",route:"/reviewers",icon:"school",color:"secondary",roles:["grants_officer"]},{name:"APPLICANTS",display_name:"APPLICANTS",route:"/applicants",icon:"people",color:"secondary",roles:["grants_officer"]},{name:"MY PROPOSALS",display_name:"MY PROPOSALS",route:"/applicant/proposals",icon:"search",color:"secondary",roles:["applicant"]},{name:"PROPOSAL REVIEWS",display_name:"PROPOSAL REVIEWS",route:"/proposal-reviews",icon:"reviews",color:"secondary",roles:["reviewer"]}],counts:{SELECTED:0,PROPOSALS:0}}},created(){this.getCalls(),this.$bus.on("proposal-selected",e=>{this.getCounts()})},methods:{getCalls(){this.$api.get("calls/").then(e=>{if(this.items=e.data,this.items.length){var o=this.items[0];this.setCurrentCall(this.$dataStore.currentCall||o),this.getCounts()}else this.setCurrentCall({title:"No Call Found"})})},setCurrentCall(e){this.currentCall=e,this.$dataStore.setCall(this.currentCall)},getCounts(){this.$api.get(`proposals/count/?call=${this.$dataStore.currentCall.id}&is_selected=true`).then(e=>{(e.status=200)&&(this.counts.SELECTED=e.data.count)}),this.$api.get(`proposals/count/?call=${this.$dataStore.currentCall.id}&status=SUBMITTED`).then(e=>{(e.status=200)&&(this.counts.PROPOSALS=e.data.count)}),this.$api.get(`proposals/count/?call=${this.$dataStore.currentCall.id}&status=REVIEWED`).then(e=>{(e.status=200)&&(this.counts.REVIEWED=e.data.count)})},isMenuActive(e){return e.name=="HOME"?this.$route.path=="/":this.$route.path.startsWith(e.route)},routeTo(e){e.click&&e.click(),this.$router.push(e.route)}}},U={class:"row items-center"},F={class:"q-pa-sm"};function j(e,o,h,g,r,d){return s(),u("div",null,[E("div",null,[a(v,null,{default:t(()=>[(s(!0),u(k,null,L(r.menuItems.filter(l=>e.$userHasAnyGroups(l.roles)||l.roles.length==0),l=>_((s(),i(f,{key:l.name,active:d.isMenuActive(l),"active-class":"bg-primary text-white",clickable:"",onClick:n=>d.routeTo(l),title:l.name},{default:t(()=>[a(m,null,{default:t(()=>[a(p,{class:"row justify-between items-center"},{default:t(()=>[E("div",U,[a(M,{name:l.icon,size:"xs"},null,8,["name"]),E("span",F,A(l.display_name),1)]),r.counts[l.name]?(s(),i(W,{key:0,label:r.counts[l.name]},null,8,["label"])):c("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1032,["active","onClick","title"])),[[C]])),128))]),_:1})])])}var le=P(G,[["render",j]]);export{ae as D,W as Q,le as u};
