import{Q as C}from"./QToolbarTitle.11babbcc.js";import{_ as T,o as i,h as p,a as l,j as y,w as s,g as r,f as g,F as b,i as k,c as Q,t as m,u as V,s as S,r as F}from"./index.9b6d8f02.js";import{Q as R}from"./QMarkupTable.e680a5a9.js";import{Q as _}from"./QCardSection.f9ea1c28.js";import{Q as v}from"./QSeparator.b2724df3.js";import{Q as U}from"./QItemLabel.ba99c664.js";import{Q as A,a as $}from"./QItem.7adbf461.js";import{Q as B}from"./QList.afbd39be.js";import{Q as q}from"./QUploader.ab19f20d.js";import{Q as x}from"./QChip.4ed0a923.js";import{Q as I}from"./QCard.4957859e.js";import{Q as P}from"./QDialog.3343fb4c.js";import"./use-dark.8dc51c8e.js";import"./QCircularProgress.aedc86cc.js";import"./format.3e32b8d9.js";import"./use-file.c932356f.js";import"./use-prevent-scroll.149239bb.js";import"./scroll.18b40ccd.js";import"./use-timeout.da7d71c6.js";import"./focusout.e24e3d1a.js";import"./focus-manager.b507780d.js";import"./portal.127dfe2c.js";import"./use-transition.8872bac2.js";const N={name:"FileUploader",props:["uploadUrl","multiple","formData"],data(){return{modalVisible:!1,uploadHeaders:{},filesToUpload:[],uploadedFiles:[]}},methods:{onFileAdded(e){e.forEach(t=>{this.uploadFile(t)}),this.filesToUpload=[...this.filesToUpload,...e]},onBrowse(e){var t=Array.from(e.target.files);console.log(t),this.onFileAdded(t)},uploadFile(e){const t=new FormData;t.append("file",e);for(const a in this.formData)this.formData.hasOwnProperty(a)&&t.append(a,this.formData[a]);t.append("name",e.name),t.append("attachment",this.attachment_id),t.append("proposal",this.$route.params.proposal_id),this.$api.post(this.uploadUrl,t,{headers:this.uploadHeaders}).then(a=>{this.uploadedFiles.push(e),this.filesToUpload=this.filesToUpload.filter(u=>u.key!=e.key),console.log(e),console.log(this.filesToUpload),this.uploadedFiles=[],this.modalVisible=!1,this.$emit("file-uploaded")}).catch(a=>{console.log(a)})}}},L={key:0},E=r("div",{class:"text-h6"},"Attachments",-1),G=r("div",{class:"text-center q-my-auto q-py-lg",style:{"background-color":"#ffffff",color:"#000000"}}," Drag and drop files here ",-1),H={class:"text-center",style:{"background-color":"#ffffff",color:"#000000"}},z=r("br",null,null,-1),j=r("br",null,null,-1),M=["multiple"],O=r("label",{for:"files",class:"button-label"}," Browse ",-1);function J(e,t,a,u,n,d){var c,f;return((c=e.$proposalStore.currentProposal)==null?void 0:c.status)=="EDITING"&&e.$authStore.currentUser.id==((f=e.$proposalStore.currentProposal)==null?void 0:f.user)?(i(),p("div",L,[l(y,{color:"primary",icon:"attachment",label:"Add",dense:"",flat:"",onClick:t[0]||(t[0]=o=>n.modalVisible=!0)}),l(P,{modelValue:n.modalVisible,"onUpdate:modelValue":t[3]||(t[3]=o=>n.modalVisible=o)},{default:s(()=>[l(I,{style:{width:"400px"}},{default:s(()=>[l(_,{class:"q-pa-sm text-center"},{default:s(()=>[E]),_:1}),l(v,{spaced:""}),l(_,{class:"q-pa-sm"},{default:s(()=>[r("div",null,[l(q,{url:a.uploadUrl,multiple:a.multiple,onAdded:d.onFileAdded,style:{width:"100%"}},{header:s(()=>[G,r("div",H,[g(" or "),z,j,r("input",{onChange:t[1]||(t[1]=(...o)=>d.onBrowse&&d.onBrowse(...o)),type:"file",id:"files",class:"hidden",multiple:a.multiple},null,40,M),O])]),list:s(()=>[l(B,{separator:""},{default:s(()=>[(i(!0),p(b,null,k(n.filesToUpload,o=>(i(),Q(A,{key:o.__key},{default:s(()=>[l($,null,{default:s(()=>[l(U,{class:"full-width ellipsis"},{default:s(()=>[g(m(o.name),1)]),_:2},1024),l(U,{caption:""},{default:s(()=>[g(m(o.__sizeLabel)+" / "+m(o.__progressLabel),1)]),_:2},1024)]),_:2},1024),l($,{top:"",side:""},{default:s(()=>[l(V,{size:"20px",color:"primary"})]),_:1})]),_:2},1024))),128))]),_:1})]),_:1},8,["url","multiple","onAdded"])])]),_:1}),l(_,{class:"q-pa-sm"},{default:s(()=>[(i(!0),p(b,null,k(n.uploadedFiles,o=>(i(),Q(x,{dense:"",key:o.__key,class:"glossy",icon:"check",label:o.name},null,8,["label"]))),128))]),_:1}),l(v,{spaced:""}),l(_,{align:"right"},{default:s(()=>[l(y,{color:"primary",label:"Done",onClick:t[2]||(t[2]=o=>{n.uploadedFiles=[],n.modalVisible=!1})})]),_:1})]),_:1})]),_:1},8,["modelValue"])])):S("",!0)}var K=T(N,[["render",J]]);const W={components:{FileUploader:K},data(){return{reportingDates:[],loading:!1}},created(){this.getReportingDates()},methods:{getReportingDates(){this.$api.get("reporting-dates/").then(e=>{this.reportingDates=e.data,this.getReports()})},getReports(){for(let e=0;e<this.reportingDates.length;e++){const t=this.reportingDates[e];this.$api.get(`reports/?proposal_id=${this.$route.params.proposal_id}&reporting_date_id=${t.id}`).then(a=>{var u=a.data;console.log(t.title+">>"+u),this.reportingDates.filter(n=>n.id==t.id)[0].files=u})}},deleteFile(e){confirm("Delete this Report?")&&this.$api.delete(`reports/${e}/`).then(t=>{this.getReports()})},openFile(e){window.open(e)}}},X={class:"q-pa-sm"},Y=r("thead",null,[r("tr",null,[r("th",{align:"left"},"Title"),r("th",{align:"left"},"Deadline"),r("th",{align:"left"},"Reports")])],-1),Z={key:0,class:"flex"};function ee(e,t,a,u,n,d){const c=F("proposal-score-sheets"),f=F("FileUploader");return i(),p("div",null,[l(c),r("div",X,[l(C,null,{default:s(()=>[g("Reports")]),_:1}),l(R,{class:"q-my-sm",flat:"",bordered:""},{default:s(()=>[Y,r("tbody",null,[(i(!0),p(b,null,k(n.reportingDates,o=>{var D;return i(),p("tr",{key:o.id},[r("td",null,m(o.title),1),r("td",null,m(o.date),1),r("td",null,[(D=o==null?void 0:o.files)!=null&&D.length?(i(),p("div",Z,[(i(!0),p(b,null,k(o.files,h=>(i(),p("div",{key:h.id},[l(y,{color:"primary",flat:"",icon:"report",label:h.title,removable:e.$userHasAnyGroups(["applicant"])&&e.$authStore.currentUser.id==e.$proposalStore.currentProposal.user&&e.$proposalStore.currentProposal.status=="EDITING",onClick:w=>d.openFile(h.file)},null,8,["label","removable","onClick"]),l(y,{color:"primary",flat:"",icon:"close",onClick:w=>d.deleteFile(h.id)},null,8,["onClick"])]))),128))])):(i(),Q(f,{key:1,multiple:!1,uploadUrl:"reports/",formData:{title:o.title,proposal:e.$proposalStore.currentProposal.id,reporting_date:o.id},onFileUploaded:d.getReports},null,8,["formData","onFileUploaded"]))])])}),128))])]),_:1})])])}var ve=T(W,[["render",ee]]);export{ve as default};
