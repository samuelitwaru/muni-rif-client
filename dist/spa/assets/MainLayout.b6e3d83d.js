import{n as y,m as W,s as v,E as J,y as K,p as h,a7 as X,O as Y,x as Z,_ as P,r as S,o as u,j as M,f as t,w as l,F as ee,k as te,g as w,e as g,h as _,t as A,u as q,l as le,Q as T,i as re}from"./index.3671a223.js";import{Q as ae}from"./QToolbarTitle.b2035143.js";import{Q as $,a as p}from"./QItem.41d22b85.js";import{Q as k}from"./QItemLabel.8f35a27f.js";import{Q as B}from"./QList.ae152641.js";import{Q as ne}from"./QBtnDropdown.2865dd5c.js";import{Q as ie,a as oe,b as se}from"./QLayout.cab52353.js";import{Q as ue}from"./QHeader.02a6e89b.js";import{Q as ce}from"./QDrawer.d62e1eeb.js";import{C as b}from"./ClosePopup.32e36c56.js";import{a as F}from"./api.258dad18.js";import{Q as de}from"./QSeparator.f4e84234.js";import{D as fe}from"./DropdownCallMenu.d16a6e65.js";import{_ as me}from"./logo.151e68dc.js";import"./use-dark.dbbd0c9d.js";import"./QBtnGroup.e3f02e69.js";import"./QMenu.2c83730c.js";import"./use-timeout.26584f0c.js";import"./focus-manager.b507780d.js";import"./use-transition.1d5f554b.js";import"./scroll.624406d4.js";import"./uid.42677368.js";import"./use-prevent-scroll.53dc6540.js";import"./TouchPan.a9e25187.js";import"./touch.3df10340.js";import"./format.2bc25e5f.js";import"./axios.f8ca42f8.js";import"./QChip.05b39f31.js";const he={ratio:[String,Number]};function ge(e,n){return y(()=>{const c=Number(e.ratio||(n!==void 0?n.value:void 0));return isNaN(c)!==!0&&c>0?{paddingBottom:`${100/c}%`}:null})}const _e=16/9;var pe=W({name:"QImg",props:{...he,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:_e},placeholderSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(e,{slots:n,emit:c}){const C=v(e.initialRatio),s=ge(e,C);let a=null,f=!1;const i=[v(null),v(N())],o=v(0),m=v(!1),d=v(!1),Q=y(()=>`q-img q-img--${e.noNativeMenu===!0?"no-":""}menu`),U=y(()=>({width:e.width,height:e.height})),O=y(()=>`q-img__image ${e.imgClass!==void 0?e.imgClass+" ":""}q-img__image--with${e.noTransition===!0?"out":""}-transition`),R=y(()=>({...e.imgStyle,objectFit:e.fit,objectPosition:e.position}));J(()=>x(),H);function x(){return e.src||e.srcset||e.sizes?{src:e.src,srcset:e.srcset,sizes:e.sizes}:null}function N(){return e.placeholderSrc!==void 0?{src:e.placeholderSrc}:null}function H(r){a!==null&&(clearTimeout(a),a=null),d.value=!1,r===null?(m.value=!1,i[o.value^1].value=N()):m.value=!0,i[o.value].value=r}function E({target:r}){f!==!0&&(a!==null&&(clearTimeout(a),a=null),C.value=r.naturalHeight===0?.5:r.naturalWidth/r.naturalHeight,z(r,1))}function z(r,D){f===!0||D===1e3||(r.complete===!0?G(r):a=setTimeout(()=>{a=null,z(r,D+1)},50))}function G(r){f!==!0&&(o.value=o.value^1,i[o.value].value=null,m.value=!1,d.value=!1,c("load",r.currentSrc||r.src))}function V(r){a!==null&&(clearTimeout(a),a=null),m.value=!1,d.value=!0,i[o.value].value=null,i[o.value^1].value=N(),c("error",r)}function I(r){const D=i[r].value,L={key:"img_"+r,class:O.value,style:R.value,crossorigin:e.crossorigin,decoding:e.decoding,referrerpolicy:e.referrerpolicy,height:e.height,width:e.width,loading:e.loading,fetchpriority:e.fetchpriority,"aria-hidden":"true",draggable:e.draggable,...D};return o.value===r?(L.class+=" q-img__image--waiting",Object.assign(L,{onLoad:E,onError:V})):L.class+=" q-img__image--loaded",h("div",{class:"q-img__container absolute-full",key:"img"+r},h("img",L))}function j(){return m.value!==!0?h("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},Y(n[d.value===!0?"error":"default"])):h("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},n.loading!==void 0?n.loading():e.noSpinner===!0?void 0:[h(Z,{color:e.spinnerColor,size:e.spinnerSize})])}return H(x()),K(()=>{f=!0,a!==null&&(clearTimeout(a),a=null)}),()=>{const r=[];return s.value!==null&&r.push(h("div",{key:"filler",style:s.value})),d.value!==!0&&(i[0].value!==null&&r.push(I(0)),i[1].value!==null&&r.push(I(1))),r.push(h(X,{name:"q-transition--fade"},j)),h("div",{class:Q.value,style:U.value,role:"img","aria-label":e.alt},r)}}});const Ce={name:"CallMenu",data(){return{calls:[],currentCall:null,currentUser:this.$authStore.currentUser}},computed:{otherCalls(){return this.currentCall?this.calls.filter(e=>e.id!=this.currentCall.id):[]},menuItems(){return this.$userHasAnyGroups(["applicant"])?[{name:"My Proposals",icon:"note",route:"/applicant/proposals"},{name:"Profile",icon:"person",route:"/account/profile"}]:this.$userHasAnyGroups(["reviewer"])?[{name:"Reviews",icon:"note",route:"/proposal-reviews"},{name:"Profile",icon:"person",route:"/account/profile"}]:this.$userHasAnyGroups(["grants_officer"])?[{name:"All Proposals",icon:"note",route:"/proposals"},{name:"Profile",icon:"person",route:"/account/profile"}]:[]}},created(){F().then(e=>{if(this.calls=e,this.calls.length){var n=this.calls[0];this.setCurrentCall(this.$dataStore.currentCall||n)}else this.setCurrentCall({title:"No Call Found"})})},methods:{navigateTo(e){this.$router.push(e)},changeCurrentCall(e){this.setCurrentCall(e),window.location="/"},setCurrentCall(e){this.currentCall=e,this.$dataStore.setCall(this.currentCall)}}},ve={key:0},ye={key:0};function Se(e,n,c,C,s,a){const f=S("router-link");return s.currentUser&&e.$userHasAnyGroups(["grants_officer"])?(u(),M("div",ve,[s.calls.length?(u(),M("div",ye,[t(B,null,{default:l(()=>[(u(!0),M(ee,null,te(s.calls,i=>{var o;return w((u(),g($,{key:i.id,active:i.id==((o=s.currentCall)==null?void 0:o.id),"active-class":"bg-primary text-white",clickable:"",onClick:m=>a.changeCurrentCall(i)},{default:l(()=>[t(p,null,{default:l(()=>[t(k,null,{default:l(()=>[_(A(i.title),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["active","onClick"])),[[b]])}),128))]),_:1}),t(de,{spaced:""})])):q("",!0),t(B,null,{default:l(()=>[t(f,{to:"/calls"},{default:l(()=>[w((u(),g($,{clickable:""},{default:l(()=>[t(p,null,{default:l(()=>[t(k,null,{default:l(()=>[_(" See all calls ...")]),_:1})]),_:1})]),_:1})),[[b]])]),_:1}),t(f,{to:"/calls/create"},{default:l(()=>[w((u(),g($,{clickable:""},{default:l(()=>[t(p,null,{default:l(()=>[t(k,null,{default:l(()=>[_(" Create New Call ")]),_:1})]),_:1})]),_:1})),[[b]])]),_:1})]),_:1})])):q("",!0)}var we=P(Ce,[["render",Se]]);const $e={name:"MainLayout",components:{CallMenu:we,DropdownCallMenu:fe},data(){return{leftDrawerOpen:!1,calls:[],currentCall:null}},computed:{otherCalls(){return this.currentCall?this.calls.filter(e=>e.id!=this.currentCall.id):[]}},created(){this.$authStore.currentUser||(location.href="/index/account/signin"),this.getEntity()},methods:{toggleLeftDrawer(){this.leftDrawerOpen=!this.leftDrawerOpen},async getEntity(){const e=await this.$api.get("entities/");this.entity=e.data[0],this.$dataStore.setEntity(this.entity),this.getCalls()},getCalls(){F().then(e=>{if(this.calls=e,this.calls.length)if(this.$userHasAnyGroups(["applicant","reviewer"])){var n=this.calls.find(C=>C.id==this.entity.current_call);n?this.setCurrentCall(n||{title:"No Call Found"}):this.$router.push("/no-call-found")}else{var c=this.calls[0];this.setCurrentCall(this.$dataStore.currentCall||c)}else this.setCurrentCall({title:"No Call Found"}),this.$userHasAnyGroups(["grants_officer"])?this.$router.push("/calls"):this.$router.push("/no-call-found")})},changeCurrentCall(e){this.setCurrentCall(e),window.location.reload()},setCurrentCall(e){this.currentCall=e,this.$dataStore.setCall(this.currentCall)},logout(){this.$utilsStore.setLoading(!0),this.$api.get("/accounts/logout/").then(e=>{this.$router.push("/index/account/signin"),this.$authStore.clearUserAndToken(),this.$utilsStore.setLoading(!1)})}}},ke={key:1},be={class:"text-orange-3 q-px-xs"};function Qe(e,n,c,C,s,a){const f=S("loading-component"),i=S("DropdownCallMenu"),o=S("CallMenu"),m=S("router-view");return s.currentCall?(u(),g(se,{key:0,view:"hHh Lpr lFf"},{default:l(()=>[t(f),t(ue,{elevated:""},{default:l(()=>[t(ie,null,{default:l(()=>{var d,Q;return[t(le,{flat:"",dense:"",round:"",icon:"menu","aria-label":"Menu",onClick:a.toggleLeftDrawer},null,8,["onClick"]),t(ae,null,{default:l(()=>[_(" Muni RIF "),e.$userHasAnyGroups(["grants_officer"])?(u(),g(i,{key:0,color:""})):(u(),M("span",ke,[t(T,{name:"arrow_right",size:"md"}),_(" "+A(this.currentCall.title),1)]))]),_:1}),re("div",be,[t(ne,{split:"",color:"grey-2","text-color":"black",rounded:"",icon:"person",to:"/account/profile",label:`${(d=e.$authStore.currentUser)==null?void 0:d.first_name} ${(Q=e.$authStore.currentUser)==null?void 0:Q.last_name}`},{default:l(()=>[t(B,null,{default:l(()=>[w((u(),g($,{clickable:"",to:"/account/profile"},{default:l(()=>[t(p,{side:""},{default:l(()=>[t(T,{name:"person"})]),_:1}),t(p,null,{default:l(()=>[t(k,null,{default:l(()=>[_("Profile")]),_:1})]),_:1})]),_:1})),[[b]]),w((u(),g($,{clickable:"",onClick:a.logout},{default:l(()=>[t(p,{side:""},{default:l(()=>[t(T,{name:"logout"})]),_:1}),t(p,null,{default:l(()=>[t(k,null,{default:l(()=>[_("Logout")]),_:1})]),_:1})]),_:1},8,["onClick"])),[[b]])]),_:1})]),_:1},8,["label"])])]}),_:1})]),_:1}),t(ce,{modelValue:s.leftDrawerOpen,"onUpdate:modelValue":n[0]||(n[0]=d=>s.leftDrawerOpen=d),class:"bg-grey-2",bordered:"",width:220},{default:l(()=>[t(pe,{src:me,"spinner-color":"primary","spinner-size":"72px"}),t(o)]),_:1},8,["modelValue"]),t(oe,null,{default:l(()=>[t(m)]),_:1})]),_:1})):q("",!0)}var tt=P($e,[["render",Qe]]);export{tt as default};
