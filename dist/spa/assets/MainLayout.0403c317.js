import{n as N,m as K,s as y,E as X,y as Y,p as h,a7 as Z,I as ee,x as te,_ as q,r as _,o as u,j as m,f as t,w as l,F as z,k as F,g as S,e as g,h as C,t as A,v as w,l as le,i as re}from"./index.3ceec1d0.js";import{Q as ne}from"./QToolbarTitle.07383659.js";import{Q as ae}from"./QChip.992f8412.js";import{Q as ie,a as oe,b as se}from"./QLayout.068da9d3.js";import{Q as ue}from"./QHeader.0a6aa35f.js";import{Q as ce}from"./QDrawer.d997af1a.js";import{a as B}from"./api.cfee13da.js";import{Q as $}from"./QItemLabel.10f5b6db.js";import{Q as k,a as b}from"./QItem.0066d918.js";import{Q as L}from"./QList.6907dda0.js";import{Q as R}from"./QSeparator.f2419a3c.js";import{C as Q}from"./ClosePopup.78ca8335.js";import{Q as fe}from"./QBtnDropdown.0bf88a3c.js";import{_ as de}from"./logo.151e68dc.js";import"./use-dark.cdc1981a.js";import"./scroll.1f71a2f6.js";import"./use-prevent-scroll.1aecfb27.js";import"./use-timeout.a878214f.js";import"./TouchPan.3fb84e77.js";import"./touch.3df10340.js";import"./selection.6ac5d2d4.js";import"./format.3e32b8d9.js";import"./axios.4b02a74d.js";import"./focusout.b7dd7394.js";import"./focus-manager.b507780d.js";import"./QBtnGroup.fa193a84.js";import"./QMenu.e361c0a0.js";import"./use-transition.0c217553.js";import"./uid.42677368.js";const he={ratio:[String,Number]};function me(e,o){return N(()=>{const f=Number(e.ratio||(o!==void 0?o.value:void 0));return isNaN(f)!==!0&&f>0?{paddingBottom:`${100/f}%`}:null})}const ge=16/9;var pe=K({name:"QImg",props:{...he,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:ge},placeholderSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(e,{slots:o,emit:f}){const M=y(e.initialRatio),a=me(e,M);let i=null,c=!1;const n=[y(null),y(P())],s=y(0),d=y(!1),p=y(!1),v=N(()=>`q-img q-img--${e.noNativeMenu===!0?"no-":""}menu`),T=N(()=>({width:e.width,height:e.height})),O=N(()=>`q-img__image ${e.imgClass!==void 0?e.imgClass+" ":""}q-img__image--with${e.noTransition===!0?"out":""}-transition`),V=N(()=>({...e.imgStyle,objectFit:e.fit,objectPosition:e.position}));X(()=>U(),I);function U(){return e.src||e.srcset||e.sizes?{src:e.src,srcset:e.srcset,sizes:e.sizes}:null}function P(){return e.placeholderSrc!==void 0?{src:e.placeholderSrc}:null}function I(r){i!==null&&(clearTimeout(i),i=null),p.value=!1,r===null?(d.value=!1,n[s.value^1].value=P()):d.value=!0,n[s.value].value=r}function j({target:r}){c!==!0&&(i!==null&&(clearTimeout(i),i=null),M.value=r.naturalHeight===0?.5:r.naturalWidth/r.naturalHeight,x(r,1))}function x(r,D){c===!0||D===1e3||(r.complete===!0?E(r):i=setTimeout(()=>{i=null,x(r,D+1)},50))}function E(r){c!==!0&&(s.value=s.value^1,n[s.value].value=null,d.value=!1,p.value=!1,f("load",r.currentSrc||r.src))}function W(r){i!==null&&(clearTimeout(i),i=null),d.value=!1,p.value=!0,n[s.value].value=null,n[s.value^1].value=P(),f("error",r)}function G(r){const D=n[r].value,H={key:"img_"+r,class:O.value,style:V.value,crossorigin:e.crossorigin,decoding:e.decoding,referrerpolicy:e.referrerpolicy,height:e.height,width:e.width,loading:e.loading,fetchpriority:e.fetchpriority,"aria-hidden":"true",draggable:e.draggable,...D};return s.value===r?(H.class+=" q-img__image--waiting",Object.assign(H,{onLoad:j,onError:W})):H.class+=" q-img__image--loaded",h("div",{class:"q-img__container absolute-full",key:"img"+r},h("img",H))}function J(){return d.value!==!0?h("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},ee(o[p.value===!0?"error":"default"])):h("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},o.loading!==void 0?o.loading():e.noSpinner===!0?void 0:[h(te,{color:e.spinnerColor,size:e.spinnerSize})])}return I(U()),Y(()=>{c=!0,i!==null&&(clearTimeout(i),i=null)}),()=>{const r=[];return a.value!==null&&r.push(h("div",{key:"filler",style:a.value})),p.value!==!0&&(n[0].value!==null&&r.push(G(0)),n[1].value!==null&&r.push(G(1))),r.push(h(Z,{name:"q-transition--fade"},J)),h("div",{class:v.value,style:T.value,role:"img","aria-label":e.alt},r)}}});const _e={name:"CallMenu",data(){return{calls:[],currentCall:null,currentUser:this.$authStore.currentUser}},computed:{otherCalls(){return this.currentCall?this.calls.filter(e=>e.id!=this.currentCall.id):[]},menuItems(){return this.$userHasAnyGroups(["applicant"])?[{name:"My Proposals",icon:"note",route:"/applicant/proposals"},{name:"Profile",icon:"person",route:"/account/profile"}]:this.$userHasAnyGroups(["reviewer"])?[{name:"Reviews",icon:"note",route:"/proposal-reviews"},{name:"Profile",icon:"person",route:"/account/profile"}]:this.$userHasAnyGroups(["grants_officer"])?[{name:"All Proposals",icon:"note",route:"/proposals"},{name:"Profile",icon:"person",route:"/account/profile"}]:[]}},created(){B().then(e=>{if(this.calls=e,this.calls.length){var o=this.calls[0];this.setCurrentCall(this.$dataStore.currentCall||o)}else this.setCurrentCall({title:"No Call Found"})})},methods:{navigateTo(e){this.$router.push(e)},changeCurrentCall(e){this.setCurrentCall(e),window.location="/"},setCurrentCall(e){this.currentCall=e,this.$dataStore.setCall(this.currentCall)}}},Ce={key:0},ve={key:0};function ye(e,o,f,M,a,i){const c=_("router-link");return a.currentUser&&e.$userHasAnyGroups(["grants_officer"])?(u(),m("div",Ce,[a.calls.length?(u(),m("div",ve,[t(L,null,{default:l(()=>[(u(!0),m(z,null,F(a.calls,n=>{var s;return S((u(),g(k,{key:n.id,active:n.id==((s=a.currentCall)==null?void 0:s.id),"active-class":"bg-primary text-white",clickable:"",onClick:d=>i.changeCurrentCall(n)},{default:l(()=>[t(b,null,{default:l(()=>[t($,null,{default:l(()=>[C(A(n.title),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["active","onClick"])),[[Q]])}),128))]),_:1}),t(R,{spaced:""})])):w("",!0),t(L,null,{default:l(()=>[t(c,{to:"/calls"},{default:l(()=>[S((u(),g(k,{clickable:""},{default:l(()=>[t(b,null,{default:l(()=>[t($,null,{default:l(()=>[C(" See all calls ...")]),_:1})]),_:1})]),_:1})),[[Q]])]),_:1}),t(c,{to:"/calls/create"},{default:l(()=>[S((u(),g(k,{clickable:""},{default:l(()=>[t(b,null,{default:l(()=>[t($,null,{default:l(()=>[C(" Create New Call ")]),_:1})]),_:1})]),_:1})),[[Q]])]),_:1})]),_:1})])):w("",!0)}var Se=q(_e,[["render",ye]]);const we={name:"CallMenu",data(){return{calls:[],currentCall:null,currentUser:this.$authStore.currentUser}},computed:{otherCalls(){return this.currentCall?this.calls.filter(e=>e.id!=this.currentCall.id):[]},menuItems(){return this.$userHasAnyGroups(["applicant"])?[{name:"My Proposals",icon:"note",route:"/applicant/proposals"},{name:"Profile",icon:"person",route:"/account/profile"}]:this.$userHasAnyGroups(["reviewer"])?[{name:"Reviews",icon:"note",route:"/proposal-reviews"},{name:"Profile",icon:"person",route:"/account/profile"}]:this.$userHasAnyGroups(["grants_officer"])?[{name:"All Proposals",icon:"note",route:"/proposals"},{name:"Profile",icon:"person",route:"/account/profile"}]:[]}},created(){B().then(e=>{if(this.calls=e,this.calls.length){var o=this.calls[0];this.setCurrentCall(this.$dataStore.currentCall||o)}else this.setCurrentCall({title:"No Call Found"})})},methods:{navigateTo(e){this.$router.push(e)},changeCurrentCall(e){this.setCurrentCall(e),window.location="/"},setCurrentCall(e){this.currentCall=e,this.$dataStore.setCall(this.currentCall)}}},$e={key:0},ke={key:0},be={key:0},Qe={key:1};function Me(e,o,f,M,a,i){const c=_("router-link");return a.currentCall?(u(),m("span",$e,[a.currentUser&&e.$userHasAnyGroups(["grants_officer"])?(u(),g(fe,{key:0,split:"",color:"white",flat:"","no-caps":"",icon:"folder",label:a.currentCall.title,onClick:o[0]||(o[0]=n=>this.$router.push(`/calls/${a.currentCall.id}`))},{default:l(()=>[e.$userHasAnyGroups(["grants_officer"])?(u(),m("div",ke,[a.calls.length?(u(),m("div",be,[t(L,null,{default:l(()=>[(u(!0),m(z,null,F(a.calls,n=>{var s;return S((u(),g(k,{key:n.id,active:n.id==((s=a.currentCall)==null?void 0:s.id),"active-class":"bg-primary text-white",clickable:"",onClick:d=>i.changeCurrentCall(n)},{default:l(()=>[t(b,null,{default:l(()=>[t($,null,{default:l(()=>[C(A(n.title),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["active","onClick"])),[[Q]])}),128))]),_:1}),t(R,{spaced:""})])):w("",!0),t(L,null,{default:l(()=>[t(c,{to:"/calls"},{default:l(()=>[S((u(),g(k,{clickable:""},{default:l(()=>[t(b,null,{default:l(()=>[t($,null,{default:l(()=>[C(" See all calls ...")]),_:1})]),_:1})]),_:1})),[[Q]])]),_:1}),t(c,{to:"/calls/create"},{default:l(()=>[S((u(),g(k,{clickable:""},{default:l(()=>[t(b,null,{default:l(()=>[t($,null,{default:l(()=>[C(" Create New Call ")]),_:1})]),_:1})]),_:1})),[[Q]])]),_:1})]),_:1})])):w("",!0)]),_:1},8,["label"])):(u(),m("span",Qe," > "+A(a.currentCall.title),1))])):w("",!0)}var Ne=q(we,[["render",Me]]);const Te={name:"MainLayout",components:{CallMenu:Se,DropdownCallMenu:Ne},data(){return{leftDrawerOpen:!1,calls:[],currentCall:null}},computed:{otherCalls(){return this.currentCall?this.calls.filter(e=>e.id!=this.currentCall.id):[]}},created(){this.$authStore.currentUser||(location.href="/index/account/signin"),this.getCalls()},methods:{toggleLeftDrawer(){this.leftDrawerOpen=!this.leftDrawerOpen},getCalls(){B().then(e=>{if(this.calls=e,this.calls.length){var o=this.calls[0];this.setCurrentCall(o)}else this.setCurrentCall({title:"No Call Found"}),this.$userHasAnyGroups(["grants_officer"])?this.$router.push("/calls"):this.$router.push("/no-call-found")})},changeCurrentCall(e){this.setCurrentCall(e),window.location.reload()},setCurrentCall(e){this.currentCall=e,this.$dataStore.setCall(this.currentCall)},logout(){this.$utilsStore.setLoading(!0),this.$api.get("/accounts/logout/").then(e=>{this.$authStore.clearUserAndToken(),this.$router.push("/login"),this.$utilsStore.setLoading(!1)})}}},De={class:"text-orange-3 q-px-xs"};function He(e,o,f,M,a,i){const c=_("loading-component"),n=_("DropdownCallMenu"),s=_("router-link"),d=_("CallMenu"),p=_("router-view");return a.currentCall?(u(),g(se,{key:0,view:"hHh Lpr lFf"},{default:l(()=>[t(c),t(ue,{elevated:""},{default:l(()=>[t(ie,null,{default:l(()=>[t(le,{flat:"",dense:"",round:"",icon:"menu","aria-label":"Menu",onClick:i.toggleLeftDrawer},null,8,["onClick"]),t(ne,null,{default:l(()=>[C(" Muni RIF "),t(n)]),_:1}),re("div",De,[t(s,{to:"/account/profile"},{default:l(()=>{var v,T;return[t(ae,{class:"glossy",icon:"person",label:`${(v=e.$authStore.currentUser)==null?void 0:v.first_name} ${(T=e.$authStore.currentUser)==null?void 0:T.last_name}`},null,8,["label"])]}),_:1})])]),_:1})]),_:1}),t(ce,{modelValue:a.leftDrawerOpen,"onUpdate:modelValue":o[0]||(o[0]=v=>a.leftDrawerOpen=v),class:"bg-grey-2",bordered:"",width:220},{default:l(()=>[t(pe,{src:de,"spinner-color":"primary","spinner-size":"72px"}),t(d)]),_:1},8,["modelValue"]),t(oe,null,{default:l(()=>[t(p)]),_:1})]),_:1})):w("",!0)}var ot=q(Te,[["render",He]]);export{ot as default};
