import{l as _,k as G,p as h,C as E,v as W,m,a5 as J,G as K,u as X,_ as P,r as v,o as g,h as k,a as l,w as r,F as Y,i as Z,e as Q,c as w,f as $,t as ee,s as z,j as te,g as le}from"./index.9b6d8f02.js";import{Q as re}from"./QToolbarTitle.11babbcc.js";import{Q as ae}from"./QChip.4ed0a923.js";import{Q as ne,a as ie,b as oe}from"./QLayout.ecade0b0.js";import{Q as se}from"./QHeader.a1c6fc1d.js";import{Q as ue}from"./QDrawer.0a52857b.js";import{a as F}from"./api.ead6a8e5.js";import{Q as T}from"./QItemLabel.ba99c664.js";import{Q as L,a as N}from"./QItem.7adbf461.js";import{Q as I}from"./QList.afbd39be.js";import{Q as ce}from"./QSeparator.b2724df3.js";import{C as q}from"./ClosePopup.8d4debee.js";import{_ as de}from"./logo.151e68dc.js";import"./use-dark.8dc51c8e.js";import"./scroll.18b40ccd.js";import"./use-prevent-scroll.149239bb.js";import"./use-timeout.da7d71c6.js";import"./TouchPan.1d3dae1b.js";import"./touch.3df10340.js";import"./selection.cce177a4.js";import"./format.3e32b8d9.js";import"./axios.2dc59f53.js";import"./portal.127dfe2c.js";const fe={ratio:[String,Number]};function me(e,i){return _(()=>{const d=Number(e.ratio||(i!==void 0?i.value:void 0));return isNaN(d)!==!0&&d>0?{paddingBottom:`${100/d}%`}:null})}const ge=16/9;var he=G({name:"QImg",props:{...fe,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:ge},placeholderSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(e,{slots:i,emit:d}){const C=h(e.initialRatio),u=me(e,C);let a=null,c=!1;const n=[h(null),h(b())],o=h(0),f=h(!1),s=h(!1),p=_(()=>`q-img q-img--${e.noNativeMenu===!0?"no-":""}menu`),H=_(()=>({width:e.width,height:e.height})),R=_(()=>`q-img__image ${e.imgClass!==void 0?e.imgClass+" ":""}q-img__image--with${e.noTransition===!0?"out":""}-transition`),O=_(()=>({...e.imgStyle,objectFit:e.fit,objectPosition:e.position}));E(()=>M(),B);function M(){return e.src||e.srcset||e.sizes?{src:e.src,srcset:e.srcset,sizes:e.sizes}:null}function b(){return e.placeholderSrc!==void 0?{src:e.placeholderSrc}:null}function B(t){a!==null&&(clearTimeout(a),a=null),s.value=!1,t===null?(f.value=!1,n[o.value^1].value=b()):f.value=!0,n[o.value].value=t}function V({target:t}){c!==!0&&(a!==null&&(clearTimeout(a),a=null),C.value=t.naturalHeight===0?.5:t.naturalWidth/t.naturalHeight,D(t,1))}function D(t,S){c===!0||S===1e3||(t.complete===!0?A(t):a=setTimeout(()=>{a=null,D(t,S+1)},50))}function A(t){c!==!0&&(o.value=o.value^1,n[o.value].value=null,f.value=!1,s.value=!1,d("load",t.currentSrc||t.src))}function U(t){a!==null&&(clearTimeout(a),a=null),f.value=!1,s.value=!0,n[o.value].value=null,n[o.value^1].value=b(),d("error",t)}function x(t){const S=n[t].value,y={key:"img_"+t,class:R.value,style:O.value,crossorigin:e.crossorigin,decoding:e.decoding,referrerpolicy:e.referrerpolicy,height:e.height,width:e.width,loading:e.loading,fetchpriority:e.fetchpriority,"aria-hidden":"true",draggable:e.draggable,...S};return o.value===t?(y.class+=" q-img__image--waiting",Object.assign(y,{onLoad:V,onError:U})):y.class+=" q-img__image--loaded",m("div",{class:"q-img__container absolute-full",key:"img"+t},m("img",y))}function j(){return f.value!==!0?m("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},K(i[s.value===!0?"error":"default"])):m("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},i.loading!==void 0?i.loading():e.noSpinner===!0?void 0:[m(X,{color:e.spinnerColor,size:e.spinnerSize})])}return B(M()),W(()=>{c=!0,a!==null&&(clearTimeout(a),a=null)}),()=>{const t=[];return u.value!==null&&t.push(m("div",{key:"filler",style:u.value})),s.value!==!0&&(n[0].value!==null&&t.push(x(0)),n[1].value!==null&&t.push(x(1))),t.push(m(J,{name:"q-transition--fade"},j)),m("div",{class:p.value,style:H.value,role:"img","aria-label":e.alt},t)}}});const _e={name:"CallMenu",data(){return{calls:[],currentCall:null}},computed:{otherCalls(){return this.currentCall?this.calls.filter(e=>e.id!=this.currentCall.id):[]},menuItems(){return this.$userHasAnyGroups(["applicant"])?[{name:"My Proposals",icon:"note",route:"/applicant/proposals"},{name:"Profile",icon:"person",route:"/account/profile"}]:this.$userHasAnyGroups(["reviewer"])?[{name:"Reviews",icon:"note",route:"/proposal-reviews"},{name:"Profile",icon:"person",route:"/account/profile"}]:this.$userHasAnyGroups(["grants_officer"])?[{name:"All Proposals",icon:"note",route:"/proposals"},{name:"Profile",icon:"person",route:"/account/profile"}]:[]}},created(){F().then(e=>{if(this.calls=e,this.calls.length){var i=this.calls[0];this.setCurrentCall(this.$dataStore.currentCall||i)}else this.setCurrentCall({title:"No Call Found"})})},methods:{navigateTo(e){this.$router.push(e)},changeCurrentCall(e){this.setCurrentCall(e),window.location="/"},setCurrentCall(e){this.currentCall=e,this.$dataStore.setCall(this.currentCall)}}},ve={key:0},Ce={key:0};function pe(e,i,d,C,u,a){const c=v("router-link");return e.$userHasAnyGroups(["grants_officer"])?(g(),k("div",ve,[u.calls.length?(g(),k("div",Ce,[l(I,null,{default:r(()=>[(g(!0),k(Y,null,Z(u.calls,n=>{var o;return Q((g(),w(L,{key:n.id,active:n.id==((o=u.currentCall)==null?void 0:o.id),"active-class":"bg-primary text-white",clickable:"",onClick:f=>a.changeCurrentCall(n)},{default:r(()=>[l(N,null,{default:r(()=>[l(T,null,{default:r(()=>[$(ee(n.title),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["active","onClick"])),[[q]])}),128))]),_:1}),l(ce,{spaced:""})])):z("",!0),l(I,null,{default:r(()=>[l(c,{to:"/calls"},{default:r(()=>[Q((g(),w(L,{clickable:""},{default:r(()=>[l(N,null,{default:r(()=>[l(T,null,{default:r(()=>[$(" See all calls ...")]),_:1})]),_:1})]),_:1})),[[q]])]),_:1}),l(c,{to:"/calls/create"},{default:r(()=>[Q((g(),w(L,{clickable:""},{default:r(()=>[l(N,null,{default:r(()=>[l(T,null,{default:r(()=>[$(" Create New Call ")]),_:1})]),_:1})]),_:1})),[[q]])]),_:1})]),_:1})])):z("",!0)}var Se=P(_e,[["render",pe]]);const ye={name:"MainLayout",components:{CallMenu:Se},data(){return{leftDrawerOpen:!1,calls:[],currentCall:null}},computed:{otherCalls(){return this.currentCall?this.calls.filter(e=>e.id!=this.currentCall.id):[]}},created(){this.$authStore.currentUser||(location.href="/index/account/signin"),F().then(e=>{if(this.calls=e,this.calls.length){var i=this.calls[0];this.setCurrentCall(this.$dataStore.currentCall||i)}else this.setCurrentCall({title:"No Call Found"})})},methods:{toggleLeftDrawer(){this.leftDrawerOpen=!this.leftDrawerOpen},changeCurrentCall(e){this.setCurrentCall(e),window.location.reload()},setCurrentCall(e){this.currentCall=e,this.$dataStore.setCall(this.currentCall)},logout(){this.$utilsStore.setLoading(!0),this.$api.get("/accounts/logout/").then(e=>{this.$authStore.clearUserAndToken(),this.$router.push("/login"),this.$utilsStore.setLoading(!1)})}}},we={class:"text-orange-3 q-px-xs"};function $e(e,i,d,C,u,a){const c=v("loading-component"),n=v("router-link"),o=v("CallMenu"),f=v("router-view");return g(),w(oe,{view:"hHh Lpr lFf"},{default:r(()=>[l(c),l(se,{elevated:""},{default:r(()=>[l(ne,null,{default:r(()=>[l(te,{flat:"",dense:"",round:"",icon:"menu","aria-label":"Menu",onClick:a.toggleLeftDrawer},null,8,["onClick"]),l(re,null,{default:r(()=>[$(" MuniRIF ")]),_:1}),le("div",we,[l(n,{to:"/account/profile"},{default:r(()=>{var s,p;return[l(ae,{class:"glossy",icon:"person",label:`${(s=e.$authStore.currentUser)==null?void 0:s.first_name} ${(p=e.$authStore.currentUser)==null?void 0:p.last_name}`},null,8,["label"])]}),_:1})])]),_:1})]),_:1}),l(ue,{modelValue:u.leftDrawerOpen,"onUpdate:modelValue":i[0]||(i[0]=s=>u.leftDrawerOpen=s),class:"bg-grey-2",bordered:"",width:220},{default:r(()=>[l(he,{src:de,"spinner-color":"primary","spinner-size":"72px"}),l(o)]),_:1},8,["modelValue"]),l(ie,null,{default:r(()=>[l(f)]),_:1})]),_:1})}var Ee=P(ye,[["render",$e]]);export{Ee as default};
