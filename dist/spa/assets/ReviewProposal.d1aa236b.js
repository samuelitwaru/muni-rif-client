import{Q}from"./QToolbarTitle.42ac391f.js";import{Q as T}from"./QBtnToggle.eedf6bc2.js";import{_ as b,o as r,j as l,f as t,w as m,h as V,t as p,i as n,v as k,r as c,e as d,F as B,k as C,g as h,aV as f,Q as M}from"./index.f337fba3.js";import{Q as w}from"./QCard.be6f1227.js";import{P as A}from"./ProposalHeader.81d3d872.js";import{Q as H}from"./QCircularProgress.a5385098.js";import{Q as L}from"./QCardSection.fe503a8b.js";import{P as N,B as I,T as z}from"./BudgetItems.2186d8e1.js";import"./QBtnGroup.88d9ef78.js";import"./use-form.e7940d77.js";import"./use-dark.1793b84e.js";import"./QMarkupTable.6b8f96f3.js";import"./format.3e32b8d9.js";import"./QChip.3c79b892.js";const D={props:["score","section"],name:"ScoreView"},E={key:0};function j(s,i,o,y,e,g){return o.score?(r(),l("div",E,[t(w,{class:"flex q-my-sm items-center",flat:"",bordered:""},{default:m(()=>[t(L,null,{default:m(()=>[t(H,{"show-value":"","font-size":"12px",value:o.score[o.section.name]/o.section.max_score*100,size:"50px",thickness:.22,color:"teal","track-color":"grey-3",class:"q-ma-md"},{default:m(()=>[V(p(o.score[o.section.name])+"/"+p(o.section.max_score),1)]),_:1},8,["value"])]),_:1}),n("div",null,p(o.score[`${o.section.name}_comment`]||"No comment"),1)]),_:1})])):k("",!0)}var F=b(D,[["render",j]]);const O={props:["score","section","proposal"],name:"ScoreView",components:{ProposalAttachments:N,BudgetItems:I,TeamMembers:z}},R={key:3},U=["innerHTML"];function $(s,i,o,y,e,g){const v=c("ProposalAttachments"),x=c("BudgetItems"),u=c("TeamMembers");return r(),l("div",null,[o.section.name=="attachments"?(r(),d(v,{key:0})):o.section.name=="summary_budget"?(r(),d(x,{key:1})):o.section.name=="team"?(r(),d(u,{key:2})):(r(),l("div",R,[t(w,{flat:"",bordered:"",class:"q-pa-sm q-my-sm"},{default:m(()=>{var _;return[n("div",{style:{overflow:"auto","min-height":"5rem"},innerHTML:((_=o.proposal)==null?void 0:_[o.section.name])||""},null,8,U)]}),_:1})]))])}var G=b(O,[["render",$]]);const J={name:"ReviewProposal",components:{ProposalHeader:A,ScoreView:F,SectionView:G},data(){return{tab:"proposal",sections:[],proposal:{},score:null,content:`
      <p>
        Lorem ipsum dolor sit amet consectetur, adipisicing elit. Obcaecati
        natus animi, et itaque ea tempora, exercitationem nemo nobis eos quos
        corrupti quasi cupiditate recusandae magnam, quis dicta facere dolore
        blanditiis.
      </p>`}},created(){this.getProposal(),this.getSections()},computed:{scoresAreValid(){if(this.score&&this.sections){console.log(this.score);for(let s=0;s<this.sections.length;s++){const i=this.sections[s];if(i.max_score>0&&this.score[i.name]===null)return this.$bus.emit("score-updated",!1),!1}}return this.$bus.emit("score-updated",!0),!0}},methods:{getProposal(){this.$api.get(`proposals/${this.$route.params.proposal_id}/`).then(s=>{this.proposal=s.data,this.$proposalStore.setProposal(this.proposal),this.getScore()})},getScore(){var s;this.$api.get(`scores/?user=${((s=this.$authStore.currentUser)==null?void 0:s.id)||0}&proposal=${this.$route.params.proposal_id}`).then(i=>{i.data.length==1&&(this.score=i.data[0])})},getSections(){this.$api.get("sections/").then(s=>{this.sections=s.data})}}},K=["id"],W={class:"q-pa-sm"},X={class:"flex"},Y={key:0},Z={class:"q-my-sm"},ee={class:"bg-grey-0"},oe={class:"text-caption text-grey-8"},se=n("hr",{id:"solution",class:"section-separator"},null,-1);function te(s,i,o,y,e,g){const v=c("accept-review"),x=c("ProposalHeader"),u=c("SectionView"),_=c("score-editor"),P=c("ScoreView");return r(),l("div",null,[t(v,{proposal:e.proposal,score:e.score},null,8,["proposal","score"]),t(x),(r(!0),l(B,null,C(e.sections,a=>{var S;return r(),l("div",{key:a.id},[n("hr",{id:a.name,class:"section-separator"},null,8,K),n("div",W,[t(Q,{class:"flex justify-between"},{default:m(()=>[n("div",X,p(a.title),1)]),_:2},1024),a.max_score>0?(r(),l("div",Y,[n("div",null,[t(T,{class:"q-mt-xs",square:"",style:{border:"1px #dddddd solid"},glossy:"",padding:"5px 30px",modelValue:e.tab,"onUpdate:modelValue":i[0]||(i[0]=q=>e.tab=q),color:"white","text-color":"black","toggle-text-color":"white",unelevated:"",bordered:"","toggle-color":"red",options:[{label:"Content",value:"proposal"},{label:"Guidelines",value:"guidelines"},{label:"Scores",value:"scores"}]},null,8,["modelValue"])]),h(t(u,{proposal:e.proposal,section:a},null,8,["proposal","section"]),[[f,e.tab=="proposal"]]),a.max_score>0?h((r(),d(_,{key:0,min:0,max:a.max_score,proposal:e.proposal,section:a,score:e.score},null,8,["max","proposal","section","score"])),[[f,e.tab=="scores"]]):k("",!0),h(t(P,{section:a,score:e.score},null,8,["section","score"]),[[f,e.tab=="scores"&&((S=e.score)==null?void 0:S.status)=="COMPLETED"]]),h(n("div",Z,[t(w,{class:"flex no-wrap q-pa-sm",flat:"",bordered:""},{default:m(()=>[t(M,{size:"md",class:"q-pr-sm",name:"info_outline"}),n("div",ee,[n("small",oe,p(a.description),1)])]),_:2},1024)],512),[[f,e.tab=="guidelines"]])])):(r(),d(u,{key:1,proposal:e.proposal,section:a},null,8,["proposal","section"]))])])}),128)),V(" "+p(g.scoresAreValid)+" ",1),se])}var ve=b(J,[["render",te]]);export{ve as default};
