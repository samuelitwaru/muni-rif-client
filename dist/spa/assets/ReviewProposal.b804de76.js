import{Q as q}from"./QToolbarTitle.42c6491d.js";import{Q}from"./QBtnToggle.ae653b8f.js";import{_ as x,o as r,j as l,f as t,w as m,h as T,t as p,i as n,v as k,r as c,e as d,F as B,k as C,g as h,aZ as f,Q as M}from"./index.0c070ef5.js";import{Q as b}from"./QCard.63eb6402.js";import{P as H}from"./ProposalHeader.a7b13f0d.js";import{Q as L}from"./QCircularProgress.c52100be.js";import{Q as N}from"./QCardSection.cb2f8249.js";import{P as A,B as I,T as z}from"./BudgetItems.62ae8deb.js";import"./QBtnGroup.a75b0bd4.js";import"./use-form.e5c6d76e.js";import"./use-dark.f75a96f1.js";import"./QMarkupTable.8c21dc1a.js";import"./format.2bc25e5f.js";import"./QChip.6de0f260.js";const D={props:["score","section"],name:"ScoreView"},E={key:0};function $(s,i,o,w,e,y){return o.score?(r(),l("div",E,[t(b,{class:"flex q-my-sm items-center",flat:"",bordered:""},{default:m(()=>[t(N,null,{default:m(()=>[t(L,{"show-value":"","font-size":"12px",value:o.score[o.section.name]/o.section.max_score*100,size:"50px",thickness:.22,color:"teal","track-color":"grey-3",class:"q-ma-md"},{default:m(()=>[T(p(o.score[o.section.name])+"/"+p(o.section.max_score),1)]),_:1},8,["value"])]),_:1}),n("div",null,p(o.score[`${o.section.name}_comment`]||"No comment"),1)]),_:1})])):k("",!0)}var j=x(D,[["render",$]]);const F={props:["score","section","proposal"],name:"ScoreView",components:{ProposalAttachments:A,BudgetItems:I,TeamMembers:z}},O={key:3},R=["innerHTML"];function U(s,i,o,w,e,y){const g=c("ProposalAttachments"),v=c("BudgetItems"),u=c("TeamMembers");return r(),l("div",null,[o.section.name=="attachments"?(r(),d(g,{key:0})):o.section.name=="summary_budget"?(r(),d(v,{key:1})):o.section.name=="team"?(r(),d(u,{key:2})):(r(),l("div",O,[t(b,{flat:"",bordered:"",class:"q-pa-sm q-my-sm"},{default:m(()=>{var _;return[n("div",{style:{overflow:"auto","min-height":"5rem"},innerHTML:((_=o.proposal)==null?void 0:_[o.section.name])||""},null,8,R)]}),_:1})]))])}var G=x(F,[["render",U]]);const Z={name:"ReviewProposal",components:{ProposalHeader:H,ScoreView:j,SectionView:G},data(){return{tab:"proposal",sections:[],proposal:{},score:null,content:`
      <p>
        Lorem ipsum dolor sit amet consectetur, adipisicing elit. Obcaecati
        natus animi, et itaque ea tempora, exercitationem nemo nobis eos quos
        corrupti quasi cupiditate recusandae magnam, quis dicta facere dolore
        blanditiis.
      </p>`}},created(){this.getProposal(),this.getSections()},computed:{scoresAreValid(){if(this.score&&this.sections){console.log(this.score);for(let s=0;s<this.sections.length;s++){const i=this.sections[s];if(i.max_score>0&&this.score[i.name]===null)return this.$bus.emit("score-updated",!1),!1}}return this.$bus.emit("score-updated",!0),!0}},methods:{getProposal(){this.$api.get(`proposals/${this.$route.params.proposal_id}/`).then(s=>{this.proposal=s.data,this.$proposalStore.setProposal(this.proposal),this.getScore()})},getScore(){var s;this.$api.get(`scores/?user=${((s=this.$authStore.currentUser)==null?void 0:s.id)||0}&proposal=${this.$route.params.proposal_id}`).then(i=>{i.data.length==1&&(this.score=i.data[0])})},getSections(){this.$api.get("sections/").then(s=>{this.sections=s.data})}}},J=["id"],K={class:"q-pa-sm"},W={class:"flex"},X={key:0},Y={class:"q-my-sm"},ee={class:"bg-grey-0"},oe={class:"text-caption text-grey-8"},se=n("hr",{id:"solution",class:"section-separator"},null,-1);function te(s,i,o,w,e,y){const g=c("accept-review"),v=c("ProposalHeader"),u=c("SectionView"),_=c("score-editor"),V=c("ScoreView");return r(),l("div",null,[t(g,{proposal:e.proposal,score:e.score},null,8,["proposal","score"]),t(v),(r(!0),l(B,null,C(e.sections,a=>{var S;return r(),l("div",{key:a.id},[n("hr",{id:a.name,class:"section-separator"},null,8,J),n("div",K,[t(q,{class:"flex justify-between"},{default:m(()=>[n("div",W,p(a.title),1)]),_:2},1024),a.max_score>0?(r(),l("div",X,[n("div",null,[t(Q,{class:"q-mt-xs",square:"",style:{border:"1px #dddddd solid"},glossy:"",padding:"5px 30px",modelValue:e.tab,"onUpdate:modelValue":i[0]||(i[0]=P=>e.tab=P),color:"white","text-color":"black","toggle-text-color":"white",unelevated:"",bordered:"","toggle-color":"red",options:[{label:"Content",value:"proposal"},{label:"Guidelines",value:"guidelines"},{label:"Scores",value:"scores"}]},null,8,["modelValue"])]),h(t(u,{proposal:e.proposal,section:a},null,8,["proposal","section"]),[[f,e.tab=="proposal"]]),a.max_score>0?h((r(),d(_,{key:0,min:0,max:a.max_score,proposal:e.proposal,section:a,score:e.score},null,8,["max","proposal","section","score"])),[[f,e.tab=="scores"]]):k("",!0),h(t(V,{section:a,score:e.score},null,8,["section","score"]),[[f,e.tab=="scores"&&((S=e.score)==null?void 0:S.status)=="COMPLETED"]]),h(n("div",Y,[t(b,{class:"flex no-wrap q-pa-sm",flat:"",bordered:""},{default:m(()=>[t(M,{size:"md",class:"q-pr-sm",name:"info_outline"}),n("div",ee,[n("small",oe,p(a.description),1)])]),_:2},1024)],512),[[f,e.tab=="guidelines"]])])):(r(),d(u,{key:1,proposal:e.proposal,section:a},null,8,["proposal","section"]))])])}),128)),se])}var ve=x(Z,[["render",te]]);export{ve as default};
