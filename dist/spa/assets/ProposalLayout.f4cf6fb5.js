import{_ as D,J as L,aL as V,r as i,o as r,e as p,w as t,f as o,l as u,i as m,h as c,t as n,u as h,j as d,F as _,k as $,g as w,R as g}from"./index.321f2a75.js";import{Q as B}from"./QChip.663160d5.js";import{Q as I}from"./QToolbarTitle.216897de.js";import{Q as q,a as H,b as N}from"./QLayout.9cc7f7f2.js";import{Q as O}from"./QHeader.30fc154d.js";import{Q as T}from"./QCard.605795d5.js";import{Q as b,a as k}from"./QItem.911ffa5f.js";import{Q}from"./QSeparator.378e1fe5.js";import{Q as P}from"./QList.f06dd0ed.js";import{Q as R}from"./QDrawer.d3745e34.js";import{P as j}from"./ProposalHeader.114962cd.js";import"./use-dark.89890713.js";import"./scroll.36e3c4a7.js";import"./use-prevent-scroll.3531c3d8.js";import"./use-timeout.87ac005e.js";import"./TouchPan.2fdd2902.js";import"./touch.3df10340.js";import"./selection.0bf889d4.js";import"./format.2bc25e5f.js";import"./QMarkupTable.6ac75ced.js";const E=L({components:{ProposalHeader:j},name:"ProposalLayout",data(){return{leftDrawerOpen:!1,proposal:{},proposalFiles:[],score:{},sections:[],menuItems:[{icon:"bluetooth",label:"Reviews",link:"/reviews"},{icon:"bluetooth",label:"Reports",link:"/reports"}]}},created(){V(this.$options.name),this.getProposal()},methods:{getProposal(){this.$utilsStore.setLoading(!0),this.$api.get(`proposals/${this.$route.params.proposal_id}/`).then(e=>{this.proposal=e.data,this.$proposalStore.setProposal(this.proposal),this.getProposalFiles(),this.getSections(),this.getScore(),this.$utilsStore.setLoading(!1)})},getProposalFiles(){this.$api.get(`files/?proposal_id=${this.$route.params.proposal_id}`).then(e=>{this.proposalFiles=e.data})},getScore(){var e;this.$api.get(`scores/?user=${((e=this.$authStore.currentUser)==null?void 0:e.id)||0}&proposal=${this.$route.params.proposal_id}`).then(s=>{s.data.length==1&&(this.score=s.data[0])})},deleteFile(e){confirm("Delete this File?")&&this.$api.delete(`files/${e}/`).then(s=>{this.getProposalFiles()})},getSections(){this.$api.get("sections/").then(e=>{this.sections=e.data})},downloadProposal(){this.$api.get(`proposals/${this.$route.params.proposal_id}/pdf/download/`).then(e=>{e.status==200&&window.open(e.data.file_url,"_blank")})},openFile(e){window.open(e)}}}),U={class:"flex"},z=["href"],G={class:"q-px-sm border q-my-auto q-mr-sm"},J=["href"];function M(e,s,A,K,W,X){const y=i("loading-component"),v=i("score-sheet"),S=i("router-link"),F=i("ProposalHeader"),C=i("router-view");return e.$proposalStore.currentProposal?(r(),p(N,{key:0,view:"lHh Lpr lFf"},{default:t(()=>[o(y),o(O,{elevated:""},{default:t(()=>[o(q,{class:"bg-white text-dark"},{default:t(()=>{var a;return[o(u,{flat:"",dense:"",round:"",icon:"menu","aria-label":"Menu",onClick:s[0]||(s[0]=l=>e.leftDrawerOpen=!e.leftDrawerOpen)}),o(I,{class:"flex justify-between"},{default:t(()=>{var l,f;return[m("div",null,[c(n((l=e.$proposalStore.currentProposal)==null?void 0:l.title)+" ",1),o(B,{color:"secondary",class:"text-white",size:"md",label:(f=e.$proposalStore.currentProposal)==null?void 0:f.status},null,8,["label"])])]}),_:1}),m("div",U,[o(v),((a=e.$proposalStore.currentProposal)==null?void 0:a.status)!="EDITING"?(r(),p(u,{key:0,color:"primary",icon:"download",dense:"",label:"download",onClick:e.downloadProposal},null,8,["onClick"])):h("",!0)])]}),_:1})]),_:1}),o(R,{modelValue:e.leftDrawerOpen,"onUpdate:modelValue":s[1]||(s[1]=a=>e.leftDrawerOpen=a),class:"bg-grey-2","show-if-above":"",bordered:"",width:220},{default:t(()=>[o(T,{flat:"",class:"q-py-sm"},{default:t(()=>[o(S,{to:"/go/proposals/submitted"},{default:t(()=>[o(u,{class:"q-mx-sm",block:"",color:"primary",flat:"",icon:"arrow_back",label:"Back"})]),_:1})]),_:1}),o(P,null,{default:t(()=>[(r(!0),d(_,null,$(e.sections,(a,l)=>(r(),d("a",{key:a.id,href:`/proposals/${e.$route.params.proposal_id}${a.ref}`},[w((r(),p(b,{clickable:""},{default:t(()=>[m("div",G,n(l+1),1),o(k,null,{default:t(()=>[c(n(a.title),1)]),_:2},1024)]),_:2},1024)),[[g]]),o(Q)],8,z))),128))]),_:1}),o(P,null,{default:t(()=>[(r(!0),d(_,null,$(e.menuItems,a=>(r(),d("a",{key:a.name,href:`/proposals/${e.$route.params.proposal_id}${a.link}`},[w((r(),p(b,{clickable:""},{default:t(()=>[o(k,null,{default:t(()=>[c(n(a.label),1)]),_:2},1024)]),_:2},1024)),[[g]]),o(Q)],8,J))),128))]),_:1})]),_:1},8,["modelValue"]),o(H,null,{default:t(()=>[o(F),o(C)]),_:1})]),_:1})):h("",!0)}var $e=D(E,[["render",M]]);export{$e as default};
