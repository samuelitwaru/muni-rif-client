import{Q as F}from"./QToolbarTitle.b2035143.js";import{_ as S,o as a,j as r,f as m,w as D,i as e,u as $,g as v,H as k,t as d,F as g,k as y,l as C,aN as N,aO as B,b0 as Q,r as b,h as V,e as q,Q as G}from"./index.3671a223.js";import{Q as U}from"./QCard.78b7c44d.js";import{Q as A}from"./QCardSection.54f69d89.js";import{Q as x}from"./QMarkupTable.4c97a209.js";import{Q as R}from"./QEditor.009376af.js";import{Q as M}from"./QForm.2b098fed.js";import{c as W}from"./index.5ce110aa.js";import{Q as H}from"./QChip.05b39f31.js";import L from"./ExpenseReports.a469faa6.js";import{P as O}from"./ProposalReportsEditor.db8109c2.js";import"./use-dark.dbbd0c9d.js";import"./QBtnDropdown.2865dd5c.js";import"./QBtnGroup.e3f02e69.js";import"./QMenu.2c83730c.js";import"./use-timeout.26584f0c.js";import"./focus-manager.b507780d.js";import"./use-transition.1d5f554b.js";import"./scroll.624406d4.js";import"./uid.42677368.js";import"./QItem.41d22b85.js";import"./use-split-attrs.d467856c.js";import"./FileUploader2.120f1e55.js";import"./QSeparator.f4e84234.js";import"./QItemLabel.8f35a27f.js";import"./QList.ae152641.js";import"./QUploader.c38a58bd.js";import"./QCircularProgress.dc7b61af.js";import"./format.2bc25e5f.js";import"./use-file.e5919774.js";import"./QDialog.8d8d8cb6.js";import"./use-prevent-scroll.53dc6540.js";const X={name:"BudgetEditor",data(){return{formData:{item:"",quantity:1,units:"",unit_cost:0,proposal:this.$route.params.proposal_id},updateFormData:{id:0,item:"",quantity:1,units:"",unit_cost:0,proposal:this.$route.params.proposal_id},items:[]}},computed:{totalBudget(){var t=0;for(let o=0;o<this.items.length;o++){const n=this.items[o];t+=n.unit_cost*n.quantity}return t}},created(){this.init()},methods:{init(){this.getBudgets()},getBudgets(){this.$api.get(`budgets/?proposal=${this.$route.params.proposal_id}`).then(t=>{this.items=t.data})},createBudget(){this.$api.post("budgets/",this.formData).then(t=>{(t.status=201)&&(this.items.unshift(t.data),this.resetFormData(),this.$bus.emit("proposal-updated",!0))})},deleteItem(t){confirm("Delete this budget?")&&this.$api.delete(`budgets/${t}`).then(o=>{o.status==204&&(this.init(),this.$bus.emit("proposal-updated",!0))})},resetFormData(){this.formData={item:"",quantity:1,units:"",unit_cost:0,proposal:this.$route.params.proposal_id}}}},E=t=>(N("data-v-34a02e97"),t=t(),B(),t),j=E(()=>e("th",{align:"left"},"Item",-1)),z=E(()=>e("th",{align:"left"},"Quantity",-1)),J=E(()=>e("th",{align:"left"},"Units",-1)),K=E(()=>e("th",{align:"left"},"Unit Cost (UGX)",-1)),Y=E(()=>e("th",{align:"left"},"Total Cost (UGX)",-1)),Z={key:0,align:"left"},tt={key:0,class:"q-tr--no-hover"},et={key:0},ot={class:"q-tr--no-hover"},st=E(()=>e("th",{class:"text-left",colspan:"4"},"Total",-1)),at={class:"text-left"},rt=E(()=>e("td",null,null,-1));function it(t,o,n,_,s,u){return a(),r("div",null,[m(x,{class:"q-my-sm",flat:"",bordered:""},{default:D(()=>{var c,p;return[e("thead",null,[e("tr",null,[j,z,J,K,Y,((c=t.$proposalStore.currentProposal)==null?void 0:c.status)=="EDITING"?(a(),r("th",Z," Actions ")):$("",!0)])]),e("tbody",null,[((p=t.$proposalStore.currentProposal)==null?void 0:p.status)=="EDITING"?(a(),r("tr",tt,[e("td",null,[v(e("input",{"onUpdate:modelValue":o[0]||(o[0]=i=>s.formData.item=i),style:{display:"block",width:"100%"},type:"text"},null,512),[[k,s.formData.item]])]),e("td",null,[v(e("input",{"onUpdate:modelValue":o[1]||(o[1]=i=>s.formData.quantity=i),style:{display:"block",width:"100%"},type:"number"},null,512),[[k,s.formData.quantity]])]),e("td",null,[v(e("input",{"onUpdate:modelValue":o[2]||(o[2]=i=>s.formData.units=i),style:{display:"block",width:"100%"},type:"text"},null,512),[[k,s.formData.units]])]),e("td",null,[v(e("input",{"onUpdate:modelValue":o[3]||(o[3]=i=>s.formData.unit_cost=i),style:{display:"block",width:"100%"},type:"number"},null,512),[[k,s.formData.unit_cost]])]),e("td",null,d(t.$commaSeparator(s.formData.unit_cost*s.formData.quantity)),1),e("td",null,[e("button",{onClick:o[4]||(o[4]=(...i)=>u.createBudget&&u.createBudget(...i))},"Add")])])):$("",!0),(a(!0),r(g,null,y(s.items,i=>{var f;return a(),r("tr",{class:"q-tr--no-hover",key:i.id},[e("td",null,d(i.item),1),e("td",null,d(i.quantity),1),e("td",null,d(i.units),1),e("td",null,d(t.$commaSeparator(i.unit_cost))+" UGX",1),e("td",null,d(t.$commaSeparator(i.unit_cost*i.quantity))+" UGX",1),((f=t.$proposalStore.currentProposal)==null?void 0:f.status)=="EDITING"?(a(),r("td",et,[m(C,{icon:"delete",flat:"",color:"negative",onClick:I=>u.deleteItem(i.id)},null,8,["onClick"])])):$("",!0)])}),128)),e("tr",ot,[st,e("th",at,d(t.$commaSeparator(u.totalBudget))+" UGX",1),rt])])]}),_:1})])}var lt=S(X,[["render",it],["__scopeId","data-v-34a02e97"]]);const nt={name:"TeamEditor",data(){return{formData:{full_name:"",email:"",telephone:"",proposal:this.$route.params.proposal_id,role:"PI"},formErrors:{},items:[],options:[{name:"PI",value:"PI"},{name:"Co PI",value:"Co PI"},{name:"MEMBER",value:"MEMBER"}]}},created(){this.init()},methods:{init(){this.getTeams()},getTeams(){this.$api.get(`teams/?proposal=${this.$route.params.proposal_id}`).then(t=>{this.items=t.data})},createTeam(){this.$api.post("teams/",this.formData).then(t=>{(t.status=201)&&(this.formErrors={},this.items.push(t.data),this.resetFormData(),this.$bus.emit("proposal-updated",!0))}).catch(t=>{this.formErrors=t.response.data,this.$utilsStore.setLoading(!1)})},deleteItem(t){confirm("Delete this team?")&&this.$api.delete(`teams/${t}`).then(o=>{o.status==204&&(this.init(),this.$bus.emit("proposal-updated",!0))})},resetFormData(){this.formData={full_name:"",email:"",telephone:"",proposal:this.$route.params.proposal_id}}}},dt=e("th",{align:"left"},"Full Name",-1),ut=e("th",{align:"left"},"Email",-1),pt=e("th",{align:"left"},"Telephone",-1),mt=e("th",{align:"left"},"Role",-1),ct={key:0,align:"left"},ht={key:0,class:"q-tr--no-hover"},_t={class:"text-red"},ft={class:"q-ma-xs"},gt={class:"text-red"},yt={class:"q-ma-xs"},$t={class:"text-red"},Dt={class:"q-ma-xs"},vt=["value"],bt={key:0};function kt(t,o,n,_,s,u){return a(),r("div",null,[m(x,{class:"q-my-sm",flat:"",bordered:""},{default:D(()=>{var c,p,i,f,I;return[e("thead",null,[e("tr",null,[dt,ut,pt,mt,((c=t.$proposalStore.currentProposal)==null?void 0:c.status)=="EDITING"?(a(),r("th",ct," Actions ")):$("",!0)])]),e("tbody",null,[((p=t.$proposalStore.currentProposal)==null?void 0:p.status)=="EDITING"&&s.items.length<5?(a(),r("tr",ht,[e("td",null,[v(e("input",{"onUpdate:modelValue":o[0]||(o[0]=l=>s.formData.full_name=l),style:{display:"block",width:"100%"},type:"text"},null,512),[[k,s.formData.full_name]]),e("div",_t,[e("ul",ft,[(a(!0),r(g,null,y((i=s.formErrors)==null?void 0:i.full_name,l=>(a(),r("li",{key:l},d(l),1))),128))])])]),e("td",null,[v(e("input",{"onUpdate:modelValue":o[1]||(o[1]=l=>s.formData.email=l),style:{display:"block",width:"100%"},type:"email"},null,512),[[k,s.formData.email]]),e("div",gt,[e("ul",yt,[(a(!0),r(g,null,y((f=s.formErrors)==null?void 0:f.email,l=>(a(),r("li",{key:l},d(l),1))),128))])])]),e("td",null,[v(e("input",{"onUpdate:modelValue":o[2]||(o[2]=l=>s.formData.telephone=l),style:{display:"block",width:"100%"},type:"text"},null,512),[[k,s.formData.telephone]]),e("div",$t,[e("ul",Dt,[(a(!0),r(g,null,y((I=s.formErrors)==null?void 0:I.telephone,l=>(a(),r("li",{key:l},d(l),1))),128))])])]),e("td",null,[v(e("select",{"onUpdate:modelValue":o[3]||(o[3]=l=>s.formData.role=l)},[(a(!0),r(g,null,y(s.options,l=>(a(),r("option",{key:l.name,value:l.name},d(l.value),9,vt))),128))],512),[[Q,s.formData.role]])]),e("td",null,[e("button",{onClick:o[4]||(o[4]=(...l)=>u.createTeam&&u.createTeam(...l))},"Add")])])):$("",!0),(a(!0),r(g,null,y(s.items,l=>{var h;return a(),r("tr",{class:"q-tr--no-hover",key:l.id},[e("td",null,d(l.full_name),1),e("td",null,d(l.email),1),e("td",null,d(l.telephone),1),e("td",null,d(l.role),1),((h=t.$proposalStore.currentProposal)==null?void 0:h.status)=="EDITING"?(a(),r("td",bt,[m(C,{icon:"delete",flat:"",color:"negative",onClick:T=>u.deleteItem(l.id)},null,8,["onClick"])])):$("",!0)])}),128))])]}),_:1})])}var Et=S(nt,[["render",kt]]);const It={name:"SectionEditor2",props:{proposal:{type:Object,required:!0},section:{type:Object,required:!0}},data(){return{loading:!1,showDialog:!1,formData:{}}},computed:{numWords(){return this.countWordsInHtml(this.formData[this.section.name]||"")}},methods:{updateSection(){this.$api.patch(`proposals/${this.$route.params.proposal_id}/`,this.formData).then(t=>{this.$emit("proposal-updated",t.data),this.$bus.emit("proposal-updated",t.data)})},countWordsInHtml(t){return W.load(t)("body").text().split(/\s+/).length-1},onPaste(t){if(t.target.nodeName==="INPUT")return;let o,n;t.preventDefault(),t.stopPropagation(),t.originalEvent&&t.originalEvent.clipboardData.getData?(o=t.originalEvent.clipboardData.getData("text/plain"),this.$refs.editorRef.runCmd("insertText",o)):t.clipboardData&&t.clipboardData.getData?(o=t.clipboardData.getData("text/plain"),this.$refs.editorRef.runCmd("insertText",o)):window.clipboardData&&window.clipboardData.getData&&(n||(n=!0,this.$refs.editorRef.runCmd("ms-pasteTextOnly",o)),n=!1)}},mounted(){this.formData[this.section.name]=this.proposal[this.section.name]||""},watch:{proposal(t){this.formData[this.section.name]=t[this.section.name]||""}}},St={key:0},qt={class:"scroll"},Tt={class:"text-caption text-grey-8",align:"right"},xt={key:0,class:"text-red text-caption"},Pt={key:1,class:"text-right"};function wt(t,o,n,_,s,u){var c,p;return((c=n.proposal)==null?void 0:c.status)=="EDITING"&&t.$authStore.currentUser.id==((p=n.proposal)==null?void 0:p.user)?(a(),r("div",St,[m(M,{onSubmit:u.updateSection,class:"q-gutter-md"},{default:D(()=>[e("div",qt,[m(R,{modelValue:s.formData[n.section.name],"onUpdate:modelValue":o[0]||(o[0]=i=>s.formData[n.section.name]=i),label:"Title of your proposal",outlined:"",required:"","min-height":"30vh",onBlur:u.updateSection,onPaste:u.onPaste,ref:"editorRef"},null,8,["modelValue","onBlur","onPaste"]),e("div",Tt,[u.numWords>n.section.word_limit?(a(),r("small",xt," Exceeded word limit ("+d(u.numWords)+"/"+d(n.section.lower_limit)+"-"+d(n.section.word_limit)+") ",1)):(a(),r("div",Pt," Number of Words ("+d(u.numWords)+"/"+d(n.section.lower_limit)+"-"+d(n.section.word_limit)+") ",1))])])]),_:1},8,["onSubmit"])])):$("",!0)}var Ut=S(It,[["render",wt]]);const Ct={name:"AttachmentEditor",data(){return{formData:{full_name:"",email:"",telephone:"",proposal:this.$route.params.proposal_id},attachments:[],attachmentsValid:!1}},created(){this.init()},methods:{init(){this.getAttachments()},getAttachments(){this.$api.get("attachments/").then(t=>{this.attachments=t.data,this.getFiles()})},getFiles(){for(let t=0;t<this.attachments.length;t++){const o=this.attachments[t];this.$api.get(`files/?proposal_id=${this.$route.params.proposal_id}&attachment_id=${o.id}`).then(n=>{var _=n.data;this.attachments.filter(s=>s.id==o.id)[0].files=_,t==this.attachments.length-1&&setTimeout(()=>{this.validateAttachments()},1e3)})}},validateAttachments(){let t=!0;return this.attachments.filter(n=>{var _;return n.is_required&&!((_=n.files)!=null&&_.length)}).length?t=!1:t=!0,this.$bus.emit("attachments-updated",t),t},deleteFile(t){confirm("Delete this File?")&&this.$api.delete(`files/${t}/`).then(o=>{o.status==204&&this.getFiles()})},openFile(t){window.open(t)}}},Ft=e("thead",null,[e("tr",null,[e("th",{align:"left"},"Title"),e("th",{align:"left",colspan:"2"},"Files")])],-1),Nt={key:0,class:"text-red"},Bt={class:"flex"};function Qt(t,o,n,_,s,u){const c=b("proposal-file-attachment");return a(),r("div",null,[m(x,{class:"q-my-sm",flat:"",bordered:""},{default:D(()=>[Ft,e("tbody",null,[(a(!0),r(g,null,y(s.attachments,p=>(a(),r("tr",{key:p.id},[e("td",null,[V(d(p.title)+" ",1),p.is_required?(a(),r("span",Nt,"*")):$("",!0)]),e("td",null,[e("div",Bt,[(a(!0),r(g,null,y(p.files,i=>(a(),q(H,{dense:"",key:i.id,class:"glossy",icon:"attachment",label:i.name,removable:t.$userHasAnyGroups(["applicant"])&&t.$authStore.currentUser.id==t.$proposalStore.currentProposal.user&&t.$proposalStore.currentProposal.status=="EDITING",clickable:"",onRemove:f=>u.deleteFile(i.id),onClick:f=>u.openFile(i.file)},null,8,["label","removable","onRemove","onClick"]))),128))])]),e("td",null,[m(c,{attachment_id:p.id,onFileUploaded:o[0]||(o[0]=i=>u.getFiles())},null,8,["attachment_id"])])]))),128))])]),_:1})])}var Vt=S(Ct,[["render",Qt]]);const Gt={components:{budgeteditor:lt,teameditor:Et,sectioneditor2:Ut,attachmentseditor:Vt,ExpenseReports:L,ProposalReportsEditor:O},data(){return{sections:[],proposal:{},score:null,content:`
      <p>
        Lorem ipsum dolor sit amet consectetur, adipisicing elit. Obcaecati
        natus animi, et itaque ea tempora, exercitationem nemo nobis eos quos
        corrupti quasi cupiditate recusandae magnam, quis dicta facere dolore
        blanditiis.
      </p>`}},created(){this.getProposal(),this.getSections()},methods:{getProposal(){this.$api.get(`proposals/${this.$route.params.proposal_id}/`).then(t=>{this.proposal=t.data,this.$proposalStore.setProposal(this.proposal),this.getScore()})},getScore(){var t;this.$api.get(`scores/?user=${((t=this.$authStore.currentUser)==null?void 0:t.id)||0}&proposal=${this.$route.params.proposal_id}`).then(o=>{o.data.length==1&&(this.score=o.data[0])})},getSections(){this.$api.get("sections/").then(t=>{this.sections=t.data})}}},At={class:"q-pa-sm"},Rt=["id"],Mt={class:"q-pa-sm"},Wt={class:"flex"},Ht={class:"bg-grey-0"},Lt={class:"text-caption text-grey-8"},Ot={class:"q-pt-sm"},Xt={key:0},jt={key:1},zt={key:2},Jt={key:3},Kt=["innerHTML"],Yt=e("hr",null,null,-1),Zt=e("hr",{id:"solution",class:"section-separator"},null,-1);function te(t,o,n,_,s,u){const c=b("budgeteditor"),p=b("teameditor"),i=b("attachmentseditor"),f=b("sectioneditor2"),I=b("ExpenseReports"),l=b("ProposalReportsEditor");return a(),r("div",At,[(a(!0),r(g,null,y(s.sections,h=>{var T,P;return a(),r("div",{key:h.id},[e("hr",{id:h.name,class:"section-separator"},null,8,Rt),e("div",Mt,[m(F,{class:"flex justify-between"},{default:D(()=>[e("div",Wt,d(h.title),1)]),_:2},1024),((T=t.$proposalStore.currentProposal)==null?void 0:T.status)=="EDITING"?(a(),q(U,{key:0,class:"flex no-wrap q-pa-sm",flat:"",bordered:""},{default:D(()=>[m(G,{size:"md",class:"q-pr-sm",name:"info_outline"}),e("div",Ht,[e("small",Lt,d(h.description),1)])]),_:2},1024)):$("",!0),e("div",Ot,[h.ref=="#summary_budget"?(a(),r("div",Xt,[m(c)])):h.ref=="#team"?(a(),r("div",jt,[m(p)])):h.ref=="#attachments"?(a(),r("div",zt,[m(i)])):(a(),r("div",Jt,[((P=t.$proposalStore.currentProposal)==null?void 0:P.status)=="EDITING"?(a(),q(f,{key:0,proposal:s.proposal,section:h,onProposalUpdated:o[0]||(o[0]=w=>{s.proposal=w,t.$proposalStore.setProposal(w)})},null,8,["proposal","section"])):(a(),q(U,{key:1,class:"my-card",flat:"",bordered:""},{default:D(()=>[m(A,null,{default:D(()=>[e("div",{innerHTML:s.proposal[h.name]},null,8,Kt)]),_:2},1024)]),_:2},1024))]))])])])}),128)),Yt,m(I),m(l),Zt])}var Ce=S(Gt,[["render",te]]);export{Ce as default};
