import{Q as v}from"./QChip.05b39f31.js";import{Q as F}from"./QMarkupTable.4c97a209.js";import{F as R}from"./FileUploader2.120f1e55.js";import{_ as $,r as k,o as s,j as l,f as S,w as y,i as t,F as u,k as c,t as m,e as h,u as g}from"./index.3671a223.js";const b={name:"ProposalReportsEditor",components:{FileUploader2:R},data(){return{reports:[],reporting_dates:[]}},created(){this.getReports(),this.getReportingSchedules()},methods:{getReports(){this.$api.get("reports/").then(e=>{this.reports=e.data,console.log("reports:",e.data)})},getReportingSchedules(){this.$api.get("reporting-dates/").then(e=>{this.reporting_dates=e.data})},validateAttachments(){let e=!0;return this.attachments.filter(i=>{var p;return i.is_required&&!((p=i.files)!=null&&p.length)}).length?e=!1:e=!0,this.$bus.emit("attachments-updated",e),e},deleteReport(e){confirm("Delete this Report?")&&this.$api.delete(`reports/${e}/`).then(r=>{r.status==204&&this.getReports()})},openFile(e){window.open(e)},getFileNameFromUrl(e){const r=e.split("/");return r[r.length-1]}}},E={class:"q-pa-md"},U=t("div",{class:"text-h6"},"Other Reports",-1),C=t("thead",null,[t("tr",null,[t("th",{align:"left"},"Title"),t("th",{align:"left"},"Due Date"),t("th",{align:"left",colspan:"2"},"Files")])],-1),D={class:"flex"},P={key:0,align:"center"},A=t("td",{colspan:"3"}," No report schedules found. ",-1),N=[A];function w(e,r,i,p,d,n){const f=k("FileUploader2");return s(),l("div",E,[U,S(F,{class:"q-my-sm",flat:"",bordered:""},{default:y(()=>[C,t("tbody",null,[(s(!0),l(u,null,c(d.reporting_dates,a=>(s(),l("tr",{key:a.id},[t("td",null,m(a.title),1),t("td",null,m(a.date),1),t("td",null,[t("div",D,[(s(!0),l(u,null,c(d.reports.filter(o=>o.reporting_date===a.id),o=>(s(),h(v,{dense:"",key:o.id,class:"glossy",icon:"attachment",label:n.getFileNameFromUrl(o.file),removable:e.$userHasAnyGroups(["applicant"])&&e.$authStore.currentUser.id==e.$proposalStore.currentProposal.user&&e.$proposalStore.currentProposal.status=="SELECTED",clickable:"",onRemove:_=>n.deleteReport(o.id),onClick:_=>n.openFile(o.file)},null,8,["label","removable","onRemove","onClick"]))),128))])]),t("td",null,[e.$userHasAnyGroups(["applicant"])&&e.$authStore.currentUser.id==e.$proposalStore.currentProposal.user&&e.$proposalStore.currentProposal.status=="SELECTED"?(s(),h(f,{key:0,onFileUploaded:r[0]||(r[0]=o=>n.getReports()),uploadUrl:"/reports/",multiple:!1,formData:{title:a.title,reporting_date:a.id,proposal:e.$route.params.proposal_id}},null,8,["formData"])):g("",!0)])]))),128)),d.reporting_dates.length==0?(s(),l("tr",P,N)):g("",!0)])]),_:1})])}var q=$(b,[["render",w]]);export{q as P};
