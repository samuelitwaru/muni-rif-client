import{Q as F}from"./QToolbarTitle.11babbcc.js";import{_ as I,o as l,h as i,a as p,w as _,g as e,s as g,e as f,E as $,t as d,F as D,i as b,j as U,aJ as x,aK as B,aR as C,r as k,c as S,Q}from"./index.9b6d8f02.js";import{Q as P}from"./QCard.4957859e.js";import{Q as G}from"./QCardSection.f9ea1c28.js";import{Q as q}from"./QMarkupTable.e680a5a9.js";import{Q as N}from"./QEditor.af7a7b9e.js";import{Q as V}from"./QForm.da5dcb33.js";import{c as A}from"./index.5ce110aa.js";import{Q as M}from"./QChip.4ed0a923.js";import"./use-dark.8dc51c8e.js";import"./QBtnDropdown.9d39cdb7.js";import"./QBtnGroup.cfd1d6a9.js";import"./QMenu.61fa0658.js";import"./selection.cce177a4.js";import"./use-timeout.da7d71c6.js";import"./focusout.e24e3d1a.js";import"./focus-manager.b507780d.js";import"./portal.127dfe2c.js";import"./use-transition.8872bac2.js";import"./scroll.18b40ccd.js";import"./uid.9faae8c0.js";import"./QItem.7adbf461.js";const W={name:"BudgetEditor",data(){return{formData:{item:"",quantity:1,units:"",unit_cost:0,proposal:this.$route.params.proposal_id},updateFormData:{id:0,item:"",quantity:1,units:"",unit_cost:0,proposal:this.$route.params.proposal_id},items:[]}},computed:{totalBudget(){var t=0;for(let o=0;o<this.items.length;o++){const r=this.items[o];t+=r.unit_cost*r.quantity}return t}},created(){this.init()},methods:{init(){this.getBudgets()},getBudgets(){this.$api.get(`budgets/?proposal=${this.$route.params.proposal_id}`).then(t=>{this.items=t.data})},createBudget(){this.$api.post("budgets/",this.formData).then(t=>{(t.status=201)&&(this.items.unshift(t.data),this.resetFormData(),this.$bus.emit("proposal-updated",!0))})},deleteItem(t){confirm("Delete this budget?")&&this.$api.delete(`budgets/${t}`).then(o=>{o.status==204&&(this.init(),this.$bus.emit("proposal-updated",!0))})},resetFormData(){this.formData={item:"",quantity:1,units:"",unit_cost:0,proposal:this.$route.params.proposal_id}}}},v=t=>(x("data-v-34a02e97"),t=t(),B(),t),R=v(()=>e("th",{align:"left"},"Item",-1)),H=v(()=>e("th",{align:"left"},"Quantity",-1)),X=v(()=>e("th",{align:"left"},"Units",-1)),j=v(()=>e("th",{align:"left"},"Unit Cost (UGX)",-1)),L=v(()=>e("th",{align:"left"},"Total Cost (UGX)",-1)),O={key:0,align:"left"},z={key:0,class:"q-tr--no-hover"},J={key:0},K={class:"q-tr--no-hover"},Y=v(()=>e("th",{class:"text-left",colspan:"4"},"Total",-1)),Z={class:"text-left"},tt=v(()=>e("td",null,null,-1));function et(t,o,r,y,a,n){return l(),i("div",null,[p(q,{class:"q-my-sm",flat:"",bordered:""},{default:_(()=>{var m,u;return[e("thead",null,[e("tr",null,[R,H,X,j,L,((m=t.$proposalStore.currentProposal)==null?void 0:m.status)=="EDITING"?(l(),i("th",O," Actions ")):g("",!0)])]),e("tbody",null,[((u=t.$proposalStore.currentProposal)==null?void 0:u.status)=="EDITING"?(l(),i("tr",z,[e("td",null,[f(e("input",{"onUpdate:modelValue":o[0]||(o[0]=s=>a.formData.item=s),style:{display:"block",width:"100%"},type:"text"},null,512),[[$,a.formData.item]])]),e("td",null,[f(e("input",{"onUpdate:modelValue":o[1]||(o[1]=s=>a.formData.quantity=s),style:{display:"block",width:"100%"},type:"number"},null,512),[[$,a.formData.quantity]])]),e("td",null,[f(e("input",{"onUpdate:modelValue":o[2]||(o[2]=s=>a.formData.units=s),style:{display:"block",width:"100%"},type:"text"},null,512),[[$,a.formData.units]])]),e("td",null,[f(e("input",{"onUpdate:modelValue":o[3]||(o[3]=s=>a.formData.unit_cost=s),style:{display:"block",width:"100%"},type:"number"},null,512),[[$,a.formData.unit_cost]])]),e("td",null,d(t.$commaSeparator(a.formData.unit_cost*a.formData.quantity)),1),e("td",null,[e("button",{onClick:o[4]||(o[4]=(...s)=>n.createBudget&&n.createBudget(...s))},"Add")])])):g("",!0),(l(!0),i(D,null,b(a.items,s=>{var h;return l(),i("tr",{class:"q-tr--no-hover",key:s.id},[e("td",null,d(s.item),1),e("td",null,d(s.quantity),1),e("td",null,d(s.units),1),e("td",null,d(t.$commaSeparator(s.unit_cost))+" UGX",1),e("td",null,d(t.$commaSeparator(s.unit_cost*s.quantity))+" UGX",1),((h=t.$proposalStore.currentProposal)==null?void 0:h.status)=="EDITING"?(l(),i("td",J,[p(U,{icon:"delete",flat:"",color:"negative",onClick:c=>n.deleteItem(s.id)},null,8,["onClick"])])):g("",!0)])}),128)),e("tr",K,[Y,e("th",Z,d(t.$commaSeparator(n.totalBudget))+" UGX",1),tt])])]}),_:1})])}var ot=I(W,[["render",et],["__scopeId","data-v-34a02e97"]]);const st={name:"TeamEditor",data(){return{formData:{full_name:"",email:"",telephone:"",proposal:this.$route.params.proposal_id},items:[],options:[{name:"PI",value:"PI"},{name:"Co PI",value:"Co PI"},{name:"MEMBER",value:"MEMBER"}]}},created(){this.init()},methods:{init(){this.getTeams()},getTeams(){this.$api.get(`teams/?proposal=${this.$route.params.proposal_id}`).then(t=>{this.items=t.data})},createTeam(){this.$api.post("teams/",this.formData).then(t=>{(t.status=201)&&(this.items.push(t.data),this.resetFormData(),this.$bus.emit("proposal-updated",!0))})},deleteItem(t){confirm("Delete this team?")&&this.$api.delete(`teams/${t}`).then(o=>{o.status==204&&(this.init(),this.$bus.emit("proposal-updated",!0))})},resetFormData(){this.formData={full_name:"",email:"",telephone:"",proposal:this.$route.params.proposal_id}}}},at=e("th",{align:"left"},"Full Name",-1),lt=e("th",{align:"left"},"Email",-1),it=e("th",{align:"left"},"Telephone",-1),rt=e("th",{align:"left"},"Role",-1),nt={key:0,align:"left"},dt={key:0,class:"q-tr--no-hover"},ut=["value"],pt={key:0};function mt(t,o,r,y,a,n){return l(),i("div",null,[p(q,{class:"q-my-sm",flat:"",bordered:""},{default:_(()=>{var m,u;return[e("thead",null,[e("tr",null,[at,lt,it,rt,((m=t.$proposalStore.currentProposal)==null?void 0:m.status)=="EDITING"?(l(),i("th",nt," Actions ")):g("",!0)])]),e("tbody",null,[((u=t.$proposalStore.currentProposal)==null?void 0:u.status)=="EDITING"&&a.items.length<5?(l(),i("tr",dt,[e("td",null,[f(e("input",{"onUpdate:modelValue":o[0]||(o[0]=s=>a.formData.full_name=s),style:{display:"block",width:"100%"},type:"text"},null,512),[[$,a.formData.full_name]])]),e("td",null,[f(e("input",{"onUpdate:modelValue":o[1]||(o[1]=s=>a.formData.email=s),style:{display:"block",width:"100%"},type:"email"},null,512),[[$,a.formData.email]])]),e("td",null,[f(e("input",{"onUpdate:modelValue":o[2]||(o[2]=s=>a.formData.telephone=s),style:{display:"block",width:"100%"},type:"text"},null,512),[[$,a.formData.telephone]])]),e("td",null,[f(e("select",{"onUpdate:modelValue":o[3]||(o[3]=s=>a.formData.role=s)},[(l(!0),i(D,null,b(a.options,s=>(l(),i("option",{key:s.name,value:s.name},d(s.value),9,ut))),128))],512),[[C,a.formData.role]])]),e("td",null,[e("button",{onClick:o[4]||(o[4]=(...s)=>n.createTeam&&n.createTeam(...s))},"Add")])])):g("",!0),(l(!0),i(D,null,b(a.items,s=>{var h;return l(),i("tr",{class:"q-tr--no-hover",key:s.id},[e("td",null,d(s.full_name),1),e("td",null,d(s.email),1),e("td",null,d(s.telephone),1),e("td",null,d(s.role),1),((h=t.$proposalStore.currentProposal)==null?void 0:h.status)=="EDITING"?(l(),i("td",pt,[p(U,{icon:"delete",flat:"",color:"negative",onClick:c=>n.deleteItem(s.id)},null,8,["onClick"])])):g("",!0)])}),128))])]}),_:1})])}var ct=I(st,[["render",mt]]);const ht={name:"SectionEditor2",props:{proposal:{type:Object,required:!0},section:{type:Object,required:!0}},data(){return{loading:!1,showDialog:!1,formData:{}}},computed:{numWords(){return this.countWordsInHtml(this.formData[this.section.name]||"")}},methods:{updateSection(){this.$api.patch(`proposals/${this.$route.params.proposal_id}/`,this.formData).then(t=>{this.$emit("proposal-updated",t.data),this.$bus.emit("proposal-updated",t.data)})},countWordsInHtml(t){return A.load(t)("body").text().split(/\s+/).length-1}},mounted(){this.formData[this.section.name]=this.proposal[this.section.name]||""},watch:{proposal(t){this.formData[this.section.name]=t[this.section.name]||""}}},_t={key:0},ft={class:"scroll"},gt={class:"text-caption text-grey-8",align:"right"},yt={key:0,class:"text-red text-caption"},$t={key:1,class:"text-right"};function vt(t,o,r,y,a,n){var m,u;return((m=r.proposal)==null?void 0:m.status)=="EDITING"&&t.$authStore.currentUser.id==((u=r.proposal)==null?void 0:u.user)?(l(),i("div",_t,[p(V,{onSubmit:n.updateSection,class:"q-gutter-md"},{default:_(()=>[e("div",ft,[p(N,{modelValue:a.formData[r.section.name],"onUpdate:modelValue":o[0]||(o[0]=s=>a.formData[r.section.name]=s),label:"Title of your proposal",outlined:"",required:"","min-height":"30vh",onBlur:n.updateSection},null,8,["modelValue","onBlur"]),e("div",gt,[n.numWords>r.section.word_limit?(l(),i("small",yt," Exceeded word limit ("+d(n.numWords)+"/"+d(r.section.word_limit)+") ",1)):(l(),i("div",$t," Number of Words ("+d(n.numWords)+"/"+d(r.section.word_limit)+") ",1))])])]),_:1},8,["onSubmit"])])):g("",!0)}var Dt=I(ht,[["render",vt]]);const bt={name:"AttachmentEditor",data(){return{formData:{full_name:"",email:"",telephone:"",proposal:this.$route.params.proposal_id},attachments:[]}},created(){this.init()},methods:{init(){this.getAttachments()},getAttachments(){this.$api.get("attachments/").then(t=>{this.attachments=t.data,this.getFiles()})},getFiles(){for(let t=0;t<this.attachments.length;t++){const o=this.attachments[t];this.$api.get(`files/?proposal_id=${this.$route.params.proposal_id}&attachment_id=${o.id}`).then(r=>{var y=r.data;this.attachments.filter(a=>a.id==o.id)[0].files=y,t==this.attachments.length-1&&this.$bus.emit("attachments-updated",this.validateAttachments())})}},validateAttachments(){var t;for(let o=0;o<this.attachments.length;o++){const r=this.attachments[o];if(((t=r==null?void 0:r.files)==null?void 0:t.length)==0)return!1}return!0},deleteFile(t){confirm("Delete this File?")&&this.$api.delete(`files/${t}/`).then(o=>{o.status==204&&this.getFiles()})},openFile(t){window.open(t)}}},kt=e("thead",null,[e("tr",null,[e("th",{align:"left"},"Title"),e("th",{align:"left",colspan:"2"},"Files")])],-1),It={class:"flex"};function St(t,o,r,y,a,n){const m=k("proposal-file-attachment");return l(),i("div",null,[p(q,{class:"q-my-sm",flat:"",bordered:""},{default:_(()=>[kt,e("tbody",null,[(l(!0),i(D,null,b(a.attachments,u=>(l(),i("tr",{key:u.id},[e("td",null,d(u.title),1),e("td",null,[e("div",It,[(l(!0),i(D,null,b(u.files,s=>(l(),S(M,{dense:"",key:s.id,class:"glossy",icon:"attachment",label:s.name,removable:t.$userHasAnyGroups(["applicant"])&&t.$authStore.currentUser.id==t.$proposalStore.currentProposal.user&&t.$proposalStore.currentProposal.status=="EDITING",clickable:"",onRemove:h=>n.deleteFile(s.id),onClick:h=>n.openFile(s.file)},null,8,["label","removable","onRemove","onClick"]))),128))])]),e("td",null,[p(m,{attachment_id:u.id,onFileUploaded:o[0]||(o[0]=s=>n.getFiles())},null,8,["attachment_id"])])]))),128))])]),_:1})])}var qt=I(bt,[["render",St]]);const Tt={components:{budgeteditor:ot,teameditor:ct,sectioneditor2:Dt,attachmentseditor:qt},data(){return{sections:[],proposal:{},score:null,content:`
      <p>
        Lorem ipsum dolor sit amet consectetur, adipisicing elit. Obcaecati
        natus animi, et itaque ea tempora, exercitationem nemo nobis eos quos
        corrupti quasi cupiditate recusandae magnam, quis dicta facere dolore
        blanditiis.
      </p>`}},created(){this.getProposal(),this.getSections()},methods:{getProposal(){this.$api.get(`proposals/${this.$route.params.proposal_id}/`).then(t=>{this.proposal=t.data,this.$proposalStore.setProposal(this.proposal),this.getScore()})},getScore(){var t;this.$api.get(`scores/?user=${((t=this.$authStore.currentUser)==null?void 0:t.id)||0}&proposal=${this.$route.params.proposal_id}`).then(o=>{o.data.length==1&&(this.score=o.data[0])})},getSections(){this.$api.get("sections/").then(t=>{this.sections=t.data})}}},Et={class:"q-pa-sm"},wt=["id"],Pt={class:"q-pa-sm"},Ut={class:"flex"},Ft={class:"bg-grey-0"},xt={class:"text-caption text-grey-8"},Bt={class:"q-pt-sm"},Ct={key:0},Qt={key:1},Gt={key:2},Nt={key:3},Vt=["innerHTML"],At=e("hr",{id:"solution",class:"section-separator"},null,-1);function Mt(t,o,r,y,a,n){const m=k("budgeteditor"),u=k("teameditor"),s=k("attachmentseditor"),h=k("sectioneditor2");return l(),i("div",Et,[(l(!0),i(D,null,b(a.sections,c=>{var T,E;return l(),i("div",{key:c.id},[e("hr",{id:c.name,class:"section-separator"},null,8,wt),e("div",Pt,[p(F,{class:"flex justify-between"},{default:_(()=>[e("div",Ut,d(c.title),1)]),_:2},1024),((T=t.$proposalStore.currentProposal)==null?void 0:T.status)=="EDITING"?(l(),S(P,{key:0,class:"flex no-wrap q-pa-sm",flat:"",bordered:""},{default:_(()=>[p(Q,{size:"md",class:"q-pr-sm",name:"info_outline"}),e("div",Ft,[e("small",xt,d(c.description),1)])]),_:2},1024)):g("",!0),e("div",Bt,[c.ref=="#summary_budget"?(l(),i("div",Ct,[p(m)])):c.ref=="#team"?(l(),i("div",Qt,[p(u)])):c.ref=="#attachments"?(l(),i("div",Gt,[p(s)])):(l(),i("div",Nt,[((E=t.$proposalStore.currentProposal)==null?void 0:E.status)=="EDITING"?(l(),S(h,{key:0,proposal:a.proposal,section:c,onProposalUpdated:o[0]||(o[0]=w=>{a.proposal=w,t.$proposalStore.setProposal(w)})},null,8,["proposal","section"])):(l(),S(P,{key:1,class:"my-card",flat:"",bordered:""},{default:_(()=>[p(G,null,{default:_(()=>[e("div",{innerHTML:a.proposal[c.name]},null,8,Vt)]),_:2},1024)]),_:2},1024))]))])])])}),128)),At])}var ue=I(Tt,[["render",Mt]]);export{ue as default};
