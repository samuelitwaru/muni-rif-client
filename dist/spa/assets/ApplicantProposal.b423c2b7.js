import{Q as F}from"./QToolbarTitle.bd27c268.js";import{_ as I,o as s,j as r,f as m,w as D,i as e,n as f,g as v,G as k,t as d,F as y,k as $,l as C,aN as N,aO as B,b0 as Q,r as b,h as G,e as P,Q as V}from"./index.e39be684.js";import{Q as U}from"./QCard.f9e0a707.js";import{Q as A}from"./QCardSection.1db827b1.js";import{Q as T}from"./QMarkupTable.c371dead.js";import{Q as R}from"./QEditor.524f73b9.js";import{Q as M}from"./QForm.bfc6ae96.js";import{c as W}from"./index.5ce110aa.js";import{Q as H}from"./QChip.19e4d28f.js";import L from"./ExpenseReports.c80f03fa.js";import{P as O}from"./ProposalReportsEditor.89e7243e.js";import"./use-dark.54601180.js";import"./QBtnDropdown.85fcf977.js";import"./QBtnGroup.223e6e8a.js";import"./QMenu.fcff140d.js";import"./use-timeout.65a9f0b9.js";import"./focus-manager.b507780d.js";import"./use-transition.c0c5474a.js";import"./scroll.eaa460d0.js";import"./uid.42677368.js";import"./QItem.c0795fab.js";import"./use-split-attrs.ff5e55ff.js";import"./FileUploader2.ca087439.js";import"./QSeparator.13d6beeb.js";import"./QItemLabel.aff81a70.js";import"./QList.521c8a93.js";import"./QUploader.cf856800.js";import"./QCircularProgress.97b714c3.js";import"./format.2bc25e5f.js";import"./use-file.2de82242.js";import"./QDialog.f5d6fd89.js";import"./use-prevent-scroll.92142e4c.js";const X={name:"BudgetEditor",data(){return{formData:{item:"",quantity:1,units:"",unit_cost:0,proposal:this.$route.params.proposal_id},updateFormData:{id:0,item:"",quantity:1,units:"",unit_cost:0,proposal:this.$route.params.proposal_id},items:[]}},computed:{totalBudget(){var t=0;for(let o=0;o<this.items.length;o++){const n=this.items[o];t+=n.unit_cost*n.quantity}return t}},created(){this.init()},methods:{init(){this.getBudgets()},getBudgets(){this.$api.get(`budgets/?proposal=${this.$route.params.proposal_id}`).then(t=>{this.items=t.data})},createBudget(){this.$api.post("budgets/",this.formData).then(t=>{(t.status=201)&&(this.items.unshift(t.data),this.resetFormData(),this.$bus.emit("proposal-updated",!0))})},deleteItem(t){confirm("Delete this budget?")&&this.$api.delete(`budgets/${t}`).then(o=>{o.status==204&&(this.init(),this.$bus.emit("proposal-updated",!0))})},resetFormData(){this.formData={item:"",quantity:1,units:"",unit_cost:0,proposal:this.$route.params.proposal_id}}}},S=t=>(N("data-v-34a02e97"),t=t(),B(),t),j=S(()=>e("th",{align:"left"},"Item",-1)),z=S(()=>e("th",{align:"left"},"Quantity",-1)),J=S(()=>e("th",{align:"left"},"Units",-1)),K=S(()=>e("th",{align:"left"},"Unit Cost (UGX)",-1)),Y=S(()=>e("th",{align:"left"},"Total Cost (UGX)",-1)),Z={key:0,align:"left"},tt={key:0,class:"q-tr--no-hover"},et={key:0},ot={class:"q-tr--no-hover"},st=S(()=>e("th",{class:"text-left",colspan:"4"},"Total",-1)),at={class:"text-left"},rt=S(()=>e("td",null,null,-1));function it(t,o,n,_,a,u){return s(),r("div",null,[m(T,{class:"q-my-sm",flat:"",bordered:""},{default:D(()=>{var c,p;return[e("thead",null,[e("tr",null,[j,z,J,K,Y,((c=t.$proposalStore.currentProposal)==null?void 0:c.status)=="EDITING"?(s(),r("th",Z," Actions ")):f("",!0)])]),e("tbody",null,[((p=t.$proposalStore.currentProposal)==null?void 0:p.status)=="EDITING"?(s(),r("tr",tt,[e("td",null,[v(e("input",{"onUpdate:modelValue":o[0]||(o[0]=i=>a.formData.item=i),style:{display:"block",width:"100%"},type:"text"},null,512),[[k,a.formData.item]])]),e("td",null,[v(e("input",{"onUpdate:modelValue":o[1]||(o[1]=i=>a.formData.quantity=i),style:{display:"block",width:"100%"},type:"number"},null,512),[[k,a.formData.quantity]])]),e("td",null,[v(e("input",{"onUpdate:modelValue":o[2]||(o[2]=i=>a.formData.units=i),style:{display:"block",width:"100%"},type:"text"},null,512),[[k,a.formData.units]])]),e("td",null,[v(e("input",{"onUpdate:modelValue":o[3]||(o[3]=i=>a.formData.unit_cost=i),style:{display:"block",width:"100%"},type:"number"},null,512),[[k,a.formData.unit_cost]])]),e("td",null,d(t.$commaSeparator(a.formData.unit_cost*a.formData.quantity)),1),e("td",null,[e("button",{onClick:o[4]||(o[4]=(...i)=>u.createBudget&&u.createBudget(...i))},"Add")])])):f("",!0),(s(!0),r(y,null,$(a.items,i=>{var g;return s(),r("tr",{class:"q-tr--no-hover",key:i.id},[e("td",null,d(i.item),1),e("td",null,d(i.quantity),1),e("td",null,d(i.units),1),e("td",null,d(t.$commaSeparator(i.unit_cost))+" UGX",1),e("td",null,d(t.$commaSeparator(i.unit_cost*i.quantity))+" UGX",1),((g=t.$proposalStore.currentProposal)==null?void 0:g.status)=="EDITING"?(s(),r("td",et,[m(C,{icon:"delete",flat:"",color:"negative",onClick:E=>u.deleteItem(i.id)},null,8,["onClick"])])):f("",!0)])}),128)),e("tr",ot,[st,e("th",at,d(t.$commaSeparator(u.totalBudget))+" UGX",1),rt])])]}),_:1})])}var lt=I(X,[["render",it],["__scopeId","data-v-34a02e97"]]);const nt={name:"TeamEditor",data(){return{formData:{full_name:"",email:"",telephone:"",proposal:this.$route.params.proposal_id,role:"PI"},formErrors:{},items:[],options:[{name:"PI",value:"PI"},{name:"Co PI",value:"Co PI"},{name:"MEMBER",value:"MEMBER"}]}},created(){this.init()},methods:{init(){this.getTeams()},getTeams(){this.$api.get(`teams/?proposal=${this.$route.params.proposal_id}`).then(t=>{this.items=t.data})},createTeam(){this.$api.post("teams/",this.formData).then(t=>{(t.status=201)&&(this.formErrors={},this.items.push(t.data),this.resetFormData(),this.$bus.emit("proposal-updated",!0))}).catch(t=>{this.formErrors=t.response.data,this.$utilsStore.setLoading(!1)})},deleteItem(t){confirm("Delete this team?")&&this.$api.delete(`teams/${t}`).then(o=>{o.status==204&&(this.init(),this.$bus.emit("proposal-updated",!0))})},resetFormData(){this.formData={full_name:"",email:"",telephone:"",proposal:this.$route.params.proposal_id}}}},dt=e("th",{align:"left"},"Full Name",-1),ut=e("th",{align:"left"},"Email",-1),pt=e("th",{align:"left"},"Telephone",-1),mt=e("th",{align:"left"},"Role",-1),ct={key:0,align:"left"},ht={key:0,class:"q-tr--no-hover"},_t={class:"text-red"},ft={class:"q-ma-xs"},gt={class:"text-red"},yt={class:"q-ma-xs"},$t={class:"text-red"},Dt={class:"q-ma-xs"},vt=["value"],bt={key:0};function kt(t,o,n,_,a,u){return s(),r("div",null,[m(T,{class:"q-my-sm",flat:"",bordered:""},{default:D(()=>{var c,p,i,g,E;return[e("thead",null,[e("tr",null,[dt,ut,pt,mt,((c=t.$proposalStore.currentProposal)==null?void 0:c.status)=="EDITING"?(s(),r("th",ct," Actions ")):f("",!0)])]),e("tbody",null,[((p=t.$proposalStore.currentProposal)==null?void 0:p.status)=="EDITING"&&a.items.length<5?(s(),r("tr",ht,[e("td",null,[v(e("input",{"onUpdate:modelValue":o[0]||(o[0]=l=>a.formData.full_name=l),style:{display:"block",width:"100%"},type:"text"},null,512),[[k,a.formData.full_name]]),e("div",_t,[e("ul",ft,[(s(!0),r(y,null,$((i=a.formErrors)==null?void 0:i.full_name,l=>(s(),r("li",{key:l},d(l),1))),128))])])]),e("td",null,[v(e("input",{"onUpdate:modelValue":o[1]||(o[1]=l=>a.formData.email=l),style:{display:"block",width:"100%"},type:"email"},null,512),[[k,a.formData.email]]),e("div",gt,[e("ul",yt,[(s(!0),r(y,null,$((g=a.formErrors)==null?void 0:g.email,l=>(s(),r("li",{key:l},d(l),1))),128))])])]),e("td",null,[v(e("input",{"onUpdate:modelValue":o[2]||(o[2]=l=>a.formData.telephone=l),style:{display:"block",width:"100%"},type:"text"},null,512),[[k,a.formData.telephone]]),e("div",$t,[e("ul",Dt,[(s(!0),r(y,null,$((E=a.formErrors)==null?void 0:E.telephone,l=>(s(),r("li",{key:l},d(l),1))),128))])])]),e("td",null,[v(e("select",{"onUpdate:modelValue":o[3]||(o[3]=l=>a.formData.role=l)},[(s(!0),r(y,null,$(a.options,l=>(s(),r("option",{key:l.name,value:l.name},d(l.value),9,vt))),128))],512),[[Q,a.formData.role]])]),e("td",null,[e("button",{onClick:o[4]||(o[4]=(...l)=>u.createTeam&&u.createTeam(...l))},"Add")])])):f("",!0),(s(!0),r(y,null,$(a.items,l=>{var h;return s(),r("tr",{class:"q-tr--no-hover",key:l.id},[e("td",null,d(l.full_name),1),e("td",null,d(l.email),1),e("td",null,d(l.telephone),1),e("td",null,d(l.role),1),((h=t.$proposalStore.currentProposal)==null?void 0:h.status)=="EDITING"?(s(),r("td",bt,[m(C,{icon:"delete",flat:"",color:"negative",onClick:q=>u.deleteItem(l.id)},null,8,["onClick"])])):f("",!0)])}),128))])]}),_:1})])}var St=I(nt,[["render",kt]]);const Et={name:"SectionEditor2",props:{proposal:{type:Object,required:!0},section:{type:Object,required:!0}},data(){return{loading:!1,showDialog:!1,formData:{}}},computed:{numWords(){return this.countWordsInHtml(this.formData[this.section.name]||"")}},methods:{updateSection(){this.$api.patch(`proposals/${this.$route.params.proposal_id}/`,this.formData).then(t=>{this.$emit("proposal-updated",t.data),this.$bus.emit("proposal-updated",t.data)})},countWordsInHtml(t){return W.load(t)("body").text().split(/\s+/).length-1},onPaste(t){if(t.target.nodeName==="INPUT")return;let o,n;t.preventDefault(),t.stopPropagation(),t.originalEvent&&t.originalEvent.clipboardData.getData?(o=t.originalEvent.clipboardData.getData("text/plain"),this.$refs.editorRef.runCmd("insertText",o)):t.clipboardData&&t.clipboardData.getData?(o=t.clipboardData.getData("text/plain"),this.$refs.editorRef.runCmd("insertText",o)):window.clipboardData&&window.clipboardData.getData&&(n||(n=!0,this.$refs.editorRef.runCmd("ms-pasteTextOnly",o)),n=!1)}},mounted(){this.formData[this.section.name]=this.proposal[this.section.name]||""},watch:{proposal(t){this.formData[this.section.name]=t[this.section.name]||""}}},It={key:0},Pt={class:"scroll"},qt={class:"text-caption text-grey-8",align:"right"},Tt={key:0,class:"text-red text-caption"},xt={key:1,class:"text-right"};function wt(t,o,n,_,a,u){var c,p;return((c=n.proposal)==null?void 0:c.status)=="EDITING"&&t.$authStore.currentUser.id==((p=n.proposal)==null?void 0:p.user)?(s(),r("div",It,[m(M,{onSubmit:u.updateSection,class:"q-gutter-md"},{default:D(()=>[e("div",Pt,[m(R,{modelValue:a.formData[n.section.name],"onUpdate:modelValue":o[0]||(o[0]=i=>a.formData[n.section.name]=i),label:"Title of your proposal",outlined:"",required:"","min-height":"30vh",onBlur:u.updateSection,onPaste:u.onPaste,ref:"editorRef"},null,8,["modelValue","onBlur","onPaste"]),e("div",qt,[u.numWords>n.section.word_limit?(s(),r("small",Tt," Exceeded word limit ("+d(u.numWords)+"/"+d(n.section.lower_limit)+"-"+d(n.section.word_limit)+") ",1)):(s(),r("div",xt," Number of Words ("+d(u.numWords)+"/"+d(n.section.lower_limit)+"-"+d(n.section.word_limit)+") ",1))])])]),_:1},8,["onSubmit"])])):f("",!0)}var Ut=I(Et,[["render",wt]]);const Ct={name:"AttachmentEditor",data(){return{formData:{full_name:"",email:"",telephone:"",proposal:this.$route.params.proposal_id},attachments:[],attachmentsValid:!1}},created(){this.init()},methods:{init(){this.getAttachments()},getAttachments(){this.$api.get("attachments/").then(t=>{this.attachments=t.data,this.getFiles()})},getFiles(){for(let t=0;t<this.attachments.length;t++){const o=this.attachments[t];this.$api.get(`files/?proposal_id=${this.$route.params.proposal_id}&attachment_id=${o.id}`).then(n=>{var _=n.data;this.attachments.filter(a=>a.id==o.id)[0].files=_,t==this.attachments.length-1&&setTimeout(()=>{this.validateAttachments()},1e3)})}},validateAttachments(){let t=!0;return this.attachments.filter(n=>{var _;return n.is_required&&!((_=n.files)!=null&&_.length)}).length?t=!1:t=!0,this.$bus.emit("attachments-updated",t),t},deleteFile(t){confirm("Delete this File?")&&this.$api.delete(`files/${t}/`).then(o=>{o.status==204&&this.getFiles()})},openFile(t){window.open(t)}}},Ft=e("thead",null,[e("tr",null,[e("th",{align:"left"},"Title"),e("th",{align:"left",colspan:"2"},"Files")])],-1),Nt={key:0,class:"text-red"},Bt={class:"flex"};function Qt(t,o,n,_,a,u){const c=b("proposal-file-attachment");return s(),r("div",null,[m(T,{class:"q-my-sm",flat:"",bordered:""},{default:D(()=>[Ft,e("tbody",null,[(s(!0),r(y,null,$(a.attachments,p=>(s(),r("tr",{key:p.id},[e("td",null,[G(d(p.title)+" ",1),p.is_required?(s(),r("span",Nt,"*")):f("",!0)]),e("td",null,[e("div",Bt,[(s(!0),r(y,null,$(p.files,i=>(s(),P(H,{dense:"",key:i.id,class:"glossy",icon:"attachment",label:i.name,removable:t.$userHasAnyGroups(["applicant"])&&t.$authStore.currentUser.id==t.$proposalStore.currentProposal.user&&t.$proposalStore.currentProposal.status=="EDITING",clickable:"",onRemove:g=>u.deleteFile(i.id),onClick:g=>u.openFile(i.file)},null,8,["label","removable","onRemove","onClick"]))),128))])]),e("td",null,[m(c,{attachment_id:p.id,onFileUploaded:o[0]||(o[0]=i=>u.getFiles())},null,8,["attachment_id"])])]))),128))])]),_:1})])}var Gt=I(Ct,[["render",Qt]]);const Vt={components:{budgeteditor:lt,teameditor:St,sectioneditor2:Ut,attachmentseditor:Gt,ExpenseReports:L,ProposalReportsEditor:O},data(){return{sections:[],proposal:{},score:null,content:`
      <p>
        Lorem ipsum dolor sit amet consectetur, adipisicing elit. Obcaecati
        natus animi, et itaque ea tempora, exercitationem nemo nobis eos quos
        corrupti quasi cupiditate recusandae magnam, quis dicta facere dolore
        blanditiis.
      </p>`}},created(){this.getProposal(),this.getSections()},methods:{getProposal(){this.$api.get(`proposals/${this.$route.params.proposal_id}/`).then(t=>{this.proposal=t.data,this.$proposalStore.setProposal(this.proposal),this.getScore()})},getScore(){var t;this.$api.get(`scores/?user=${((t=this.$authStore.currentUser)==null?void 0:t.id)||0}&proposal=${this.$route.params.proposal_id}`).then(o=>{o.data.length==1&&(this.score=o.data[0])})},getSections(){this.$api.get("sections/").then(t=>{this.sections=t.data})}}},At={class:"q-pa-sm"},Rt=["id"],Mt={class:"q-pa-sm"},Wt={class:"flex"},Ht={class:"bg-grey-0"},Lt={class:"text-caption text-grey-8"},Ot={class:"q-pt-sm"},Xt={key:0},jt={key:1},zt={key:2},Jt={key:3},Kt=["innerHTML"],Yt={key:0},Zt=e("hr",null,null,-1),te=e("hr",{id:"solution",class:"section-separator"},null,-1);function ee(t,o,n,_,a,u){const c=b("budgeteditor"),p=b("teameditor"),i=b("attachmentseditor"),g=b("sectioneditor2"),E=b("ExpenseReports"),l=b("ProposalReportsEditor");return s(),r("div",At,[(s(!0),r(y,null,$(a.sections,h=>{var q,x;return s(),r("div",{key:h.id},[e("hr",{id:h.name,class:"section-separator"},null,8,Rt),e("div",Mt,[m(F,{class:"flex justify-between"},{default:D(()=>[e("div",Wt,d(h.title),1)]),_:2},1024),((q=t.$proposalStore.currentProposal)==null?void 0:q.status)=="EDITING"?(s(),P(U,{key:0,class:"flex no-wrap q-pa-sm",flat:"",bordered:""},{default:D(()=>[m(V,{size:"md",class:"q-pr-sm",name:"info_outline"}),e("div",Ht,[e("small",Lt,d(h.description),1)])]),_:2},1024)):f("",!0),e("div",Ot,[h.ref=="#summary_budget"?(s(),r("div",Xt,[m(c)])):h.ref=="#team"?(s(),r("div",jt,[m(p)])):h.ref=="#attachments"?(s(),r("div",zt,[m(i)])):(s(),r("div",Jt,[((x=t.$proposalStore.currentProposal)==null?void 0:x.status)=="EDITING"?(s(),P(g,{key:0,proposal:a.proposal,section:h,onProposalUpdated:o[0]||(o[0]=w=>{a.proposal=w,t.$proposalStore.setProposal(w)})},null,8,["proposal","section"])):(s(),P(U,{key:1,class:"my-card",flat:"",bordered:""},{default:D(()=>[m(A,null,{default:D(()=>[e("div",{innerHTML:a.proposal[h.name]},null,8,Kt)]),_:2},1024)]),_:2},1024))]))])])])}),128)),this.$authStore.currentUser.id==this.$proposalStore.currentProposal.user&&this.$proposalStore.currentProposal.is_selected?(s(),r("div",Yt,[Zt,m(E),m(l)])):f("",!0),te])}var Fe=I(Vt,[["render",ee]]);export{Fe as default};
