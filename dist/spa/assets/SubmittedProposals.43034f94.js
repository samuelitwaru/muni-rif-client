import{Q as Ae,a as ie}from"./QBreadcrumbs.9c06453f.js";import{Q as se}from"./QSeparator.68732f5d.js";import{m as L,y as Re,p as k,a7 as _e,s as G,n as x,Q as O,g as Ue,R as Be,D as Y,a1 as Fe,aw as F,ab as Ne,aG as Le,ap as z,aH as J,z as ue,G as Z,ao as ee,E as We,O as Ke,aK as Me,I as U,aU as ge,V as je,W as te,aV as ye,ai as ze,q as He,C as Ge,_ as W,o as p,j as S,f as i,w as m,e as $,l as E,v as N,F as T,k as D,i as a,h as Q,t as y,r as R,aM as be,aN as we,x as Oe,aW as Ye}from"./index.1080353d.js";import{Q as le}from"./QCard.88f5c900.js";import{Q as Se}from"./QPopupProxy.7d04538f.js";import{Q as ke}from"./QChip.4f637fd8.js";import{Q as Pe}from"./QMarkupTable.c0451a53.js";import{Q as xe}from"./QPage.23d4180f.js";import{Q as Ce,a as oe}from"./QItem.9ac5fc30.js";import{Q as qe}from"./QList.6dedcd63.js";import{g as de,s as ce}from"./touch.3df10340.js";import{c as Xe}from"./selection.c4975593.js";import{u as Ve,Q as Je}from"./QDate.97cabd6f.js";import{a as Ze,u as et}from"./use-dark.6b0451ed.js";import{u as tt}from"./use-quasar.fc25bf67.js";import{Q as H}from"./QCardSection.f803a29f.js";import{Q as pe}from"./QItemLabel.3fd4d963.js";import{Q as st}from"./QUploader.0826d80d.js";import{Q as ot}from"./QDialog.27353340.js";import{Q as lt}from"./QSelect.4590551e.js";import{Q as me}from"./QInput.1bee1665.js";import"./QMenu.9bbdcf7b.js";import"./use-timeout.cd2175e4.js";import"./focusout.364dbcfd.js";import"./focus-manager.b507780d.js";import"./use-transition.32cb9394.js";import"./scroll.fa986778.js";import"./use-form.ed2be5bd.js";import"./format.2bc25e5f.js";import"./QCircularProgress.91f6d01b.js";import"./use-file.9eb9a3e0.js";import"./use-prevent-scroll.b4dcc30f.js";import"./use-key-composition.29ef2a66.js";import"./use-split-attrs.338740ca.js";import"./uid.42677368.js";var nt=L({name:"QSlideTransition",props:{appear:Boolean,duration:{type:Number,default:300}},emits:["show","hide"],setup(e,{slots:t,emit:r}){let c=!1,l,o,s=null,n=null,g,P;function h(){l&&l(),l=null,c=!1,s!==null&&(clearTimeout(s),s=null),n!==null&&(clearTimeout(n),n=null),o!==void 0&&o.removeEventListener("transitionend",g),g=null}function d(v,u,b){u!==void 0&&(v.style.height=`${u}px`),v.style.transition=`height ${e.duration}ms cubic-bezier(.25, .8, .50, 1)`,c=!0,l=b}function f(v,u){v.style.overflowY=null,v.style.height=null,v.style.transition=null,h(),u!==P&&r(u)}function w(v,u){let b=0;o=v,c===!0?(h(),b=v.offsetHeight===v.scrollHeight?0:void 0):(P="hide",v.style.overflowY="hidden"),d(v,b,u),s=setTimeout(()=>{s=null,v.style.height=`${v.scrollHeight}px`,g=q=>{n=null,(Object(q)!==q||q.target===v)&&f(v,"show")},v.addEventListener("transitionend",g),n=setTimeout(g,e.duration*1.1)},100)}function V(v,u){let b;o=v,c===!0?h():(P="show",v.style.overflowY="hidden",b=v.scrollHeight),d(v,b,u),s=setTimeout(()=>{s=null,v.style.height=0,g=q=>{n=null,(Object(q)!==q||q.target===v)&&f(v,"hide")},v.addEventListener("transitionend",g),n=setTimeout(g,e.duration*1.1)},100)}return Re(()=>{c===!0&&h()}),()=>k(_e,{css:!1,appear:e.appear,onEnter:w,onLeave:V},t.default)}}),Te=L({name:"StepHeader",props:{stepper:{},step:{},goToPanel:Function},setup(e,{attrs:t}){const{proxy:{$q:r}}=Y(),c=G(null),l=x(()=>e.stepper.modelValue===e.step.name),o=x(()=>{const u=e.step.disable;return u===!0||u===""}),s=x(()=>{const u=e.step.error;return u===!0||u===""}),n=x(()=>{const u=e.step.done;return o.value===!1&&(u===!0||u==="")}),g=x(()=>{const u=e.step.headerNav,b=u===!0||u===""||u===void 0;return o.value===!1&&e.stepper.headerNav&&b}),P=x(()=>e.step.prefix&&(l.value===!1||e.stepper.activeIcon==="none")&&(s.value===!1||e.stepper.errorIcon==="none")&&(n.value===!1||e.stepper.doneIcon==="none")),h=x(()=>{const u=e.step.icon||e.stepper.inactiveIcon;if(l.value===!0){const b=e.step.activeIcon||e.stepper.activeIcon;return b==="none"?u:b||r.iconSet.stepper.active}if(s.value===!0){const b=e.step.errorIcon||e.stepper.errorIcon;return b==="none"?u:b||r.iconSet.stepper.error}if(o.value===!1&&n.value===!0){const b=e.step.doneIcon||e.stepper.doneIcon;return b==="none"?u:b||r.iconSet.stepper.done}return u}),d=x(()=>{const u=s.value===!0?e.step.errorColor||e.stepper.errorColor:void 0;if(l.value===!0){const b=e.step.activeColor||e.stepper.activeColor||e.step.color;return b!==void 0?b:u}return u!==void 0?u:o.value===!1&&n.value===!0?e.step.doneColor||e.stepper.doneColor||e.step.color||e.stepper.inactiveColor:e.step.color||e.stepper.inactiveColor}),f=x(()=>"q-stepper__tab col-grow flex items-center no-wrap relative-position"+(d.value!==void 0?` text-${d.value}`:"")+(s.value===!0?" q-stepper__tab--error q-stepper__tab--error-with-"+(P.value===!0?"prefix":"icon"):"")+(l.value===!0?" q-stepper__tab--active":"")+(n.value===!0?" q-stepper__tab--done":"")+(g.value===!0?" q-stepper__tab--navigation q-focusable q-hoverable":"")+(o.value===!0?" q-stepper__tab--disabled":"")),w=x(()=>e.stepper.headerNav!==!0?!1:g.value);function V(){c.value!==null&&c.value.focus(),l.value===!1&&e.goToPanel(e.step.name)}function v(u){u.keyCode===13&&l.value===!1&&e.goToPanel(e.step.name)}return()=>{const u={class:f.value};g.value===!0&&(u.onClick=V,u.onKeyup=v,Object.assign(u,o.value===!0?{tabindex:-1,"aria-disabled":"true"}:{tabindex:t.tabindex||0}));const b=[k("div",{class:"q-focus-helper",tabindex:-1,ref:c}),k("div",{class:"q-stepper__dot row flex-center q-stepper__line relative-position"},[k("span",{class:"row flex-center"},[P.value===!0?e.step.prefix:k(O,{name:h.value})])])];if(e.step.title!==void 0&&e.step.title!==null){const q=[k("div",{class:"q-stepper__title"},e.step.title)];e.step.caption!==void 0&&e.step.caption!==null&&q.push(k("div",{class:"q-stepper__caption"},e.step.caption)),b.push(k("div",{class:"q-stepper__label q-stepper__line relative-position"},q))}return Ue(k("div",u,b),[[Be,w.value]])}}});function rt(e){const t=[.06,6,50];return typeof e=="string"&&e.length&&e.split(":").forEach((r,c)=>{const l=parseFloat(r);l&&(t[c]=l)}),t}var at=Fe({name:"touch-swipe",beforeMount(e,{value:t,arg:r,modifiers:c}){if(c.mouse!==!0&&F.has.touch!==!0)return;const l=c.mouseCapture===!0?"Capture":"",o={handler:t,sensitivity:rt(r),direction:de(c),noop:Ne,mouseStart(s){ce(s,o)&&Le(s)&&(z(o,"temp",[[document,"mousemove","move",`notPassive${l}`],[document,"mouseup","end","notPassiveCapture"]]),o.start(s,!0))},touchStart(s){if(ce(s,o)){const n=s.target;z(o,"temp",[[n,"touchmove","move","notPassiveCapture"],[n,"touchcancel","end","notPassiveCapture"],[n,"touchend","end","notPassiveCapture"]]),o.start(s)}},start(s,n){F.is.firefox===!0&&J(e,!0);const g=ue(s);o.event={x:g.left,y:g.top,time:Date.now(),mouse:n===!0,dir:!1}},move(s){if(o.event===void 0)return;if(o.event.dir!==!1){Z(s);return}const n=Date.now()-o.event.time;if(n===0)return;const g=ue(s),P=g.left-o.event.x,h=Math.abs(P),d=g.top-o.event.y,f=Math.abs(d);if(o.event.mouse!==!0){if(h<o.sensitivity[1]&&f<o.sensitivity[1]){o.end(s);return}}else if(window.getSelection().toString()!==""){o.end(s);return}else if(h<o.sensitivity[2]&&f<o.sensitivity[2])return;const w=h/n,V=f/n;o.direction.vertical===!0&&h<f&&h<100&&V>o.sensitivity[0]&&(o.event.dir=d<0?"up":"down"),o.direction.horizontal===!0&&h>f&&f<100&&w>o.sensitivity[0]&&(o.event.dir=P<0?"left":"right"),o.direction.up===!0&&h<f&&d<0&&h<100&&V>o.sensitivity[0]&&(o.event.dir="up"),o.direction.down===!0&&h<f&&d>0&&h<100&&V>o.sensitivity[0]&&(o.event.dir="down"),o.direction.left===!0&&h>f&&P<0&&f<100&&w>o.sensitivity[0]&&(o.event.dir="left"),o.direction.right===!0&&h>f&&P>0&&f<100&&w>o.sensitivity[0]&&(o.event.dir="right"),o.event.dir!==!1?(Z(s),o.event.mouse===!0&&(document.body.classList.add("no-pointer-events--children"),document.body.classList.add("non-selectable"),Xe(),o.styleCleanup=v=>{o.styleCleanup=void 0,document.body.classList.remove("non-selectable");const u=()=>{document.body.classList.remove("no-pointer-events--children")};v===!0?setTimeout(u,50):u()}),o.handler({evt:s,touch:o.event.mouse!==!0,mouse:o.event.mouse,direction:o.event.dir,duration:n,distance:{x:h,y:f}})):o.end(s)},end(s){o.event!==void 0&&(ee(o,"temp"),F.is.firefox===!0&&J(e,!1),o.styleCleanup!==void 0&&o.styleCleanup(!0),s!==void 0&&o.event.dir!==!1&&Z(s),o.event=void 0)}};if(e.__qtouchswipe=o,c.mouse===!0){const s=c.mouseCapture===!0||c.mousecapture===!0?"Capture":"";z(o,"main",[[e,"mousedown","mouseStart",`passive${s}`]])}F.has.touch===!0&&z(o,"main",[[e,"touchstart","touchStart",`passive${c.capture===!0?"Capture":""}`],[e,"touchmove","noop","notPassiveCapture"]])},updated(e,t){const r=e.__qtouchswipe;r!==void 0&&(t.oldValue!==t.value&&(typeof t.value!="function"&&r.end(),r.handler=t.value),r.direction=de(t.modifiers))},beforeUnmount(e){const t=e.__qtouchswipe;t!==void 0&&(ee(t,"main"),ee(t,"temp"),F.is.firefox===!0&&J(e,!1),t.styleCleanup!==void 0&&t.styleCleanup(),delete e.__qtouchswipe)}});const it={name:{required:!0},disable:Boolean},fe={setup(e,{slots:t}){return()=>k("div",{class:"q-panel scroll",role:"tabpanel"},U(t.default))}},ut={modelValue:{required:!0},animated:Boolean,infinite:Boolean,swipeable:Boolean,vertical:Boolean,transitionPrev:String,transitionNext:String,transitionDuration:{type:[String,Number],default:300},keepAlive:Boolean,keepAliveInclude:[String,Array,RegExp],keepAliveExclude:[String,Array,RegExp],keepAliveMax:Number},dt=["update:modelValue","beforeTransition","transition"];function ct(){const{props:e,emit:t,proxy:r}=Y(),{getCacheWithFn:c}=Ve();let l,o;const s=G(null),n=G(null);function g(_){const C=e.vertical===!0?"up":"left";B((r.$q.lang.rtl===!0?-1:1)*(_.direction===C?1:-1))}const P=x(()=>[[at,g,void 0,{horizontal:e.vertical!==!0,vertical:e.vertical,mouse:!0}]]),h=x(()=>e.transitionPrev||`slide-${e.vertical===!0?"down":"right"}`),d=x(()=>e.transitionNext||`slide-${e.vertical===!0?"up":"left"}`),f=x(()=>`--q-transition-duration: ${e.transitionDuration}ms`),w=x(()=>typeof e.modelValue=="string"||typeof e.modelValue=="number"?e.modelValue:String(e.modelValue)),V=x(()=>({include:e.keepAliveInclude,exclude:e.keepAliveExclude,max:e.keepAliveMax})),v=x(()=>e.keepAliveInclude!==void 0||e.keepAliveExclude!==void 0);We(()=>e.modelValue,(_,C)=>{const I=M(_)===!0?X(_):-1;o!==!0&&ne(I===-1?0:I<X(C)?-1:1),s.value!==I&&(s.value=I,t("beforeTransition",_,C),Ke(()=>{t("transition",_,C)}))});function u(){B(1)}function b(){B(-1)}function q(_){t("update:modelValue",_)}function M(_){return _!=null&&_!==""}function X(_){return l.findIndex(C=>C.props.name===_&&C.props.disable!==""&&C.props.disable!==!0)}function $e(){return l.filter(_=>_.props.disable!==""&&_.props.disable!==!0)}function ne(_){const C=_!==0&&e.animated===!0&&s.value!==-1?"q-transition--"+(_===-1?h.value:d.value):null;n.value!==C&&(n.value=C)}function B(_,C=s.value){let I=C+_;for(;I>-1&&I<l.length;){const j=l[I];if(j!==void 0&&j.props.disable!==""&&j.props.disable!==!0){ne(_),o=!0,t("update:modelValue",j.props.name),setTimeout(()=>{o=!1});return}I+=_}e.infinite===!0&&l.length!==0&&C!==-1&&C!==l.length&&B(_,_===-1?l.length:-1)}function re(){const _=X(e.modelValue);return s.value!==_&&(s.value=_),!0}function ae(){const _=M(e.modelValue)===!0&&re()&&l[s.value];return e.keepAlive===!0?[k(ge,V.value,[k(v.value===!0?c(w.value,()=>({...fe,name:w.value})):fe,{key:w.value,style:f.value},()=>_)])]:[k("div",{class:"q-panel scroll",style:f.value,key:w.value,role:"tabpanel"},[_])]}function Ie(){if(l.length!==0)return e.animated===!0?[k(_e,{name:n.value},ae)]:ae()}function Ee(_){return l=Me(U(_.default,[])).filter(C=>C.props!==null&&C.props.slot===void 0&&M(C.props.name)===!0),l.length}function Qe(){return l}return Object.assign(r,{next:u,previous:b,goTo:q}),{panelIndex:s,panelDirectives:P,updatePanelsList:Ee,updatePanelIndex:re,getPanelContent:Ie,getEnabledPanels:$e,getPanels:Qe,isValidPanelName:M,keepAliveProps:V,needsUniqueKeepAliveWrapper:v,goToPanelByOffset:B,goToPanel:q,nextPanel:u,previousPanel:b}}function De(e){return k("div",{class:"q-stepper__step-content"},[k("div",{class:"q-stepper__step-inner"},U(e.default))])}const ve={setup(e,{slots:t}){return()=>De(t)}};var he=L({name:"QStep",props:{...it,icon:String,color:String,title:{type:String,required:!0},caption:String,prefix:[String,Number],doneIcon:String,doneColor:String,activeIcon:String,activeColor:String,errorIcon:String,errorColor:String,headerNav:{type:Boolean,default:!0},done:Boolean,error:Boolean,onScroll:[Function,Array]},setup(e,{slots:t,emit:r}){const{proxy:{$q:c}}=Y(),l=je(ye,te);if(l===te)return console.error("QStep needs to be a child of QStepper"),te;const{getCacheWithFn:o}=Ve(),s=G(null),n=x(()=>l.value.modelValue===e.name),g=x(()=>c.platform.is.ios!==!0&&c.platform.is.chrome===!0||n.value!==!0||l.value.vertical!==!0?{}:{onScroll(d){const{target:f}=d;f.scrollTop>0&&(f.scrollTop=0),e.onScroll!==void 0&&r("scroll",d)}}),P=x(()=>typeof e.name=="string"||typeof e.name=="number"?e.name:String(e.name));function h(){const d=l.value.vertical;return d===!0&&l.value.keepAlive===!0?k(ge,l.value.keepAliveProps.value,n.value===!0?[k(l.value.needsUniqueKeepAliveWrapper.value===!0?o(P.value,()=>({...ve,name:P.value})):ve,{key:P.value},t.default)]:void 0):d!==!0||n.value===!0?De(t):void 0}return()=>k("div",{ref:s,class:"q-stepper__step",role:"tabpanel",...g.value},l.value.vertical===!0?[k(Te,{stepper:l.value,step:e,goToPanel:l.value.goToPanel}),l.value.animated===!0?k(nt,h):h()]:[h()])}}),pt=L({name:"QStepperNavigation",setup(e,{slots:t}){return()=>k("div",{class:"q-stepper__nav"},U(t.default))}});const mt=/(-\w)/g;function ft(e){const t={};for(const r in e){const c=r.replace(mt,l=>l[1].toUpperCase());t[c]=e[r]}return t}var vt=L({name:"QStepper",props:{...Ze,...ut,flat:Boolean,bordered:Boolean,alternativeLabels:Boolean,headerNav:Boolean,contracted:Boolean,headerClass:String,inactiveColor:String,inactiveIcon:String,doneIcon:String,doneColor:String,activeIcon:String,activeColor:String,errorIcon:String,errorColor:String},emits:dt,setup(e,{slots:t}){const r=Y(),c=et(e,r.proxy.$q),{updatePanelsList:l,isValidPanelName:o,updatePanelIndex:s,getPanelContent:n,getPanels:g,panelDirectives:P,goToPanel:h,keepAliveProps:d,needsUniqueKeepAliveWrapper:f}=ct();ze(ye,x(()=>({goToPanel:h,keepAliveProps:d,needsUniqueKeepAliveWrapper:f,...e})));const w=x(()=>`q-stepper q-stepper--${e.vertical===!0?"vertical":"horizontal"}`+(e.flat===!0?" q-stepper--flat":"")+(e.bordered===!0?" q-stepper--bordered":"")+(c.value===!0?" q-stepper--dark q-dark":"")),V=x(()=>`q-stepper__header row items-stretch justify-between q-stepper__header--${e.alternativeLabels===!0?"alternative":"standard"}-labels`+(e.flat===!1||e.bordered===!0?" q-stepper__header--border":"")+(e.contracted===!0?" q-stepper__header--contracted":"")+(e.headerClass!==void 0?` ${e.headerClass}`:""));function v(){const u=U(t.message,[]);if(e.vertical===!0){o(e.modelValue)&&s();const b=k("div",{class:"q-stepper__content"},U(t.default));return u===void 0?[b]:u.concat(b)}return[k("div",{class:V.value},g().map(b=>{const q=ft(b.props);return k(Te,{key:q.name,stepper:e,step:q,goToPanel:h})})),u,Ge("div",{class:"q-stepper__content q-panel-parent"},n(),"cont",e.swipeable,()=>P.value)]}return()=>(l(t),k("div",{class:w.value},He(t.navigation,v())))}});const ht={props:["reviewers"],name:"AssignReviewers",data(){return{step:1,selectedReviewers:[]}},methods:{next(){this.step==2?this.$emit("reviewers-selected",this.selectedReviewers):this.$refs.stepper.next()},selectReviewer(e){this.selectedReviewers.includes(e)?this.selectedReviewers=this.selectedReviewers.filter(t=>t!=e):this.selectedReviewers.push(e)}}},_t={style:{height:"500px"}},gt=["checked"];function yt(e,t,r,c,l,o){return p(),S("div",_t,[i(vt,{modelValue:l.step,"onUpdate:modelValue":t[1]||(t[1]=s=>l.step=s),ref:"stepper",color:"primary",animated:""},{navigation:m(()=>[i(pt,{align:"right"},{default:m(()=>[l.step>1?(p(),$(E,{key:0,flat:"",color:"primary",onClick:t[0]||(t[0]=s=>e.$refs.stepper.previous()),label:"Back",class:"q-ml-sm"})):N("",!0),i(E,{onClick:o.next,disabled:l.selectedReviewers.length==0,color:"primary",label:l.step===2?"Finish":"Continue"},null,8,["onClick","disabled","label"])]),_:1})]),default:m(()=>[i(he,{name:1,title:"Select Reviewers",icon:"settings",done:l.step>1},{default:m(()=>[i(qe,{bordered:"",class:"",style:{width:"500px","max-height":"280px","overflow-y":"auto"}},{default:m(()=>[(p(!0),S(T,null,D(r.reviewers,s=>(p(),$(Ce,{onClick:n=>o.selectReviewer(s.id),clickable:"",active:l.selectedReviewers.includes(s.id),key:s.id},{default:m(()=>[a("input",{class:"q-ma-sm",type:"checkbox",checked:l.selectedReviewers.includes(s.id)},null,8,gt),i(oe,null,{default:m(()=>[Q(y(s.first_name)+" "+y(s.last_name),1)]),_:2},1024)]),_:2},1032,["onClick","active"]))),128))]),_:1})]),_:1},8,["done"]),i(he,{name:2,title:"Invite Reviewers",icon:"create_new_folder",done:l.step>2},{default:m(()=>[a("p",null,[i(O,{name:"info",size:"md"}),Q(" An email invitation will be sent to each of the selected reviewers ")]),i(le,{class:"my-card",style:{width:"500px",height:"250px","overflow-y":"auto"},flat:"",bordered:""},{default:m(()=>[a("ul",null,[(p(!0),S(T,null,D(r.reviewers.filter(s=>l.selectedReviewers.includes(s.id)),s=>(p(),S("li",{key:s.id},[Q(y(s.first_name)+" "+y(s.last_name)+" ("+y(s.email)+") ",1),a("ul",null,[(p(!0),S(T,null,D(s.profile.themes,n=>(p(),S("li",{key:n.id},y(n.theme_title),1))),128))])]))),128))])]),_:1})]),_:1},8,["done"])]),_:1},8,["modelValue"])])}var bt=W(ht,[["render",yt]]);const wt={props:{proposals:{type:Array,default:()=>[]}},name:"ReviewerList",data(){return{formData:{theme:null,call:this.$dataStore.currentCall.id},themes:[],sections:[]}},created(){this.$q=tt(),this.getSections(),this.getThemes()},methods:{getSections(){this.$api.get("sections/").then(e=>{this.sections=e.data.filter(t=>t.max_score>0)})},getThemes(){this.$api.get("themes/").then(e=>{this.themes=e.data})},selectProposal(e,t){const r=e.target.checked;this.$api.patch(`proposals/${t}/`,{is_selected:r}).then(c=>{var l="Proposal added to selected proposals";r||(l="Proposal removed from selected proposals"),this.$q.notify(l)})}}},K=e=>(be("data-v-322d6150"),e=e(),we(),e),St=K(()=>a("th",{align:"left"},"Title",-1)),kt=K(()=>a("th",{align:"center"},"Total",-1)),Pt=K(()=>a("th",{align:"center"},"Reviewer",-1)),xt=K(()=>a("th",{align:"center"},"Average Score",-1)),Ct=K(()=>a("th",{align:"left"},null,-1)),qt={key:0,class:"q-tr--no-hover text-center"},Vt=["rowspan"],Tt={class:"inner"},Dt=["onClick","checked"],$t={class:"inner"},It=["rowspan"],Et=["rowspan"],Qt={class:""},At={class:""};function Rt(e,t,r,c,l,o){const s=R("router-link");return p(),$(xe,null,{default:m(()=>[i(Pe,{class:"q-ma-sm my-sticky-column-table","wrap-cells":"",flat:"",bordered:"",dense:""},{default:m(()=>[a("thead",null,[a("tr",null,[St,(p(!0),S(T,null,D(l.sections,n=>(p(),S("th",{key:n.id},y(n.title),1))),128)),kt,Pt,xt,Ct])]),a("tbody",null,[(p(!0),S(T,null,D(r.proposals,n=>{var g,P,h,d,f;return p(),S(T,{key:n.id},[(g=n==null?void 0:n.scores)!=null&&g.length?(p(),S("tr",qt,[a("td",{rowspan:(P=n.scores)==null?void 0:P.length,class:"text-left"},[a("table",null,[a("tbody",null,[a("tr",null,[a("td",Tt,[a("input",{onClick:w=>o.selectProposal(w,n.id),type:"checkbox",checked:n.is_selected},null,8,Dt)]),a("td",$t,[a("span",null,y(n.title)+" ("+y(n.status)+")",1)])])])])],8,Vt),(p(!0),S(T,null,D(l.sections,w=>(p(),S("td",{key:w.id},y(n.scores[0][w.name]),1))),128)),a("td",null,y(n.scores[0].total_score),1),a("td",null,y(n.scores[0].user__first_name)+" "+y(n.scores[0].user__last_name)+" ("+y(n.scores[0].user__username)+") ("+y(n.scores[0].status)+") ",1),a("td",{rowspan:(h=n.scores)==null?void 0:h.length},y(n.average_score),9,It),a("td",{rowspan:(d=n.scores)==null?void 0:d.length},[i(s,{to:`/proposals/${n.id}`},{default:m(()=>[i(E,{color:"primary",icon:"remove_red_eye",flat:"",dense:""})]),_:2},1032,["to"])],8,Et)])):N("",!0),(p(!0),S(T,null,D((f=n.scores)==null?void 0:f.slice(1),w=>(p(),S("tr",{class:"q-tr--no-hover text-center",key:w.id},[(p(!0),S(T,null,D(l.sections,V=>(p(),S("td",{class:"exclude",key:V.id},y(w[V.name]),1))),128)),a("td",Qt,"\xA0\xA0"+y(w.total_score),1),a("td",At," \xA0\xA0 "+y(w.user__first_name)+" "+y(w.user__last_name)+" ("+y(w.user__username)+") ("+y(w.status)+") ",1)]))),128))],64)}),128))])]),_:1})]),_:1})}var Ut=W(wt,[["render",Rt],["__scopeId","data-v-322d6150"]]);const Bt={name:"FileUploader",props:["uploadUrl","multiple","formData"],data(){return{modalVisible:!1,uploadHeaders:{},filesToUpload:[],uploadedFiles:[]}},methods:{onFileAdded(e){console.log("file added",e),e.forEach(t=>{this.uploadFile(t)}),this.filesToUpload=[...this.filesToUpload,...e]},onBrowse(e){var t=Array.from(e.target.files);console.log("file added",t),this.onFileAdded(t)},uploadFile(e){console.log(">>>>",e);const t=new FormData;t.append("file",e),console.log("just added file >> form data",t);for(const r in this.formData)this.formData.hasOwnProperty(r)&&t.append(r,this.formData[r]);console.log("form data",t),console.log("url",this.uploadUrl),this.$api.post(this.uploadUrl,t,{headers:this.uploadHeaders}).then(r=>{this.uploadedFiles.push(e),this.filesToUpload=this.filesToUpload.filter(c=>c.key!=e.key),console.log(e),console.log(this.filesToUpload),this.uploadedFiles=[],this.modalVisible=!1,this.$emit("file-uploaded")}).catch(r=>{console.log(r)})}}},Ft=a("div",{class:"text-h6"},"File Upload",-1),Nt=a("div",{class:"text-center q-my-auto q-py-lg",style:{"background-color":"#ffffff",color:"#000000"}}," Drag and drop files here ",-1),Lt={class:"text-center",style:{"background-color":"#ffffff",color:"#000000"}},Wt=a("br",null,null,-1),Kt=a("br",null,null,-1),Mt=["multiple"],jt=a("label",{for:"files",class:"button-label"}," Browse ",-1);function zt(e,t,r,c,l,o){return p(),S("div",null,[i(E,{color:"primary",icon:"upload",label:"Upload",dense:"",flat:"",onClick:t[0]||(t[0]=s=>l.modalVisible=!0)}),i(ot,{modelValue:l.modalVisible,"onUpdate:modelValue":t[4]||(t[4]=s=>l.modalVisible=s)},{default:m(()=>[i(le,{style:{"min-width":"400px"}},{default:m(()=>[i(H,{class:"q-pa-sm text-center flex justify-between"},{default:m(()=>[Ft,i(E,{color:"primary",icon:"close",flat:"",onClick:t[1]||(t[1]=s=>{l.uploadedFiles=[],l.modalVisible=!1})})]),_:1}),i(se,{spaced:""}),i(H,{class:"q-pa-sm"},{default:m(()=>[a("div",null,[i(st,{url:r.uploadUrl,multiple:r.multiple,onAdded:o.onFileAdded,style:{width:"100%"}},{header:m(()=>[Nt,a("div",Lt,[Q(" or "),Wt,Kt,a("input",{onChange:t[2]||(t[2]=(...s)=>o.onBrowse&&o.onBrowse(...s)),type:"file",id:"files",class:"hidden",multiple:r.multiple},null,40,Mt),jt])]),list:m(()=>[i(qe,{separator:""},{default:m(()=>[(p(!0),S(T,null,D(l.filesToUpload,s=>(p(),$(Ce,{key:s.__key},{default:m(()=>[i(oe,null,{default:m(()=>[i(pe,{class:"full-width ellipsis"},{default:m(()=>[Q(y(s.name),1)]),_:2},1024),i(pe,{caption:""},{default:m(()=>[Q(y(s.__sizeLabel)+" / "+y(s.__progressLabel),1)]),_:2},1024)]),_:2},1024),i(oe,{top:"",side:""},{default:m(()=>[i(Oe,{size:"20px",color:"primary"})]),_:1})]),_:2},1024))),128))]),_:1})]),_:1},8,["url","multiple","onAdded"])])]),_:1}),i(H,{class:"q-pa-sm"},{default:m(()=>[(p(!0),S(T,null,D(l.uploadedFiles,s=>(p(),$(ke,{dense:"",key:s.__key,class:"glossy",icon:"check",label:s.name},null,8,["label"]))),128))]),_:1}),i(se,{spaced:""}),i(H,{align:"right"},{default:m(()=>[i(E,{color:"primary",label:"Done",onClick:t[3]||(t[3]=s=>{l.uploadedFiles=[],l.modalVisible=!1})})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}var Ht=W(Bt,[["render",zt]]);const Gt={name:"ReviewerList",data(){return{formData:{},formData2:{},popups:{},showPopup:!1,fields:[{type:"dateRange",label:"Submission Date",name:"submission_date",range_input_name:"submission_date_text",range_from_name:"submission_date__gte",range_to_name:"submission_date__lte"},{type:"select",label:"Select Theme",options:[],name:"theme"},{type:"select",label:"Status",options:[],name:"status"},{type:"select",label:"PI",options:[],name:"user"},{type:"text",label:"Search",name:"search_query"}]}},created(){this.getThemes(),this.getUsers(),this.getStatusOptions()},methods:{getStatusOptions(){this.fields.filter(e=>e.name=="status")[0].options=[{id:0,title:"None"},{id:"EDITING",title:"EDITING"},{id:"SUBMITTED",title:"SUBMITTED"},{id:"REVIEWING",title:"REVIEWING"},{id:"REVIEWED",title:"REVIEWED"},{id:"SELECTED",title:"SELECTED"}]},async getUsers(){const e=await this.$api.get("users/?groups__name__in=applicant");console.log(e.data);const t=e.data.map(r=>({id:r.id,title:`${r.first_name} ${r.last_name}`}));return this.fields.filter(r=>r.name=="user")[0].options=[{id:0,title:"None"}].concat(t),e.data},async getThemes(){const e=await this.$api.get("themes/");return this.fields.filter(t=>t.name=="theme")[0].options=[{id:0,title:"None"}].concat(e.data),e.data},setDateRange(e,t,r,c){this.formData[r]=this.formData2[e].from,this.formData[c]=this.formData2[e].to,this.formData2[t]=`${this.formData2[e].from} - ${this.formData2[e].to}`,this.popups[e]=!1},filter(){console.log("filter",this.formData),this.$emit("filter",this.formData)}}},Ot={align:"right",class:"q-ma-xs row q-gutter-x-xs"},Yt={key:2,flat:"",class:"no-wrap"};function Xt(e,t,r,c,l,o){return p(),S("div",null,[a("div",Ot,[(p(!0),S(T,null,D(l.fields,s=>(p(),S("div",{class:"col",key:s},[s.type=="select"?(p(),$(lt,{key:0,modelValue:l.formData[s.name],"onUpdate:modelValue":[n=>l.formData[s.name]=n,t[0]||(t[0]=n=>o.filter())],dense:"",outlined:"",options:s.options,label:s.label,"option-value":"id","option-label":"title","map-options":"","emit-value":""},null,8,["modelValue","onUpdate:modelValue","options","label"])):s.type=="text"?(p(),$(me,{key:1,modelValue:l.formData[s.name],"onUpdate:modelValue":n=>l.formData[s.name]=n,label:s.label,outlined:"",onKeyup:t[1]||(t[1]=Ye(n=>o.filter(),["enter"])),onBlur:t[2]||(t[2]=n=>o.filter()),dense:""},null,8,["modelValue","onUpdate:modelValue","label"])):s.type=="dateRange"?(p(),S("div",Yt,[i(me,{modelValue:l.formData2[s.range_input_name],"onUpdate:modelValue":n=>l.formData2[s.range_input_name]=n,label:s.label,dense:"",outlined:"",readonly:""},{append:m(()=>[i(O,{name:"event",class:"cursor-pointer q-my-xs",icon:"event",flat:"",dense:"",color:"primary"},{default:m(()=>[i(Se,{cover:"","transition-show":"scale","transition-hide":"scale",modelValue:l.popups[s.name],"onUpdate:modelValue":n=>l.popups[s.name]=n},{default:m(()=>[i(Je,{onRangeEnd:n=>{o.setDateRange(s.name,s.range_input_name,s.range_from_name,s.range_to_name),o.filter()},modelValue:l.formData2[s.name],"onUpdate:modelValue":n=>l.formData2[s.name]=n,range:""},null,8,["onRangeEnd","modelValue","onUpdate:modelValue"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue","label"])])):N("",!0)]))),128))])])}var Jt=W(Gt,[["render",Xt]]);const Zt={components:{AssignReviewers2:bt,FileUploader2:Ht,ProposalFilter:Jt,AssignedProposals:Ut},name:"ReviewerList",data(){return{show:!1,formData:{theme:null,exclude__status:"EDITING",submission_date_lte:"2025-06-24",submission_date_gte:"2025-01-01",call:this.$dataStore.currentCall.id},proposals:[],scores:[],themes:[],selectedProposals:[],selectedProposal:null,allSelected:!1,view:"proposals"}},created(){this.getProposals(),this.getThemes(),this.getReviewers()},methods:{getProposals(e){this.setView(e);let t="";e&&(t=this.$buildURLQuery(e)),this.$api.get(`proposals/?${t}`).then(r=>{this.proposals=r.data,this.view==="scores"&&this.getProposalScores()})},getProposalScores(){for(let e=0;e<this.proposals.length;e++){const t=this.proposals[e];this.$api.get(`scores/?proposal=${t.id}`).then(r=>{this.proposals[e].scores=r.data})}},setView(e){(e==null?void 0:e.status)&&["REVIEWING","REVIEWED","SELECTED"].includes(e.status)?this.view="scores":this.view="proposals"},getThemes(){this.$api.get("themes/").then(e=>{this.themes=e.data})},getReviewers(){var e=this.$buildURLQuery({themes__in:this.formData.theme});this.$api.get(`users/?${e}&groups__name__in=reviewer`).then(t=>{this.reviewers=t.data})},createScores(e){this.$utilsStore.setLoading(!0);const t=e.length*this.selectedProposals.length;let r=0;for(let c=0;c<e.length;c++){const l=e[c],o=this.reviewers.find(s=>s.id==l).email;for(let s=0;s<this.selectedProposals.length;s++){const n=this.selectedProposals[s];this.$api.post("scores/",{proposal:n,email:o,user:l}).then(g=>{r+=1,g.status==201&&console.log("done >> "+l+", "+n),r==t&&(this.$utilsStore.setLoading(!1),this.getProposalScores())}).catch(g=>{r+=1,r==t&&(this.$utilsStore.setLoading(!1),this.getProposalScores())})}}},deleteScore(e){confirm("Are you sure you would like to delete this reviewer?")&&(this.$utilsStore.setLoading(!0),this.$api.delete(`scores/${e}/`).then(t=>{t.status==204&&(this.getProposalScores(),this.$utilsStore.setLoading(!1))}))},selectProposal(e){this.selectedProposals.includes(e)?this.selectedProposals=this.selectedProposals.filter(t=>t!=e):this.selectedProposals.push(e),this.selectedProposals.length==this.proposals.length&&(this.allSelected=!0)},selectProposal2(e){this.selectAllProposals=[],this.selectedProposals.push(e),this.selectedProposal=e,this.show=!0},selectAllProposals(e){e.target.checked?this.selectedProposals=this.proposals.map(t=>t.id):this.selectedProposals=[]},downloadTemplate(){this.$api.get("proposals/bulk-upload-sheet/download/").then(e=>{e.status==200&&window.open(e.data.file_url,"_blank")})}}},A=e=>(be("data-v-1657db9b"),e=e(),we(),e),es={class:"q-ma-md"},ts={class:"q-ma-sm row items-center"},ss={class:"flex border"},os=A(()=>a("label",{class:"row items-center q-pr-xs"},"Bulk Upload",-1)),ls=A(()=>a("div",{class:"col"},null,-1)),ns={class:"col"},rs={key:0},as={align:"left"},is=["checked"],us=A(()=>a("th",{align:"left"},"Title",-1)),ds=A(()=>a("th",{align:"left"},"Theme",-1)),cs=A(()=>a("th",{align:"left"},"Date Submitted",-1)),ps=A(()=>a("th",{align:"left"},"PI",-1)),ms=A(()=>a("th",{align:"left"},"Status",-1)),fs=A(()=>a("th",{align:"left"},null,-1)),vs=["checked","onClick"];function hs(e,t,r,c,l,o){const s=R("FileUploader2"),n=R("AssignReviewers2"),g=R("router-link"),P=R("ProposalFilter"),h=R("AssignedProposals");return p(),$(xe,null,{default:m(()=>[a("div",es,[i(Ae,null,{default:m(()=>[i(ie,{icon:"home",to:"/",label:"Home"}),i(ie,{label:"Submitted Proposals",icon:"list"})]),_:1})]),i(se,{spaced:""}),a("div",ts,[i(le,{class:"my-card q-pa-xs",flat:"",bordered:""},{default:m(()=>[a("div",ss,[os,i(E,{color:"primary",icon:"download",dense:"",flat:"",onClick:o.downloadTemplate,label:"template"},null,8,["onClick"]),i(s,{uploadUrl:"/proposals/upload-bulk/",multiple:!1,formData:{}})])]),_:1}),ls,a("div",ns,[a("div",null,[i(Se,{modelValue:l.show,"onUpdate:modelValue":t[1]||(t[1]=d=>l.show=d),breakpoint:1e3},{default:m(()=>[i(n,{reviewers:e.reviewers,onReviewersSelected:t[0]||(t[0]=d=>{o.createScores(d),l.show=!1})},null,8,["reviewers"])]),_:1},8,["modelValue"])]),i(g,{to:"/go/proposals/reviewed"},{default:m(()=>[i(E,{color:"primary",flat:"",label:"Go To Reviews",class:"q-mr-sm"})]),_:1})])]),i(P,{onFilter:t[2]||(t[2]=d=>o.getProposals(d))}),l.view==="proposals"?(p(),S("div",rs,[i(Pe,{class:"q-ma-sm",flat:"",bordered:""},{default:m(()=>[a("thead",null,[a("tr",null,[a("th",as,[a("input",{checked:l.allSelected,type:"checkbox",onClick:t[3]||(t[3]=d=>o.selectAllProposals(d))},null,8,is)]),us,ds,cs,ps,ms,fs])]),a("tbody",null,[(p(!0),S(T,null,D(l.proposals,d=>(p(),S("tr",{key:d.id},[a("td",null,[a("input",{checked:l.selectedProposals.includes(d.id),type:"checkbox",onClick:f=>o.selectProposal(d.id)},null,8,vs)]),a("td",null,[i(g,{to:`/proposals/${d.id}`},{default:m(()=>[Q(y(d.title),1)]),_:2},1032,["to"])]),a("td",null,y(d.theme_title),1),a("td",null,y(d.submission_date),1),a("td",null,y(d.user__first_name)+" "+y(d.user__last_name),1),a("td",null,y(d.status),1),a("td",null,[i(E,{onClick:f=>o.selectProposal2(d.id),label:"Assign Reviewers",flat:"",color:"primary"},null,8,["onClick"]),(p(!0),S(T,null,D(d.scores,f=>(p(),$(ke,{key:f.id},{default:m(()=>[Q(y(f.user__first_name)+" "+y(f.user__last_name)+" ",1),i(O,{name:"delete",onClick:w=>o.deleteScore(f.id),class:"cursor-pointer"},null,8,["onClick"])]),_:2},1024))),128))])]))),128))])]),_:1})])):N("",!0),l.view==="scores"?(p(),$(h,{key:1,proposals:l.proposals},null,8,["proposals"])):N("",!0)]),_:1})}var Js=W(Zt,[["render",hs],["__scopeId","data-v-1657db9b"]]);export{Js as default};
