import{n as N,m as K,s as S,E as X,y as Y,p as g,a7 as Z,I as ee,x as te,_ as q,r as v,o as s,j as h,f as t,w as l,F,k as x,g as w,e as m,h as p,t as D,v as $,l as le,Q as re,i as ne}from"./index.f337fba3.js";import{Q as ae}from"./QToolbarTitle.42ac391f.js";import{Q as ie}from"./QChip.3c79b892.js";import{Q as oe,a as se,b as ue}from"./QLayout.148bfe8f.js";import{Q as ce}from"./QHeader.1e7b8e34.js";import{Q as fe}from"./QDrawer.c0069188.js";import{a as B}from"./api.6aa31d0d.js";import{Q as k}from"./QItemLabel.7bea3d83.js";import{Q as b,a as Q}from"./QItem.d2d6991a.js";import{Q as L}from"./QList.f16661b5.js";import{Q as R}from"./QSeparator.6c6f2516.js";import{C as M}from"./ClosePopup.090a0f71.js";import{Q as de}from"./QBtnDropdown.80114b33.js";import{_ as he}from"./logo.151e68dc.js";import"./use-dark.1793b84e.js";import"./scroll.e1bc6034.js";import"./use-prevent-scroll.cbde5022.js";import"./use-timeout.d7fa171a.js";import"./TouchPan.692d7062.js";import"./touch.3df10340.js";import"./selection.7f679905.js";import"./format.3e32b8d9.js";import"./axios.68c0a364.js";import"./focusout.1add3e24.js";import"./focus-manager.b507780d.js";import"./QBtnGroup.88d9ef78.js";import"./QMenu.6c1f0454.js";import"./use-transition.41dca9ee.js";import"./uid.42677368.js";const me={ratio:[String,Number]};function ge(e,n){return N(()=>{const f=Number(e.ratio||(n!==void 0?n.value:void 0));return isNaN(f)!==!0&&f>0?{paddingBottom:`${100/f}%`}:null})}const pe=16/9;var _e=K({name:"QImg",props:{...me,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:pe},placeholderSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(e,{slots:n,emit:f}){const _=S(e.initialRatio),i=ge(e,_);let o=null,c=!1;const a=[S(null),S(P())],u=S(0),d=S(!1),C=S(!1),y=N(()=>`q-img q-img--${e.noNativeMenu===!0?"no-":""}menu`),H=N(()=>({width:e.width,height:e.height})),O=N(()=>`q-img__image ${e.imgClass!==void 0?e.imgClass+" ":""}q-img__image--with${e.noTransition===!0?"out":""}-transition`),V=N(()=>({...e.imgStyle,objectFit:e.fit,objectPosition:e.position}));X(()=>G(),I);function G(){return e.src||e.srcset||e.sizes?{src:e.src,srcset:e.srcset,sizes:e.sizes}:null}function P(){return e.placeholderSrc!==void 0?{src:e.placeholderSrc}:null}function I(r){o!==null&&(clearTimeout(o),o=null),C.value=!1,r===null?(d.value=!1,a[u.value^1].value=P()):d.value=!0,a[u.value].value=r}function j({target:r}){c!==!0&&(o!==null&&(clearTimeout(o),o=null),_.value=r.naturalHeight===0?.5:r.naturalWidth/r.naturalHeight,U(r,1))}function U(r,T){c===!0||T===1e3||(r.complete===!0?E(r):o=setTimeout(()=>{o=null,U(r,T+1)},50))}function E(r){c!==!0&&(u.value=u.value^1,a[u.value].value=null,d.value=!1,C.value=!1,f("load",r.currentSrc||r.src))}function W(r){o!==null&&(clearTimeout(o),o=null),d.value=!1,C.value=!0,a[u.value].value=null,a[u.value^1].value=P(),f("error",r)}function z(r){const T=a[r].value,A={key:"img_"+r,class:O.value,style:V.value,crossorigin:e.crossorigin,decoding:e.decoding,referrerpolicy:e.referrerpolicy,height:e.height,width:e.width,loading:e.loading,fetchpriority:e.fetchpriority,"aria-hidden":"true",draggable:e.draggable,...T};return u.value===r?(A.class+=" q-img__image--waiting",Object.assign(A,{onLoad:j,onError:W})):A.class+=" q-img__image--loaded",g("div",{class:"q-img__container absolute-full",key:"img"+r},g("img",A))}function J(){return d.value!==!0?g("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},ee(n[C.value===!0?"error":"default"])):g("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},n.loading!==void 0?n.loading():e.noSpinner===!0?void 0:[g(te,{color:e.spinnerColor,size:e.spinnerSize})])}return I(G()),Y(()=>{c=!0,o!==null&&(clearTimeout(o),o=null)}),()=>{const r=[];return i.value!==null&&r.push(g("div",{key:"filler",style:i.value})),C.value!==!0&&(a[0].value!==null&&r.push(z(0)),a[1].value!==null&&r.push(z(1))),r.push(g(Z,{name:"q-transition--fade"},J)),g("div",{class:y.value,style:H.value,role:"img","aria-label":e.alt},r)}}});const Ce={name:"CallMenu",data(){return{calls:[],currentCall:null,currentUser:this.$authStore.currentUser}},computed:{otherCalls(){return this.currentCall?this.calls.filter(e=>e.id!=this.currentCall.id):[]},menuItems(){return this.$userHasAnyGroups(["applicant"])?[{name:"My Proposals",icon:"note",route:"/applicant/proposals"},{name:"Profile",icon:"person",route:"/account/profile"}]:this.$userHasAnyGroups(["reviewer"])?[{name:"Reviews",icon:"note",route:"/proposal-reviews"},{name:"Profile",icon:"person",route:"/account/profile"}]:this.$userHasAnyGroups(["grants_officer"])?[{name:"All Proposals",icon:"note",route:"/proposals"},{name:"Profile",icon:"person",route:"/account/profile"}]:[]}},created(){B().then(e=>{if(this.calls=e,this.calls.length){var n=this.calls[0];this.setCurrentCall(this.$dataStore.currentCall||n)}else this.setCurrentCall({title:"No Call Found"})})},methods:{navigateTo(e){this.$router.push(e)},changeCurrentCall(e){this.setCurrentCall(e),window.location="/"},setCurrentCall(e){this.currentCall=e,this.$dataStore.setCall(this.currentCall)}}},ve={key:0},ye={key:0};function Se(e,n,f,_,i,o){const c=v("router-link");return i.currentUser&&e.$userHasAnyGroups(["grants_officer"])?(s(),h("div",ve,[i.calls.length?(s(),h("div",ye,[t(L,null,{default:l(()=>[(s(!0),h(F,null,x(i.calls,a=>{var u;return w((s(),m(b,{key:a.id,active:a.id==((u=i.currentCall)==null?void 0:u.id),"active-class":"bg-primary text-white",clickable:"",onClick:d=>o.changeCurrentCall(a)},{default:l(()=>[t(Q,null,{default:l(()=>[t(k,null,{default:l(()=>[p(D(a.title),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["active","onClick"])),[[M]])}),128))]),_:1}),t(R,{spaced:""})])):$("",!0),t(L,null,{default:l(()=>[t(c,{to:"/calls"},{default:l(()=>[w((s(),m(b,{clickable:""},{default:l(()=>[t(Q,null,{default:l(()=>[t(k,null,{default:l(()=>[p(" See all calls ...")]),_:1})]),_:1})]),_:1})),[[M]])]),_:1}),t(c,{to:"/calls/create"},{default:l(()=>[w((s(),m(b,{clickable:""},{default:l(()=>[t(Q,null,{default:l(()=>[t(k,null,{default:l(()=>[p(" Create New Call ")]),_:1})]),_:1})]),_:1})),[[M]])]),_:1})]),_:1})])):$("",!0)}var we=q(Ce,[["render",Se]]);const $e={name:"CallMenu",data(){return{calls:[],currentCall:null,currentUser:this.$authStore.currentUser}},computed:{otherCalls(){return this.currentCall?this.calls.filter(e=>e.id!=this.currentCall.id):[]},menuItems(){return this.$userHasAnyGroups(["applicant"])?[{name:"My Proposals",icon:"note",route:"/applicant/proposals"},{name:"Profile",icon:"person",route:"/account/profile"}]:this.$userHasAnyGroups(["reviewer"])?[{name:"Reviews",icon:"note",route:"/proposal-reviews"},{name:"Profile",icon:"person",route:"/account/profile"}]:this.$userHasAnyGroups(["grants_officer"])?[{name:"All Proposals",icon:"note",route:"/proposals"},{name:"Profile",icon:"person",route:"/account/profile"}]:[]}},created(){B().then(e=>{if(this.calls=e,console.log("calls",e),this.calls.length){var n=this.calls[0];console.log("lastcall",this.$dataStore.currentCall),console.log("lastcall",n),this.setCurrentCall(this.$dataStore.currentCall||n)}else this.setCurrentCall({title:"No Call Found"})})},methods:{navigateTo(e){this.$router.push(e)},changeCurrentCall(e){this.setCurrentCall(e),window.location="/"},setCurrentCall(e){this.currentCall=e,this.$dataStore.setCall(this.currentCall)}}},ke={key:0},be={key:0},Qe={key:0},Me={key:1};function Ne(e,n,f,_,i,o){const c=v("router-link");return i.currentCall?(s(),h("span",ke,[i.currentUser&&e.$userHasAnyGroups(["grants_officer"])?(s(),m(de,{key:0,split:"",color:"white",flat:"","no-caps":"",icon:"folder",label:i.currentCall.title,onClick:n[0]||(n[0]=a=>this.$router.push(`/calls/${i.currentCall.id}`))},{default:l(()=>[e.$userHasAnyGroups(["grants_officer"])?(s(),h("div",be,[i.calls.length?(s(),h("div",Qe,[t(L,null,{default:l(()=>[(s(!0),h(F,null,x(i.calls,a=>{var u;return w((s(),m(b,{key:a.id,active:a.id==((u=i.currentCall)==null?void 0:u.id),"active-class":"bg-primary text-white",clickable:"",onClick:d=>o.changeCurrentCall(a)},{default:l(()=>[t(Q,null,{default:l(()=>[t(k,null,{default:l(()=>[p(D(a.title),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["active","onClick"])),[[M]])}),128))]),_:1}),t(R,{spaced:""})])):$("",!0),t(L,null,{default:l(()=>[t(c,{to:"/calls"},{default:l(()=>[w((s(),m(b,{clickable:""},{default:l(()=>[t(Q,null,{default:l(()=>[t(k,null,{default:l(()=>[p(" See all calls ...")]),_:1})]),_:1})]),_:1})),[[M]])]),_:1}),t(c,{to:"/calls/create"},{default:l(()=>[w((s(),m(b,{clickable:""},{default:l(()=>[t(Q,null,{default:l(()=>[t(k,null,{default:l(()=>[p(" Create New Call ")]),_:1})]),_:1})]),_:1})),[[M]])]),_:1})]),_:1})])):$("",!0)]),_:1},8,["label"])):(s(),h("span",Me," > "+D(i.currentCall.title),1))])):$("",!0)}var He=q($e,[["render",Ne]]);const Te={name:"MainLayout",components:{CallMenu:we,DropdownCallMenu:He},data(){return{leftDrawerOpen:!1,calls:[],currentCall:null}},computed:{otherCalls(){return this.currentCall?this.calls.filter(e=>e.id!=this.currentCall.id):[]}},created(){this.$authStore.currentUser||(location.href="/index/account/signin"),this.getCalls()},methods:{toggleLeftDrawer(){this.leftDrawerOpen=!this.leftDrawerOpen},getCalls(){B().then(e=>{if(this.calls=e,this.calls.length)if(this.$userHasAnyGroups(["applicant","reviewer"])){var n=this.calls.find(_=>_.is_active);n?this.setCurrentCall(n||{title:"No Call Found"}):this.$router.push("/no-call-found")}else{var f=this.calls[0];this.setCurrentCall(this.$dataStore.currentCall||f)}else this.setCurrentCall({title:"No Call Found"}),this.$userHasAnyGroups(["grants_officer"])?this.$router.push("/calls"):this.$router.push("/no-call-found")})},changeCurrentCall(e){this.setCurrentCall(e),window.location.reload()},setCurrentCall(e){this.currentCall=e,this.$dataStore.setCall(this.currentCall)},logout(){this.$utilsStore.setLoading(!0),this.$api.get("/accounts/logout/").then(e=>{this.$authStore.clearUserAndToken(),this.$router.push("/login"),this.$utilsStore.setLoading(!1)})}}},Ae={key:1},De={class:"text-orange-3 q-px-xs"};function Le(e,n,f,_,i,o){const c=v("loading-component"),a=v("DropdownCallMenu"),u=v("router-link"),d=v("CallMenu"),C=v("router-view");return i.currentCall?(s(),m(ue,{key:0,view:"hHh Lpr lFf"},{default:l(()=>[t(c),t(ce,{elevated:""},{default:l(()=>[t(oe,null,{default:l(()=>[t(le,{flat:"",dense:"",round:"",icon:"menu","aria-label":"Menu",onClick:o.toggleLeftDrawer},null,8,["onClick"]),t(ae,null,{default:l(()=>[p(" Muni RIF "),e.$userHasAnyGroups(["grants_officer"])?(s(),m(a,{key:0})):(s(),h("span",Ae,[t(re,{name:"arrow_right",size:"md"}),p(" "+D(this.currentCall.title),1)]))]),_:1}),ne("div",De,[t(u,{to:"/account/profile"},{default:l(()=>{var y,H;return[t(ie,{class:"glossy",icon:"person",label:`${(y=e.$authStore.currentUser)==null?void 0:y.first_name} ${(H=e.$authStore.currentUser)==null?void 0:H.last_name}`},null,8,["label"])]}),_:1})])]),_:1})]),_:1}),t(fe,{modelValue:i.leftDrawerOpen,"onUpdate:modelValue":n[0]||(n[0]=y=>i.leftDrawerOpen=y),class:"bg-grey-2",bordered:"",width:220},{default:l(()=>[t(_e,{src:he,"spinner-color":"primary","spinner-size":"72px"}),t(d)]),_:1},8,["modelValue"]),t(se,null,{default:l(()=>[t(C)]),_:1})]),_:1})):$("",!0)}var ut=q(Te,[["render",Le]]);export{ut as default};
