import{Q as Ae,a as ue}from"./QBreadcrumbs.1ab673fe.js";import{Q as oe}from"./QSeparator.70cb9cc4.js";import{m as L,y as Re,p as k,a7 as ge,s as G,n as x,Q as Y,g as Ue,R as Be,D as X,a1 as Fe,aw as F,ab as Ne,aG as Le,ap as z,aH as Z,z as de,G as ee,ao as te,E as We,O as Ke,aK as Me,I as U,aU as ye,V as je,W as se,aV as be,ai as ze,q as He,C as Ge,_ as W,o as m,j as w,f as i,w as f,e as I,l as $,v as N,F as V,k as D,i as a,h as A,t as v,r as R,aM as we,aN as Se,x as Oe,aW as Ye}from"./index.0c070ef5.js";import{Q as O}from"./QCard.63eb6402.js";import{Q as ke}from"./QPopupProxy.265bdd00.js";import{Q as Pe}from"./QChip.6de0f260.js";import{Q as le}from"./QMarkupTable.8c21dc1a.js";import{Q as xe}from"./QPage.4657c376.js";import{Q as Ce,a as ne}from"./QItem.80427ce1.js";import{Q as qe}from"./QList.51e4b513.js";import{g as ce,s as pe}from"./touch.3df10340.js";import{c as Xe}from"./selection.e8c2ee0a.js";import{u as Ve,Q as Je}from"./QDate.0c3a2ed0.js";import{a as Ze,u as et}from"./use-dark.f75a96f1.js";import{u as tt}from"./use-quasar.aa9c13f7.js";import{Q as H}from"./QCardSection.cb2f8249.js";import{Q as me}from"./QItemLabel.a3542404.js";import{Q as st}from"./QUploader.651ef1bf.js";import{Q as ot}from"./QDialog.6b58c502.js";import{Q as lt}from"./QSelect.6524c030.js";import{Q as fe}from"./QInput.01de1739.js";import"./QMenu.06d3a3b6.js";import"./use-timeout.e38298e7.js";import"./focusout.5b955b74.js";import"./focus-manager.b507780d.js";import"./use-transition.aac813e1.js";import"./scroll.10606e11.js";import"./use-form.e5c6d76e.js";import"./format.2bc25e5f.js";import"./QCircularProgress.c52100be.js";import"./use-file.030a57c2.js";import"./use-prevent-scroll.1187d5af.js";import"./use-key-composition.b5f616a9.js";import"./use-split-attrs.9a899efb.js";import"./uid.42677368.js";var nt=L({name:"QSlideTransition",props:{appear:Boolean,duration:{type:Number,default:300}},emits:["show","hide"],setup(e,{slots:t,emit:r}){let p=!1,l,o,s=null,n=null,y,P;function _(){l&&l(),l=null,p=!1,s!==null&&(clearTimeout(s),s=null),n!==null&&(clearTimeout(n),n=null),o!==void 0&&o.removeEventListener("transitionend",y),y=null}function d(h,u,b){u!==void 0&&(h.style.height=`${u}px`),h.style.transition=`height ${e.duration}ms cubic-bezier(.25, .8, .50, 1)`,p=!0,l=b}function c(h,u){h.style.overflowY=null,h.style.height=null,h.style.transition=null,_(),u!==P&&r(u)}function S(h,u){let b=0;o=h,p===!0?(_(),b=h.offsetHeight===h.scrollHeight?0:void 0):(P="hide",h.style.overflowY="hidden"),d(h,b,u),s=setTimeout(()=>{s=null,h.style.height=`${h.scrollHeight}px`,y=q=>{n=null,(Object(q)!==q||q.target===h)&&c(h,"show")},h.addEventListener("transitionend",y),n=setTimeout(y,e.duration*1.1)},100)}function T(h,u){let b;o=h,p===!0?_():(P="show",h.style.overflowY="hidden",b=h.scrollHeight),d(h,b,u),s=setTimeout(()=>{s=null,h.style.height=0,y=q=>{n=null,(Object(q)!==q||q.target===h)&&c(h,"hide")},h.addEventListener("transitionend",y),n=setTimeout(y,e.duration*1.1)},100)}return Re(()=>{p===!0&&_()}),()=>k(ge,{css:!1,appear:e.appear,onEnter:S,onLeave:T},t.default)}}),Te=L({name:"StepHeader",props:{stepper:{},step:{},goToPanel:Function},setup(e,{attrs:t}){const{proxy:{$q:r}}=X(),p=G(null),l=x(()=>e.stepper.modelValue===e.step.name),o=x(()=>{const u=e.step.disable;return u===!0||u===""}),s=x(()=>{const u=e.step.error;return u===!0||u===""}),n=x(()=>{const u=e.step.done;return o.value===!1&&(u===!0||u==="")}),y=x(()=>{const u=e.step.headerNav,b=u===!0||u===""||u===void 0;return o.value===!1&&e.stepper.headerNav&&b}),P=x(()=>e.step.prefix&&(l.value===!1||e.stepper.activeIcon==="none")&&(s.value===!1||e.stepper.errorIcon==="none")&&(n.value===!1||e.stepper.doneIcon==="none")),_=x(()=>{const u=e.step.icon||e.stepper.inactiveIcon;if(l.value===!0){const b=e.step.activeIcon||e.stepper.activeIcon;return b==="none"?u:b||r.iconSet.stepper.active}if(s.value===!0){const b=e.step.errorIcon||e.stepper.errorIcon;return b==="none"?u:b||r.iconSet.stepper.error}if(o.value===!1&&n.value===!0){const b=e.step.doneIcon||e.stepper.doneIcon;return b==="none"?u:b||r.iconSet.stepper.done}return u}),d=x(()=>{const u=s.value===!0?e.step.errorColor||e.stepper.errorColor:void 0;if(l.value===!0){const b=e.step.activeColor||e.stepper.activeColor||e.step.color;return b!==void 0?b:u}return u!==void 0?u:o.value===!1&&n.value===!0?e.step.doneColor||e.stepper.doneColor||e.step.color||e.stepper.inactiveColor:e.step.color||e.stepper.inactiveColor}),c=x(()=>"q-stepper__tab col-grow flex items-center no-wrap relative-position"+(d.value!==void 0?` text-${d.value}`:"")+(s.value===!0?" q-stepper__tab--error q-stepper__tab--error-with-"+(P.value===!0?"prefix":"icon"):"")+(l.value===!0?" q-stepper__tab--active":"")+(n.value===!0?" q-stepper__tab--done":"")+(y.value===!0?" q-stepper__tab--navigation q-focusable q-hoverable":"")+(o.value===!0?" q-stepper__tab--disabled":"")),S=x(()=>e.stepper.headerNav!==!0?!1:y.value);function T(){p.value!==null&&p.value.focus(),l.value===!1&&e.goToPanel(e.step.name)}function h(u){u.keyCode===13&&l.value===!1&&e.goToPanel(e.step.name)}return()=>{const u={class:c.value};y.value===!0&&(u.onClick=T,u.onKeyup=h,Object.assign(u,o.value===!0?{tabindex:-1,"aria-disabled":"true"}:{tabindex:t.tabindex||0}));const b=[k("div",{class:"q-focus-helper",tabindex:-1,ref:p}),k("div",{class:"q-stepper__dot row flex-center q-stepper__line relative-position"},[k("span",{class:"row flex-center"},[P.value===!0?e.step.prefix:k(Y,{name:_.value})])])];if(e.step.title!==void 0&&e.step.title!==null){const q=[k("div",{class:"q-stepper__title"},e.step.title)];e.step.caption!==void 0&&e.step.caption!==null&&q.push(k("div",{class:"q-stepper__caption"},e.step.caption)),b.push(k("div",{class:"q-stepper__label q-stepper__line relative-position"},q))}return Ue(k("div",u,b),[[Be,S.value]])}}});function at(e){const t=[.06,6,50];return typeof e=="string"&&e.length&&e.split(":").forEach((r,p)=>{const l=parseFloat(r);l&&(t[p]=l)}),t}var rt=Fe({name:"touch-swipe",beforeMount(e,{value:t,arg:r,modifiers:p}){if(p.mouse!==!0&&F.has.touch!==!0)return;const l=p.mouseCapture===!0?"Capture":"",o={handler:t,sensitivity:at(r),direction:ce(p),noop:Ne,mouseStart(s){pe(s,o)&&Le(s)&&(z(o,"temp",[[document,"mousemove","move",`notPassive${l}`],[document,"mouseup","end","notPassiveCapture"]]),o.start(s,!0))},touchStart(s){if(pe(s,o)){const n=s.target;z(o,"temp",[[n,"touchmove","move","notPassiveCapture"],[n,"touchcancel","end","notPassiveCapture"],[n,"touchend","end","notPassiveCapture"]]),o.start(s)}},start(s,n){F.is.firefox===!0&&Z(e,!0);const y=de(s);o.event={x:y.left,y:y.top,time:Date.now(),mouse:n===!0,dir:!1}},move(s){if(o.event===void 0)return;if(o.event.dir!==!1){ee(s);return}const n=Date.now()-o.event.time;if(n===0)return;const y=de(s),P=y.left-o.event.x,_=Math.abs(P),d=y.top-o.event.y,c=Math.abs(d);if(o.event.mouse!==!0){if(_<o.sensitivity[1]&&c<o.sensitivity[1]){o.end(s);return}}else if(window.getSelection().toString()!==""){o.end(s);return}else if(_<o.sensitivity[2]&&c<o.sensitivity[2])return;const S=_/n,T=c/n;o.direction.vertical===!0&&_<c&&_<100&&T>o.sensitivity[0]&&(o.event.dir=d<0?"up":"down"),o.direction.horizontal===!0&&_>c&&c<100&&S>o.sensitivity[0]&&(o.event.dir=P<0?"left":"right"),o.direction.up===!0&&_<c&&d<0&&_<100&&T>o.sensitivity[0]&&(o.event.dir="up"),o.direction.down===!0&&_<c&&d>0&&_<100&&T>o.sensitivity[0]&&(o.event.dir="down"),o.direction.left===!0&&_>c&&P<0&&c<100&&S>o.sensitivity[0]&&(o.event.dir="left"),o.direction.right===!0&&_>c&&P>0&&c<100&&S>o.sensitivity[0]&&(o.event.dir="right"),o.event.dir!==!1?(ee(s),o.event.mouse===!0&&(document.body.classList.add("no-pointer-events--children"),document.body.classList.add("non-selectable"),Xe(),o.styleCleanup=h=>{o.styleCleanup=void 0,document.body.classList.remove("non-selectable");const u=()=>{document.body.classList.remove("no-pointer-events--children")};h===!0?setTimeout(u,50):u()}),o.handler({evt:s,touch:o.event.mouse!==!0,mouse:o.event.mouse,direction:o.event.dir,duration:n,distance:{x:_,y:c}})):o.end(s)},end(s){o.event!==void 0&&(te(o,"temp"),F.is.firefox===!0&&Z(e,!1),o.styleCleanup!==void 0&&o.styleCleanup(!0),s!==void 0&&o.event.dir!==!1&&ee(s),o.event=void 0)}};if(e.__qtouchswipe=o,p.mouse===!0){const s=p.mouseCapture===!0||p.mousecapture===!0?"Capture":"";z(o,"main",[[e,"mousedown","mouseStart",`passive${s}`]])}F.has.touch===!0&&z(o,"main",[[e,"touchstart","touchStart",`passive${p.capture===!0?"Capture":""}`],[e,"touchmove","noop","notPassiveCapture"]])},updated(e,t){const r=e.__qtouchswipe;r!==void 0&&(t.oldValue!==t.value&&(typeof t.value!="function"&&r.end(),r.handler=t.value),r.direction=ce(t.modifiers))},beforeUnmount(e){const t=e.__qtouchswipe;t!==void 0&&(te(t,"main"),te(t,"temp"),F.is.firefox===!0&&Z(e,!1),t.styleCleanup!==void 0&&t.styleCleanup(),delete e.__qtouchswipe)}});const it={name:{required:!0},disable:Boolean},ve={setup(e,{slots:t}){return()=>k("div",{class:"q-panel scroll",role:"tabpanel"},U(t.default))}},ut={modelValue:{required:!0},animated:Boolean,infinite:Boolean,swipeable:Boolean,vertical:Boolean,transitionPrev:String,transitionNext:String,transitionDuration:{type:[String,Number],default:300},keepAlive:Boolean,keepAliveInclude:[String,Array,RegExp],keepAliveExclude:[String,Array,RegExp],keepAliveMax:Number},dt=["update:modelValue","beforeTransition","transition"];function ct(){const{props:e,emit:t,proxy:r}=X(),{getCacheWithFn:p}=Ve();let l,o;const s=G(null),n=G(null);function y(g){const C=e.vertical===!0?"up":"left";B((r.$q.lang.rtl===!0?-1:1)*(g.direction===C?1:-1))}const P=x(()=>[[rt,y,void 0,{horizontal:e.vertical!==!0,vertical:e.vertical,mouse:!0}]]),_=x(()=>e.transitionPrev||`slide-${e.vertical===!0?"down":"right"}`),d=x(()=>e.transitionNext||`slide-${e.vertical===!0?"up":"left"}`),c=x(()=>`--q-transition-duration: ${e.transitionDuration}ms`),S=x(()=>typeof e.modelValue=="string"||typeof e.modelValue=="number"?e.modelValue:String(e.modelValue)),T=x(()=>({include:e.keepAliveInclude,exclude:e.keepAliveExclude,max:e.keepAliveMax})),h=x(()=>e.keepAliveInclude!==void 0||e.keepAliveExclude!==void 0);We(()=>e.modelValue,(g,C)=>{const E=M(g)===!0?J(g):-1;o!==!0&&ae(E===-1?0:E<J(C)?-1:1),s.value!==E&&(s.value=E,t("beforeTransition",g,C),Ke(()=>{t("transition",g,C)}))});function u(){B(1)}function b(){B(-1)}function q(g){t("update:modelValue",g)}function M(g){return g!=null&&g!==""}function J(g){return l.findIndex(C=>C.props.name===g&&C.props.disable!==""&&C.props.disable!==!0)}function $e(){return l.filter(g=>g.props.disable!==""&&g.props.disable!==!0)}function ae(g){const C=g!==0&&e.animated===!0&&s.value!==-1?"q-transition--"+(g===-1?_.value:d.value):null;n.value!==C&&(n.value=C)}function B(g,C=s.value){let E=C+g;for(;E>-1&&E<l.length;){const j=l[E];if(j!==void 0&&j.props.disable!==""&&j.props.disable!==!0){ae(g),o=!0,t("update:modelValue",j.props.name),setTimeout(()=>{o=!1});return}E+=g}e.infinite===!0&&l.length!==0&&C!==-1&&C!==l.length&&B(g,g===-1?l.length:-1)}function re(){const g=J(e.modelValue);return s.value!==g&&(s.value=g),!0}function ie(){const g=M(e.modelValue)===!0&&re()&&l[s.value];return e.keepAlive===!0?[k(ye,T.value,[k(h.value===!0?p(S.value,()=>({...ve,name:S.value})):ve,{key:S.value,style:c.value},()=>g)])]:[k("div",{class:"q-panel scroll",style:c.value,key:S.value,role:"tabpanel"},[g])]}function Ie(){if(l.length!==0)return e.animated===!0?[k(ge,{name:n.value},ie)]:ie()}function Ee(g){return l=Me(U(g.default,[])).filter(C=>C.props!==null&&C.props.slot===void 0&&M(C.props.name)===!0),l.length}function Qe(){return l}return Object.assign(r,{next:u,previous:b,goTo:q}),{panelIndex:s,panelDirectives:P,updatePanelsList:Ee,updatePanelIndex:re,getPanelContent:Ie,getEnabledPanels:$e,getPanels:Qe,isValidPanelName:M,keepAliveProps:T,needsUniqueKeepAliveWrapper:h,goToPanelByOffset:B,goToPanel:q,nextPanel:u,previousPanel:b}}function De(e){return k("div",{class:"q-stepper__step-content"},[k("div",{class:"q-stepper__step-inner"},U(e.default))])}const he={setup(e,{slots:t}){return()=>De(t)}};var _e=L({name:"QStep",props:{...it,icon:String,color:String,title:{type:String,required:!0},caption:String,prefix:[String,Number],doneIcon:String,doneColor:String,activeIcon:String,activeColor:String,errorIcon:String,errorColor:String,headerNav:{type:Boolean,default:!0},done:Boolean,error:Boolean,onScroll:[Function,Array]},setup(e,{slots:t,emit:r}){const{proxy:{$q:p}}=X(),l=je(be,se);if(l===se)return console.error("QStep needs to be a child of QStepper"),se;const{getCacheWithFn:o}=Ve(),s=G(null),n=x(()=>l.value.modelValue===e.name),y=x(()=>p.platform.is.ios!==!0&&p.platform.is.chrome===!0||n.value!==!0||l.value.vertical!==!0?{}:{onScroll(d){const{target:c}=d;c.scrollTop>0&&(c.scrollTop=0),e.onScroll!==void 0&&r("scroll",d)}}),P=x(()=>typeof e.name=="string"||typeof e.name=="number"?e.name:String(e.name));function _(){const d=l.value.vertical;return d===!0&&l.value.keepAlive===!0?k(ye,l.value.keepAliveProps.value,n.value===!0?[k(l.value.needsUniqueKeepAliveWrapper.value===!0?o(P.value,()=>({...he,name:P.value})):he,{key:P.value},t.default)]:void 0):d!==!0||n.value===!0?De(t):void 0}return()=>k("div",{ref:s,class:"q-stepper__step",role:"tabpanel",...y.value},l.value.vertical===!0?[k(Te,{stepper:l.value,step:e,goToPanel:l.value.goToPanel}),l.value.animated===!0?k(nt,_):_()]:[_()])}}),pt=L({name:"QStepperNavigation",setup(e,{slots:t}){return()=>k("div",{class:"q-stepper__nav"},U(t.default))}});const mt=/(-\w)/g;function ft(e){const t={};for(const r in e){const p=r.replace(mt,l=>l[1].toUpperCase());t[p]=e[r]}return t}var vt=L({name:"QStepper",props:{...Ze,...ut,flat:Boolean,bordered:Boolean,alternativeLabels:Boolean,headerNav:Boolean,contracted:Boolean,headerClass:String,inactiveColor:String,inactiveIcon:String,doneIcon:String,doneColor:String,activeIcon:String,activeColor:String,errorIcon:String,errorColor:String},emits:dt,setup(e,{slots:t}){const r=X(),p=et(e,r.proxy.$q),{updatePanelsList:l,isValidPanelName:o,updatePanelIndex:s,getPanelContent:n,getPanels:y,panelDirectives:P,goToPanel:_,keepAliveProps:d,needsUniqueKeepAliveWrapper:c}=ct();ze(be,x(()=>({goToPanel:_,keepAliveProps:d,needsUniqueKeepAliveWrapper:c,...e})));const S=x(()=>`q-stepper q-stepper--${e.vertical===!0?"vertical":"horizontal"}`+(e.flat===!0?" q-stepper--flat":"")+(e.bordered===!0?" q-stepper--bordered":"")+(p.value===!0?" q-stepper--dark q-dark":"")),T=x(()=>`q-stepper__header row items-stretch justify-between q-stepper__header--${e.alternativeLabels===!0?"alternative":"standard"}-labels`+(e.flat===!1||e.bordered===!0?" q-stepper__header--border":"")+(e.contracted===!0?" q-stepper__header--contracted":"")+(e.headerClass!==void 0?` ${e.headerClass}`:""));function h(){const u=U(t.message,[]);if(e.vertical===!0){o(e.modelValue)&&s();const b=k("div",{class:"q-stepper__content"},U(t.default));return u===void 0?[b]:u.concat(b)}return[k("div",{class:T.value},y().map(b=>{const q=ft(b.props);return k(Te,{key:q.name,stepper:e,step:q,goToPanel:_})})),u,Ge("div",{class:"q-stepper__content q-panel-parent"},n(),"cont",e.swipeable,()=>P.value)]}return()=>(l(t),k("div",{class:S.value},He(t.navigation,h())))}});const ht={props:["reviewers"],name:"AssignReviewers",data(){return{step:1,selectedReviewers:[]}},methods:{next(){this.step==2?this.$emit("reviewers-selected",this.selectedReviewers):this.$refs.stepper.next()},selectReviewer(e){this.selectedReviewers.includes(e)?this.selectedReviewers=this.selectedReviewers.filter(t=>t!=e):this.selectedReviewers.push(e)}}},_t={style:{height:"500px"}},gt=["checked"];function yt(e,t,r,p,l,o){return m(),w("div",_t,[i(vt,{modelValue:l.step,"onUpdate:modelValue":t[1]||(t[1]=s=>l.step=s),ref:"stepper",color:"primary",animated:""},{navigation:f(()=>[i(pt,{align:"right"},{default:f(()=>[l.step>1?(m(),I($,{key:0,flat:"",color:"primary",onClick:t[0]||(t[0]=s=>e.$refs.stepper.previous()),label:"Back",class:"q-ml-sm"})):N("",!0),i($,{onClick:o.next,disabled:l.selectedReviewers.length==0,color:"primary",label:l.step===2?"Finish":"Continue"},null,8,["onClick","disabled","label"])]),_:1})]),default:f(()=>[i(_e,{name:1,title:"Select Reviewers",icon:"settings",done:l.step>1},{default:f(()=>[i(qe,{bordered:"",class:"",style:{width:"500px","max-height":"280px","overflow-y":"auto"}},{default:f(()=>[(m(!0),w(V,null,D(r.reviewers,s=>(m(),I(Ce,{onClick:n=>o.selectReviewer(s.id),clickable:"",active:l.selectedReviewers.includes(s.id),key:s.id},{default:f(()=>[a("input",{class:"q-ma-sm",type:"checkbox",checked:l.selectedReviewers.includes(s.id)},null,8,gt),i(ne,null,{default:f(()=>[A(v(s.first_name)+" "+v(s.last_name),1)]),_:2},1024)]),_:2},1032,["onClick","active"]))),128))]),_:1})]),_:1},8,["done"]),i(_e,{name:2,title:"Invite Reviewers",icon:"create_new_folder",done:l.step>2},{default:f(()=>[a("p",null,[i(Y,{name:"info",size:"md"}),A(" An email invitation will be sent to each of the selected reviewers ")]),i(O,{class:"my-card",style:{width:"500px",height:"250px","overflow-y":"auto"},flat:"",bordered:""},{default:f(()=>[a("ul",null,[(m(!0),w(V,null,D(r.reviewers.filter(s=>l.selectedReviewers.includes(s.id)),s=>(m(),w("li",{key:s.id},[A(v(s.first_name)+" "+v(s.last_name)+" ("+v(s.email)+") ",1),a("ul",null,[(m(!0),w(V,null,D(s.profile.themes,n=>(m(),w("li",{key:n.id},v(n.theme_title),1))),128))])]))),128))])]),_:1})]),_:1},8,["done"])]),_:1},8,["modelValue"])])}var bt=W(ht,[["render",yt]]);const wt={props:{proposals:{type:Array,default:()=>[]}},name:"ReviewerList",data(){return{formData:{theme:null,call:this.$dataStore.currentCall.id},themes:[],sections:[]}},created(){this.$q=tt(),this.getSections(),this.getThemes()},methods:{getSections(){this.$api.get("sections/").then(e=>{this.sections=e.data.filter(t=>t.max_score>0)})},getThemes(){this.$api.get("themes/").then(e=>{this.themes=e.data})},selectProposal(e,t){const r=e.target.checked;this.$api.patch(`proposals/${t}/`,{is_selected:r}).then(p=>{var l="Proposal added to selected proposals";r||(l="Proposal removed from selected proposals"),this.$q.notify(l)})}}},K=e=>(we("data-v-322d6150"),e=e(),Se(),e),St=K(()=>a("th",{align:"left"},"Title",-1)),kt=K(()=>a("th",{align:"center"},"Total",-1)),Pt=K(()=>a("th",{align:"center"},"Reviewer",-1)),xt=K(()=>a("th",{align:"center"},"Average Score",-1)),Ct=K(()=>a("th",{align:"left"},null,-1)),qt={key:0,class:"q-tr--no-hover text-center"},Vt=["rowspan"],Tt={class:"inner"},Dt=["onClick","checked"],$t={class:"inner"},It=["rowspan"],Et=["rowspan"],Qt={class:""},At={class:""};function Rt(e,t,r,p,l,o){const s=R("router-link");return m(),I(xe,null,{default:f(()=>[i(le,{class:"q-ma-sm my-sticky-column-table","wrap-cells":"",flat:"",bordered:"",dense:""},{default:f(()=>[a("thead",null,[a("tr",null,[St,(m(!0),w(V,null,D(l.sections,n=>(m(),w("th",{key:n.id},v(n.title),1))),128)),kt,Pt,xt,Ct])]),a("tbody",null,[(m(!0),w(V,null,D(r.proposals,n=>{var y,P,_,d,c;return m(),w(V,{key:n.id},[(y=n==null?void 0:n.scores)!=null&&y.length?(m(),w("tr",qt,[a("td",{rowspan:(P=n.scores)==null?void 0:P.length,class:"text-left"},[a("table",null,[a("tbody",null,[a("tr",null,[a("td",Tt,[a("input",{onClick:S=>o.selectProposal(S,n.id),type:"checkbox",checked:n.is_selected},null,8,Dt)]),a("td",$t,[a("span",null,v(n.title)+" ("+v(n.status)+")",1)])])])])],8,Vt),(m(!0),w(V,null,D(l.sections,S=>(m(),w("td",{key:S.id},v(n.scores[0][S.name]),1))),128)),a("td",null,v(n.scores[0].total_score),1),a("td",null,v(n.scores[0].user__first_name)+" "+v(n.scores[0].user__last_name)+" ("+v(n.scores[0].user__username)+") ("+v(n.scores[0].status)+") ",1),a("td",{rowspan:(_=n.scores)==null?void 0:_.length},v(n.average_score),9,It),a("td",{rowspan:(d=n.scores)==null?void 0:d.length},[i(s,{to:`/proposals/${n.id}`},{default:f(()=>[i($,{color:"primary",icon:"remove_red_eye",flat:"",dense:""})]),_:2},1032,["to"])],8,Et)])):N("",!0),(m(!0),w(V,null,D((c=n.scores)==null?void 0:c.slice(1),S=>(m(),w("tr",{class:"q-tr--no-hover text-center",key:S.id},[(m(!0),w(V,null,D(l.sections,T=>(m(),w("td",{class:"exclude",key:T.id},v(S[T.name]),1))),128)),a("td",Qt,"\xA0\xA0"+v(S.total_score),1),a("td",At," \xA0\xA0 "+v(S.user__first_name)+" "+v(S.user__last_name)+" ("+v(S.user__username)+") ("+v(S.status)+") ",1)]))),128))],64)}),128))])]),_:1})]),_:1})}var Ut=W(wt,[["render",Rt],["__scopeId","data-v-322d6150"]]);const Bt={name:"FileUploader",props:["uploadUrl","multiple","formData"],data(){return{modalVisible:!1,uploadHeaders:{},filesToUpload:[],uploadedFiles:[]}},methods:{onFileAdded(e){console.log("file added",e),e.forEach(t=>{this.uploadFile(t)}),this.filesToUpload=[...this.filesToUpload,...e]},onBrowse(e){var t=Array.from(e.target.files);console.log("file added",t),this.onFileAdded(t)},uploadFile(e){console.log(">>>>",e);const t=new FormData;t.append("file",e),console.log("just added file >> form data",t);for(const r in this.formData)this.formData.hasOwnProperty(r)&&t.append(r,this.formData[r]);console.log("form data",t),console.log("url",this.uploadUrl),this.$api.post(this.uploadUrl,t,{headers:this.uploadHeaders}).then(r=>{this.uploadedFiles.push(e),this.filesToUpload=this.filesToUpload.filter(p=>p.key!=e.key),console.log(e),console.log(this.filesToUpload),this.uploadedFiles=[],this.modalVisible=!1,this.$emit("file-uploaded")}).catch(r=>{console.log(r)})}}},Ft=a("div",{class:"text-h6"},"File Upload",-1),Nt=a("div",{class:"text-center q-my-auto q-py-lg",style:{"background-color":"#ffffff",color:"#000000"}}," Drag and drop files here ",-1),Lt={class:"text-center",style:{"background-color":"#ffffff",color:"#000000"}},Wt=a("br",null,null,-1),Kt=a("br",null,null,-1),Mt=["multiple"],jt=a("label",{for:"files",class:"button-label"}," Browse ",-1);function zt(e,t,r,p,l,o){return m(),w("div",null,[i($,{color:"primary",icon:"upload",label:"Upload",dense:"",flat:"",onClick:t[0]||(t[0]=s=>l.modalVisible=!0)}),i(ot,{modelValue:l.modalVisible,"onUpdate:modelValue":t[4]||(t[4]=s=>l.modalVisible=s)},{default:f(()=>[i(O,{style:{"min-width":"400px"}},{default:f(()=>[i(H,{class:"q-pa-sm text-center flex justify-between"},{default:f(()=>[Ft,i($,{color:"primary",icon:"close",flat:"",onClick:t[1]||(t[1]=s=>{l.uploadedFiles=[],l.modalVisible=!1})})]),_:1}),i(oe,{spaced:""}),i(H,{class:"q-pa-sm"},{default:f(()=>[a("div",null,[i(st,{url:r.uploadUrl,multiple:r.multiple,onAdded:o.onFileAdded,style:{width:"100%"}},{header:f(()=>[Nt,a("div",Lt,[A(" or "),Wt,Kt,a("input",{onChange:t[2]||(t[2]=(...s)=>o.onBrowse&&o.onBrowse(...s)),type:"file",id:"files",class:"hidden",multiple:r.multiple},null,40,Mt),jt])]),list:f(()=>[i(qe,{separator:""},{default:f(()=>[(m(!0),w(V,null,D(l.filesToUpload,s=>(m(),I(Ce,{key:s.__key},{default:f(()=>[i(ne,null,{default:f(()=>[i(me,{class:"full-width ellipsis"},{default:f(()=>[A(v(s.name),1)]),_:2},1024),i(me,{caption:""},{default:f(()=>[A(v(s.__sizeLabel)+" / "+v(s.__progressLabel),1)]),_:2},1024)]),_:2},1024),i(ne,{top:"",side:""},{default:f(()=>[i(Oe,{size:"20px",color:"primary"})]),_:1})]),_:2},1024))),128))]),_:1})]),_:1},8,["url","multiple","onAdded"])])]),_:1}),i(H,{class:"q-pa-sm"},{default:f(()=>[(m(!0),w(V,null,D(l.uploadedFiles,s=>(m(),I(Pe,{dense:"",key:s.__key,class:"glossy",icon:"check",label:s.name},null,8,["label"]))),128))]),_:1}),i(oe,{spaced:""}),i(H,{align:"right"},{default:f(()=>[i($,{color:"primary",label:"Done",onClick:t[3]||(t[3]=s=>{l.uploadedFiles=[],l.modalVisible=!1})})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}var Ht=W(Bt,[["render",zt]]);const Gt={name:"ReviewerList",data(){return{formData:{},formData2:{},popups:{},showPopup:!1,fields:[{type:"dateRange",label:"Submission Date",name:"submission_date",range_input_name:"submission_date_text",range_from_name:"submission_date__gte",range_to_name:"submission_date__lte"},{type:"select",label:"Select Theme",options:[],name:"theme"},{type:"select",label:"Status",options:[],name:"status"},{type:"select",label:"PI",options:[],name:"user"},{type:"text",label:"Search",name:"search_query"}]}},created(){this.getThemes(),this.getUsers(),this.getStatusOptions()},methods:{getStatusOptions(){this.fields.filter(e=>e.name=="status")[0].options=[{id:0,title:"None"},{id:"EDITING",title:"EDITING"},{id:"SUBMITTED",title:"SUBMITTED"},{id:"REVIEWING",title:"REVIEWING"},{id:"REVIEWED",title:"REVIEWED"},{id:"SELECTED",title:"SELECTED"}]},async getUsers(){const e=await this.$api.get("users/?groups__name__in=applicant");console.log(e.data);const t=e.data.map(r=>({id:r.id,title:`${r.first_name} ${r.last_name}`}));return this.fields.filter(r=>r.name=="user")[0].options=[{id:0,title:"None"}].concat(t),e.data},async getThemes(){const e=await this.$api.get("themes/");return this.fields.filter(t=>t.name=="theme")[0].options=[{id:0,title:"None"}].concat(e.data),e.data},setDateRange(e,t,r,p){this.formData[r]=this.formData2[e].from,this.formData[p]=this.formData2[e].to,this.formData2[t]=`${this.formData2[e].from} - ${this.formData2[e].to}`,this.popups[e]=!1},filter(){console.log("filter",this.formData),this.$emit("filter",this.formData)}}},Ot={align:"right",class:"q-ma-xs row q-gutter-x-xs"},Yt={key:2,flat:"",class:"no-wrap"};function Xt(e,t,r,p,l,o){return m(),w("div",null,[a("div",Ot,[(m(!0),w(V,null,D(l.fields,s=>(m(),w("div",{class:"col",key:s},[s.type=="select"?(m(),I(lt,{key:0,modelValue:l.formData[s.name],"onUpdate:modelValue":[n=>l.formData[s.name]=n,t[0]||(t[0]=n=>o.filter())],dense:"",outlined:"",options:s.options,label:s.label,"option-value":"id","option-label":"title","map-options":"","emit-value":""},null,8,["modelValue","onUpdate:modelValue","options","label"])):s.type=="text"?(m(),I(fe,{key:1,modelValue:l.formData[s.name],"onUpdate:modelValue":n=>l.formData[s.name]=n,label:s.label,outlined:"",onKeyup:t[1]||(t[1]=Ye(n=>o.filter(),["enter"])),onBlur:t[2]||(t[2]=n=>o.filter()),dense:""},null,8,["modelValue","onUpdate:modelValue","label"])):s.type=="dateRange"?(m(),w("div",Yt,[i(fe,{modelValue:l.formData2[s.range_input_name],"onUpdate:modelValue":n=>l.formData2[s.range_input_name]=n,label:s.label,dense:"",outlined:"",readonly:""},{append:f(()=>[i(Y,{name:"event",class:"cursor-pointer q-my-xs",icon:"event",flat:"",dense:"",color:"primary"},{default:f(()=>[i(ke,{cover:"","transition-show":"scale","transition-hide":"scale",modelValue:l.popups[s.name],"onUpdate:modelValue":n=>l.popups[s.name]=n},{default:f(()=>[i(Je,{onRangeEnd:n=>{o.setDateRange(s.name,s.range_input_name,s.range_from_name,s.range_to_name),o.filter()},modelValue:l.formData2[s.name],"onUpdate:modelValue":n=>l.formData2[s.name]=n,range:""},null,8,["onRangeEnd","modelValue","onUpdate:modelValue"])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue","label"])])):N("",!0)]))),128))])])}var Jt=W(Gt,[["render",Xt]]);const Zt={components:{AssignReviewers2:bt,FileUploader2:Ht,ProposalFilter:Jt,AssignedProposals:Ut},name:"ReviewerList",data(){return{show:!1,formData:{theme:null,exclude__status:"EDITING",submission_date_lte:"2025-06-24",submission_date_gte:"2025-01-01",call:this.$dataStore.currentCall.id},proposals:[],scores:[],themes:[],selectedProposals:[],selectedProposal:null,allSelected:!1,view:"proposals"}},created(){this.getProposals(),this.getThemes(),this.getReviewers()},methods:{getProposals(e){this.setView(e);let t="";e&&(t=this.$buildURLQuery(e)),this.$api.get(`proposals/?${t}`).then(r=>{this.proposals=r.data,this.view==="scores"&&this.getProposalScores()})},getProposalScores(){for(let e=0;e<this.proposals.length;e++){const t=this.proposals[e];this.$api.get(`scores/?proposal=${t.id}`).then(r=>{this.proposals[e].scores=r.data})}},setView(e){(e==null?void 0:e.status)&&["REVIEWING","REVIEWED","SELECTED"].includes(e.status)?this.view="scores":this.view="proposals"},getThemes(){this.$api.get("themes/").then(e=>{this.themes=e.data})},getReviewers(){var e=this.$buildURLQuery({themes__in:this.formData.theme});this.$api.get(`users/?${e}&groups__name__in=reviewer`).then(t=>{this.reviewers=t.data})},createScores(e){this.$utilsStore.setLoading(!0);const t=e.length*this.selectedProposals.length;let r=0;for(let p=0;p<e.length;p++){const l=e[p],o=this.reviewers.find(s=>s.id==l).email;for(let s=0;s<this.selectedProposals.length;s++){const n=this.selectedProposals[s];this.$api.post("scores/",{proposal:n,email:o,user:l}).then(y=>{r+=1,y.status==201&&console.log("done >> "+l+", "+n),r==t&&(this.$utilsStore.setLoading(!1),this.getProposalScores())}).catch(y=>{r+=1,r==t&&(this.$utilsStore.setLoading(!1),this.getProposalScores())})}}},deleteScore(e){confirm("Are you sure you would like to delete this reviewer?")&&(this.$utilsStore.setLoading(!0),this.$api.delete(`scores/${e}/`).then(t=>{t.status==204&&(this.getProposalScores(),this.$utilsStore.setLoading(!1))}))},selectProposal(e){this.selectedProposals.includes(e)?this.selectedProposals=this.selectedProposals.filter(t=>t!=e):this.selectedProposals.push(e),this.selectedProposals.length==this.proposals.length&&(this.allSelected=!0)},selectProposal2(e){this.selectAllProposals=[],this.selectedProposals.push(e),this.selectedProposal=e,this.show=!0},selectAllProposals(e){e.target.checked?this.selectedProposals=this.proposals.map(t=>t.id):this.selectedProposals=[]},downloadTemplate(){this.$api.get("proposals/bulk-upload-sheet/download/").then(e=>{e.status==200&&window.open(e.data.file_url,"_blank")})}}},Q=e=>(we("data-v-2a012540"),e=e(),Se(),e),es={class:"q-ma-md"},ts={class:"q-ma-sm row items-center"},ss={class:"flex border"},os=Q(()=>a("label",{class:"row items-center q-pr-xs"},"Bulk Upload",-1)),ls=Q(()=>a("div",{class:"col"},null,-1)),ns={class:"col"},as={key:0},rs={align:"left"},is=["checked"],us=Q(()=>a("th",{align:"left"},"Title",-1)),ds=Q(()=>a("th",{align:"left"},"Theme",-1)),cs=Q(()=>a("th",{align:"left"},"Date Submitted",-1)),ps=Q(()=>a("th",{align:"left"},"PI",-1)),ms=Q(()=>a("th",{align:"left"},"Status",-1)),fs=Q(()=>a("th",{align:"left"},null,-1)),vs=["checked","onClick"],hs={style:{display:"none"}},_s={colspan:"7"},gs={class:"text-left"},ys={class:"text-left"};function bs(e,t,r,p,l,o){const s=R("FileUploader2"),n=R("AssignReviewers2"),y=R("router-link"),P=R("ProposalFilter"),_=R("AssignedProposals");return m(),I(xe,null,{default:f(()=>[a("div",es,[i(Ae,null,{default:f(()=>[i(ue,{icon:"home",to:"/",label:"Home"}),i(ue,{label:"Submitted Proposals",icon:"list"})]),_:1})]),i(oe,{spaced:""}),a("div",ts,[i(O,{class:"my-card q-pa-xs",flat:"",bordered:""},{default:f(()=>[a("div",ss,[os,i($,{color:"primary",icon:"download",dense:"",flat:"",onClick:o.downloadTemplate,label:"template"},null,8,["onClick"]),i(s,{uploadUrl:"/proposals/upload-bulk/",multiple:!1,formData:{}})])]),_:1}),ls,a("div",ns,[a("div",null,[i(ke,{modelValue:l.show,"onUpdate:modelValue":t[1]||(t[1]=d=>l.show=d),breakpoint:1e3},{default:f(()=>[i(n,{reviewers:e.reviewers,onReviewersSelected:t[0]||(t[0]=d=>{o.createScores(d),l.show=!1})},null,8,["reviewers"])]),_:1},8,["modelValue"])]),i(y,{to:"/go/proposals/reviewed"},{default:f(()=>[i($,{color:"primary",flat:"",label:"Go To Reviews",class:"q-mr-sm"})]),_:1})])]),i(P,{onFilter:t[2]||(t[2]=d=>o.getProposals(d))}),l.view==="proposals"?(m(),w("div",as,[i(le,{class:"q-ma-sm",flat:"",bordered:""},{default:f(()=>[a("thead",null,[a("tr",null,[a("th",rs,[a("input",{checked:l.allSelected,type:"checkbox",onClick:t[3]||(t[3]=d=>o.selectAllProposals(d))},null,8,is)]),us,ds,cs,ps,ms,fs])]),a("tbody",null,[(m(!0),w(V,null,D(l.proposals,d=>(m(),w(V,{key:d.id},[a("tr",null,[a("td",null,[a("input",{checked:l.selectedProposals.includes(d.id),type:"checkbox",onClick:c=>o.selectProposal(d.id)},null,8,vs)]),a("td",null,v(d.title),1),a("td",null,v(d.theme_title),1),a("td",null,v(d.submission_date),1),a("td",null,v(d.user__first_name)+" "+v(d.user__last_name),1),a("td",null,v(d.status),1),a("td",null,[i(y,{to:`/proposals/${d.id}`},{default:f(()=>[i($,{label:"View",flat:"",color:"primary"})]),_:2},1032,["to"]),i($,{onClick:c=>o.selectProposal2(d.id),label:"Assign Reviewers",flat:"",color:"primary"},null,8,["onClick"]),(m(!0),w(V,null,D(d.scores,c=>(m(),I(Pe,{key:c.id},{default:f(()=>[A(v(c.user__first_name)+" "+v(c.user__last_name)+" ",1),i(Y,{name:"delete",onClick:S=>o.deleteScore(c.id),class:"cursor-pointer"},null,8,["onClick"])]),_:2},1024))),128))])]),a("tr",hs,[a("td",_s,[i(O,{flat:"",bordered:""},{default:f(()=>[i(le,{flat:"",bordered:""},{default:f(()=>[a("tbody",null,[(m(!0),w(V,null,D(d.scores,c=>(m(),w("tr",{key:c.id},[a("td",gs,v(c.user)+" - "+v(c.user__first_name)+" "+v(c.user__last_name)+" ["+v(c.user__username)+"] ",1),a("td",ys,v(c.status),1)]))),128))])]),_:2},1024)]),_:2},1024)])])],64))),128))])]),_:1})])):N("",!0),l.view==="scores"?(m(),I(_,{key:1,proposals:l.proposals},null,8,["proposals"])):N("",!0)]),_:1})}var so=W(Zt,[["render",bs],["__scopeId","data-v-2a012540"]]);export{so as default};
