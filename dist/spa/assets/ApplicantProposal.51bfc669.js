import{Q as U}from"./QToolbarTitle.26de3cd0.js";import{_ as q,o as a,j as i,f as m,w as D,i as e,u as $,g as v,H as b,t as d,F as g,k as y,l as w,aN as C,aO as F,b0 as N,r as S,h as B,e as T,Q}from"./index.f08ad6ba.js";import{Q as P}from"./QCard.7bf12d0a.js";import{Q as V}from"./QCardSection.31908708.js";import{Q as x}from"./QMarkupTable.af8cf3f4.js";import{Q as G}from"./QEditor.90099ec0.js";import{Q as A}from"./QForm.2a6bce41.js";import{c as M}from"./index.5ce110aa.js";import{Q as R}from"./QChip.7371d580.js";import"./use-dark.26c7a6e7.js";import"./QBtnDropdown.e255e04b.js";import"./QBtnGroup.74bec707.js";import"./QMenu.60387a40.js";import"./use-timeout.cff15f03.js";import"./uid.083ad4e2.js";import"./use-transition.5393b565.js";import"./scroll.d4994559.js";import"./QItem.aa34c858.js";import"./use-split-attrs.f128f906.js";const W={name:"BudgetEditor",data(){return{formData:{item:"",quantity:1,units:"",unit_cost:0,proposal:this.$route.params.proposal_id},updateFormData:{id:0,item:"",quantity:1,units:"",unit_cost:0,proposal:this.$route.params.proposal_id},items:[]}},computed:{totalBudget(){var t=0;for(let s=0;s<this.items.length;s++){const n=this.items[s];t+=n.unit_cost*n.quantity}return t}},created(){this.init()},methods:{init(){this.getBudgets()},getBudgets(){this.$api.get(`budgets/?proposal=${this.$route.params.proposal_id}`).then(t=>{this.items=t.data})},createBudget(){this.$api.post("budgets/",this.formData).then(t=>{(t.status=201)&&(this.items.unshift(t.data),this.resetFormData(),this.$bus.emit("proposal-updated",!0))})},deleteItem(t){confirm("Delete this budget?")&&this.$api.delete(`budgets/${t}`).then(s=>{s.status==204&&(this.init(),this.$bus.emit("proposal-updated",!0))})},resetFormData(){this.formData={item:"",quantity:1,units:"",unit_cost:0,proposal:this.$route.params.proposal_id}}}},k=t=>(C("data-v-34a02e97"),t=t(),F(),t),H=k(()=>e("th",{align:"left"},"Item",-1)),L=k(()=>e("th",{align:"left"},"Quantity",-1)),O=k(()=>e("th",{align:"left"},"Units",-1)),X=k(()=>e("th",{align:"left"},"Unit Cost (UGX)",-1)),j=k(()=>e("th",{align:"left"},"Total Cost (UGX)",-1)),z={key:0,align:"left"},J={key:0,class:"q-tr--no-hover"},K={key:0},Y={class:"q-tr--no-hover"},Z=k(()=>e("th",{class:"text-left",colspan:"4"},"Total",-1)),tt={class:"text-left"},et=k(()=>e("td",null,null,-1));function st(t,s,n,_,o,u){return a(),i("div",null,[m(x,{class:"q-my-sm",flat:"",bordered:""},{default:D(()=>{var h,p;return[e("thead",null,[e("tr",null,[H,L,O,X,j,((h=t.$proposalStore.currentProposal)==null?void 0:h.status)=="EDITING"?(a(),i("th",z," Actions ")):$("",!0)])]),e("tbody",null,[((p=t.$proposalStore.currentProposal)==null?void 0:p.status)=="EDITING"?(a(),i("tr",J,[e("td",null,[v(e("input",{"onUpdate:modelValue":s[0]||(s[0]=r=>o.formData.item=r),style:{display:"block",width:"100%"},type:"text"},null,512),[[b,o.formData.item]])]),e("td",null,[v(e("input",{"onUpdate:modelValue":s[1]||(s[1]=r=>o.formData.quantity=r),style:{display:"block",width:"100%"},type:"number"},null,512),[[b,o.formData.quantity]])]),e("td",null,[v(e("input",{"onUpdate:modelValue":s[2]||(s[2]=r=>o.formData.units=r),style:{display:"block",width:"100%"},type:"text"},null,512),[[b,o.formData.units]])]),e("td",null,[v(e("input",{"onUpdate:modelValue":s[3]||(s[3]=r=>o.formData.unit_cost=r),style:{display:"block",width:"100%"},type:"number"},null,512),[[b,o.formData.unit_cost]])]),e("td",null,d(t.$commaSeparator(o.formData.unit_cost*o.formData.quantity)),1),e("td",null,[e("button",{onClick:s[4]||(s[4]=(...r)=>u.createBudget&&u.createBudget(...r))},"Add")])])):$("",!0),(a(!0),i(g,null,y(o.items,r=>{var f;return a(),i("tr",{class:"q-tr--no-hover",key:r.id},[e("td",null,d(r.item),1),e("td",null,d(r.quantity),1),e("td",null,d(r.units),1),e("td",null,d(t.$commaSeparator(r.unit_cost))+" UGX",1),e("td",null,d(t.$commaSeparator(r.unit_cost*r.quantity))+" UGX",1),((f=t.$proposalStore.currentProposal)==null?void 0:f.status)=="EDITING"?(a(),i("td",K,[m(w,{icon:"delete",flat:"",color:"negative",onClick:c=>u.deleteItem(r.id)},null,8,["onClick"])])):$("",!0)])}),128)),e("tr",Y,[Z,e("th",tt,d(t.$commaSeparator(u.totalBudget))+" UGX",1),et])])]}),_:1})])}var ot=q(W,[["render",st],["__scopeId","data-v-34a02e97"]]);const at={name:"TeamEditor",data(){return{formData:{full_name:"",email:"",telephone:"",proposal:this.$route.params.proposal_id,role:"PI"},formErrors:{},items:[],options:[{name:"PI",value:"PI"},{name:"Co PI",value:"Co PI"},{name:"MEMBER",value:"MEMBER"}]}},created(){this.init()},methods:{init(){this.getTeams()},getTeams(){this.$api.get(`teams/?proposal=${this.$route.params.proposal_id}`).then(t=>{this.items=t.data})},createTeam(){this.$api.post("teams/",this.formData).then(t=>{(t.status=201)&&(this.formErrors={},this.items.push(t.data),this.resetFormData(),this.$bus.emit("proposal-updated",!0))}).catch(t=>{this.formErrors=t.response.data,this.$utilsStore.setLoading(!1)})},deleteItem(t){confirm("Delete this team?")&&this.$api.delete(`teams/${t}`).then(s=>{s.status==204&&(this.init(),this.$bus.emit("proposal-updated",!0))})},resetFormData(){this.formData={full_name:"",email:"",telephone:"",proposal:this.$route.params.proposal_id}}}},it=e("th",{align:"left"},"Full Name",-1),lt=e("th",{align:"left"},"Email",-1),rt=e("th",{align:"left"},"Telephone",-1),nt=e("th",{align:"left"},"Role",-1),dt={key:0,align:"left"},ut={key:0,class:"q-tr--no-hover"},pt={class:"text-red"},mt={class:"q-ma-xs"},ct={class:"text-red"},ht={class:"q-ma-xs"},_t={class:"text-red"},ft={class:"q-ma-xs"},gt=["value"],yt={key:0};function $t(t,s,n,_,o,u){return a(),i("div",null,[m(x,{class:"q-my-sm",flat:"",bordered:""},{default:D(()=>{var h,p,r,f,c;return[e("thead",null,[e("tr",null,[it,lt,rt,nt,((h=t.$proposalStore.currentProposal)==null?void 0:h.status)=="EDITING"?(a(),i("th",dt," Actions ")):$("",!0)])]),e("tbody",null,[((p=t.$proposalStore.currentProposal)==null?void 0:p.status)=="EDITING"&&o.items.length<5?(a(),i("tr",ut,[e("td",null,[v(e("input",{"onUpdate:modelValue":s[0]||(s[0]=l=>o.formData.full_name=l),style:{display:"block",width:"100%"},type:"text"},null,512),[[b,o.formData.full_name]]),e("div",pt,[e("ul",mt,[(a(!0),i(g,null,y((r=o.formErrors)==null?void 0:r.full_name,l=>(a(),i("li",{key:l},d(l),1))),128))])])]),e("td",null,[v(e("input",{"onUpdate:modelValue":s[1]||(s[1]=l=>o.formData.email=l),style:{display:"block",width:"100%"},type:"email"},null,512),[[b,o.formData.email]]),e("div",ct,[e("ul",ht,[(a(!0),i(g,null,y((f=o.formErrors)==null?void 0:f.email,l=>(a(),i("li",{key:l},d(l),1))),128))])])]),e("td",null,[v(e("input",{"onUpdate:modelValue":s[2]||(s[2]=l=>o.formData.telephone=l),style:{display:"block",width:"100%"},type:"text"},null,512),[[b,o.formData.telephone]]),e("div",_t,[e("ul",ft,[(a(!0),i(g,null,y((c=o.formErrors)==null?void 0:c.telephone,l=>(a(),i("li",{key:l},d(l),1))),128))])])]),e("td",null,[v(e("select",{"onUpdate:modelValue":s[3]||(s[3]=l=>o.formData.role=l)},[(a(!0),i(g,null,y(o.options,l=>(a(),i("option",{key:l.name,value:l.name},d(l.value),9,gt))),128))],512),[[N,o.formData.role]])]),e("td",null,[e("button",{onClick:s[4]||(s[4]=(...l)=>u.createTeam&&u.createTeam(...l))},"Add")])])):$("",!0),(a(!0),i(g,null,y(o.items,l=>{var I;return a(),i("tr",{class:"q-tr--no-hover",key:l.id},[e("td",null,d(l.full_name),1),e("td",null,d(l.email),1),e("td",null,d(l.telephone),1),e("td",null,d(l.role),1),((I=t.$proposalStore.currentProposal)==null?void 0:I.status)=="EDITING"?(a(),i("td",yt,[m(w,{icon:"delete",flat:"",color:"negative",onClick:E=>u.deleteItem(l.id)},null,8,["onClick"])])):$("",!0)])}),128))])]}),_:1})])}var Dt=q(at,[["render",$t]]);const vt={name:"SectionEditor2",props:{proposal:{type:Object,required:!0},section:{type:Object,required:!0}},data(){return{loading:!1,showDialog:!1,formData:{}}},computed:{numWords(){return this.countWordsInHtml(this.formData[this.section.name]||"")}},methods:{updateSection(){this.$api.patch(`proposals/${this.$route.params.proposal_id}/`,this.formData).then(t=>{this.$emit("proposal-updated",t.data),this.$bus.emit("proposal-updated",t.data)})},countWordsInHtml(t){return M.load(t)("body").text().split(/\s+/).length-1},onPaste(t){if(t.target.nodeName==="INPUT")return;let s,n;t.preventDefault(),t.stopPropagation(),t.originalEvent&&t.originalEvent.clipboardData.getData?(s=t.originalEvent.clipboardData.getData("text/plain"),this.$refs.editorRef.runCmd("insertText",s)):t.clipboardData&&t.clipboardData.getData?(s=t.clipboardData.getData("text/plain"),this.$refs.editorRef.runCmd("insertText",s)):window.clipboardData&&window.clipboardData.getData&&(n||(n=!0,this.$refs.editorRef.runCmd("ms-pasteTextOnly",s)),n=!1)}},mounted(){this.formData[this.section.name]=this.proposal[this.section.name]||""},watch:{proposal(t){this.formData[this.section.name]=t[this.section.name]||""}}},bt={key:0},kt={class:"scroll"},It={class:"text-caption text-grey-8",align:"right"},St={key:0,class:"text-red text-caption"},qt={key:1,class:"text-right"};function Tt(t,s,n,_,o,u){var h,p;return((h=n.proposal)==null?void 0:h.status)=="EDITING"&&t.$authStore.currentUser.id==((p=n.proposal)==null?void 0:p.user)?(a(),i("div",bt,[m(A,{onSubmit:u.updateSection,class:"q-gutter-md"},{default:D(()=>[e("div",kt,[m(G,{modelValue:o.formData[n.section.name],"onUpdate:modelValue":s[0]||(s[0]=r=>o.formData[n.section.name]=r),label:"Title of your proposal",outlined:"",required:"","min-height":"30vh",onBlur:u.updateSection,onPaste:u.onPaste,ref:"editorRef"},null,8,["modelValue","onBlur","onPaste"]),e("div",It,[u.numWords>n.section.word_limit?(a(),i("small",St," Exceeded word limit ("+d(u.numWords)+"/"+d(n.section.lower_limit)+"-"+d(n.section.word_limit)+") ",1)):(a(),i("div",qt," Number of Words ("+d(u.numWords)+"/"+d(n.section.lower_limit)+"-"+d(n.section.word_limit)+") ",1))])])]),_:1},8,["onSubmit"])])):$("",!0)}var Et=q(vt,[["render",Tt]]);const xt={name:"AttachmentEditor",data(){return{formData:{full_name:"",email:"",telephone:"",proposal:this.$route.params.proposal_id},attachments:[],attachmentsValid:!1}},created(){this.init()},methods:{init(){this.getAttachments()},getAttachments(){this.$api.get("attachments/").then(t=>{this.attachments=t.data,this.getFiles()})},getFiles(){for(let t=0;t<this.attachments.length;t++){const s=this.attachments[t];this.$api.get(`files/?proposal_id=${this.$route.params.proposal_id}&attachment_id=${s.id}`).then(n=>{var _=n.data;this.attachments.filter(o=>o.id==s.id)[0].files=_,t==this.attachments.length-1&&setTimeout(()=>{this.validateAttachments()},1e3)})}},validateAttachments(){let t=!0;return this.attachments.filter(n=>{var _;return n.is_required&&!((_=n.files)!=null&&_.length)}).length?t=!1:t=!0,this.$bus.emit("attachments-updated",t),t},deleteFile(t){confirm("Delete this File?")&&this.$api.delete(`files/${t}/`).then(s=>{s.status==204&&this.getFiles()})},openFile(t){window.open(t)}}},Pt=e("thead",null,[e("tr",null,[e("th",{align:"left"},"Title"),e("th",{align:"left",colspan:"2"},"Files")])],-1),wt={key:0,class:"text-red"},Ut={class:"flex"};function Ct(t,s,n,_,o,u){const h=S("proposal-file-attachment");return a(),i("div",null,[m(x,{class:"q-my-sm",flat:"",bordered:""},{default:D(()=>[Pt,e("tbody",null,[(a(!0),i(g,null,y(o.attachments,p=>(a(),i("tr",{key:p.id},[e("td",null,[B(d(p.title)+" ",1),p.is_required?(a(),i("span",wt,"*")):$("",!0)]),e("td",null,[e("div",Ut,[(a(!0),i(g,null,y(p.files,r=>(a(),T(R,{dense:"",key:r.id,class:"glossy",icon:"attachment",label:r.name,removable:t.$userHasAnyGroups(["applicant"])&&t.$authStore.currentUser.id==t.$proposalStore.currentProposal.user&&t.$proposalStore.currentProposal.status=="EDITING",clickable:"",onRemove:f=>u.deleteFile(r.id),onClick:f=>u.openFile(r.file)},null,8,["label","removable","onRemove","onClick"]))),128))])]),e("td",null,[m(h,{attachment_id:p.id,onFileUploaded:s[0]||(s[0]=r=>u.getFiles())},null,8,["attachment_id"])])]))),128))])]),_:1})])}var Ft=q(xt,[["render",Ct]]);const Nt={components:{budgeteditor:ot,teameditor:Dt,sectioneditor2:Et,attachmentseditor:Ft},data(){return{sections:[],proposal:{},score:null,content:`
      <p>
        Lorem ipsum dolor sit amet consectetur, adipisicing elit. Obcaecati
        natus animi, et itaque ea tempora, exercitationem nemo nobis eos quos
        corrupti quasi cupiditate recusandae magnam, quis dicta facere dolore
        blanditiis.
      </p>`}},created(){this.getProposal(),this.getSections()},methods:{getProposal(){this.$api.get(`proposals/${this.$route.params.proposal_id}/`).then(t=>{this.proposal=t.data,this.$proposalStore.setProposal(this.proposal),this.getScore()})},getScore(){var t;this.$api.get(`scores/?user=${((t=this.$authStore.currentUser)==null?void 0:t.id)||0}&proposal=${this.$route.params.proposal_id}`).then(s=>{s.data.length==1&&(this.score=s.data[0])})},getSections(){this.$api.get("sections/").then(t=>{this.sections=t.data})}}},Bt={class:"q-pa-sm"},Qt=["id"],Vt={class:"q-pa-sm"},Gt={class:"flex"},At={class:"bg-grey-0"},Mt={class:"text-caption text-grey-8"},Rt={class:"q-pt-sm"},Wt={key:0},Ht={key:1},Lt={key:2},Ot={key:3},Xt=["innerHTML"],jt=e("hr",{id:"solution",class:"section-separator"},null,-1);function zt(t,s,n,_,o,u){const h=S("budgeteditor"),p=S("teameditor"),r=S("attachmentseditor"),f=S("sectioneditor2");return a(),i("div",Bt,[(a(!0),i(g,null,y(o.sections,c=>{var l,I;return a(),i("div",{key:c.id},[e("hr",{id:c.name,class:"section-separator"},null,8,Qt),e("div",Vt,[m(U,{class:"flex justify-between"},{default:D(()=>[e("div",Gt,d(c.title),1)]),_:2},1024),((l=t.$proposalStore.currentProposal)==null?void 0:l.status)=="EDITING"?(a(),T(P,{key:0,class:"flex no-wrap q-pa-sm",flat:"",bordered:""},{default:D(()=>[m(Q,{size:"md",class:"q-pr-sm",name:"info_outline"}),e("div",At,[e("small",Mt,d(c.description),1)])]),_:2},1024)):$("",!0),e("div",Rt,[c.ref=="#summary_budget"?(a(),i("div",Wt,[m(h)])):c.ref=="#team"?(a(),i("div",Ht,[m(p)])):c.ref=="#attachments"?(a(),i("div",Lt,[m(r)])):(a(),i("div",Ot,[((I=t.$proposalStore.currentProposal)==null?void 0:I.status)=="EDITING"?(a(),T(f,{key:0,proposal:o.proposal,section:c,onProposalUpdated:s[0]||(s[0]=E=>{o.proposal=E,t.$proposalStore.setProposal(E)})},null,8,["proposal","section"])):(a(),T(P,{key:1,class:"my-card",flat:"",bordered:""},{default:D(()=>[m(V,null,{default:D(()=>[e("div",{innerHTML:o.proposal[c.name]},null,8,Xt)]),_:2},1024)]),_:2},1024))]))])])])}),128)),jt])}var _e=q(Nt,[["render",zt]]);export{_e as default};
