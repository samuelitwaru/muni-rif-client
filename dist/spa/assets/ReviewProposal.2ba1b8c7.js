import{Q as B}from"./QToolbarTitle.216897de.js";import{Q as C}from"./QBtnToggle.870b9edc.js";import{_ as y,o as i,j as u,f as t,w as m,h as q,t as f,i as c,u as V,r as l,e as v,F as M,k as z,g as b,b1 as w,Q as H}from"./index.321f2a75.js";import{Q as S}from"./QCard.605795d5.js";import{Q as P}from"./QCircularProgress.0900a808.js";import{Q}from"./QCardSection.e3906341.js";import{P as L}from"./ProposalHeader.114962cd.js";import{P as N,B as A,T as I}from"./BudgetItems.504489dc.js";import"./QBtnGroup.97cb1948.js";import"./use-form.45c1b99b.js";import"./use-dark.89890713.js";import"./format.2bc25e5f.js";import"./QMarkupTable.6ac75ced.js";import"./QChip.663160d5.js";const j={props:["score","section"],name:"ScoreView"},D={key:0};function E(s,r,o,x,e,p){return o.score?(i(),u("div",D,[t(S,{class:"flex q-my-sm items-center",flat:"",bordered:""},{default:m(()=>[t(Q,null,{default:m(()=>[t(P,{"show-value":"","font-size":"12px",value:o.score[o.section.name]/o.section.max_score*100,size:"50px",thickness:.22,color:"teal","track-color":"grey-3",class:"q-ma-md"},{default:m(()=>[q(f(o.score[o.section.name])+"/"+f(o.section.max_score),1)]),_:1},8,["value"])]),_:1}),c("div",null,f(o.score[`${o.section.name}_comment`]||"No comment"),1)]),_:1})])):V("",!0)}var F=y(j,[["render",E]]);const O={props:["score","section","proposal"],name:"ScoreView",components:{ProposalAttachments:N,BudgetItems:A,TeamMembers:I}},R={key:3},U=["innerHTML"];function G(s,r,o,x,e,p){const _=l("ProposalAttachments"),h=l("BudgetItems"),d=l("TeamMembers");return i(),u("div",null,[o.section.name=="attachments"?(i(),v(_,{key:0})):o.section.name=="summary_budget"?(i(),v(h,{key:1})):o.section.name=="team"?(i(),v(d,{key:2})):(i(),u("div",R,[t(S,{flat:"",bordered:"",class:"q-pa-sm q-my-sm"},{default:m(()=>{var a;return[c("div",{style:{overflow:"auto","min-height":"5rem"},innerHTML:((a=o.proposal)==null?void 0:a[o.section.name])||""},null,8,U)]}),_:1})]))])}var $=y(O,[["render",G]]);const J={name:"ReviewProposal",components:{ProposalHeader:L,ScoreView:F,SectionView:$},data(){return{tab:"proposal",sections:[],proposal:{},score:null,content:`
      <p>
        Lorem ipsum dolor sit amet consectetur, adipisicing elit. Obcaecati
        natus animi, et itaque ea tempora, exercitationem nemo nobis eos quos
        corrupti quasi cupiditate recusandae magnam, quis dicta facere dolore
        blanditiis.
      </p>`}},created(){this.getProposal(),this.getSections()},computed:{percentageScore(){var e,p,_,h,d;if(console.log(">>>>",this.sections.length),console.log(">>>>",!((e=this.score)!=null&&e.id)),((p=this.sections)==null?void 0:p.length)==0||!((_=this.score)!=null&&_.id))return 0;const s=(h=this.sections)==null?void 0:h.map(a=>a.max_score),r=(d=this.sections)==null?void 0:d.map(a=>this.score[a.name]||0);console.log(r);const o=r.reduce((a,g)=>a+g,0),x=s.reduce((a,g)=>a+g,0);return o/x*100},scoresAreValid(){if(this.score&&this.sections){console.log(this.score);for(let s=0;s<this.sections.length;s++){const r=this.sections[s];if(r.max_score>0&&this.score[r.name]===null)return this.$bus.emit("score-updated",!1),!1}}return this.$bus.emit("score-updated",!0),!0}},methods:{getProposal(){this.$api.get(`proposals/${this.$route.params.proposal_id}/`).then(s=>{this.proposal=s.data,this.$proposalStore.setProposal(this.proposal),this.getScore()})},getScore(){var s;this.$api.get(`scores/?user=${((s=this.$authStore.currentUser)==null?void 0:s.id)||0}&proposal=${this.$route.params.proposal_id}`).then(r=>{r.data.length==1&&(this.score=r.data[0])})},getSections(){this.$api.get("sections/").then(s=>{this.sections=s.data})}}},K=["id"],W={class:"q-pa-sm"},X={class:"flex"},Y={key:0},Z={class:"q-my-sm"},ee={class:"bg-grey-0"},oe={class:"text-caption text-grey-8"},se=c("hr",{id:"solution",class:"section-separator"},null,-1),te={class:"q-pa-sm flex q-gutter-x-lg justify-center items-center"},re=c("div",null,"Total",-1);function ae(s,r,o,x,e,p){const _=l("accept-review"),h=l("ProposalHeader"),d=l("SectionView"),a=l("score-editor"),g=l("ScoreView");return i(),u("div",null,[t(_,{proposal:e.proposal,score:e.score},null,8,["proposal","score"]),t(h),(i(!0),u(M,null,z(e.sections,n=>{var k;return i(),u("div",{key:n.id},[c("hr",{id:n.name,class:"section-separator"},null,8,K),c("div",W,[t(B,{class:"flex justify-between"},{default:m(()=>[c("div",X,f(n.title),1)]),_:2},1024),n.max_score>0?(i(),u("div",Y,[c("div",null,[t(C,{class:"q-mt-xs",square:"",style:{border:"1px #dddddd solid"},glossy:"",padding:"5px 30px",modelValue:e.tab,"onUpdate:modelValue":r[0]||(r[0]=T=>e.tab=T),color:"white","text-color":"black","toggle-text-color":"white",unelevated:"",bordered:"","toggle-color":"red",options:[{label:"Content",value:"proposal"},{label:"Guidelines",value:"guidelines"},{label:"Scores",value:"scores"}]},null,8,["modelValue"])]),b(t(d,{proposal:e.proposal,section:n},null,8,["proposal","section"]),[[w,e.tab=="proposal"]]),n.max_score>0?b((i(),v(a,{key:0,min:0,max:n.max_score,proposal:e.proposal,section:n,score:e.score},null,8,["max","proposal","section","score"])),[[w,e.tab=="scores"]]):V("",!0),b(t(g,{section:n,score:e.score},null,8,["section","score"]),[[w,e.tab=="scores"&&((k=e.score)==null?void 0:k.status)=="COMPLETED"]]),b(c("div",Z,[t(S,{class:"flex no-wrap q-pa-sm",flat:"",bordered:""},{default:m(()=>[t(H,{size:"md",class:"q-pr-sm",name:"info_outline"}),c("div",ee,[c("small",oe,f(n.description),1)])]),_:2},1024)],512),[[w,e.tab=="guidelines"]])])):(i(),v(d,{key:1,proposal:e.proposal,section:n},null,8,["proposal","section"]))])])}),128)),se,c("div",te,[re,t(Q,null,{default:m(()=>[t(P,{"show-value":"","font-size":"12px",value:p.percentageScore,size:"100px",thickness:.5,color:"teal","track-color":"grey-3",class:"q-ma-md"},{default:m(()=>[q(f(p.percentageScore)+"% ",1)]),_:1},8,["value"])]),_:1})])])}var be=y(J,[["render",ae]]);export{be as default};
