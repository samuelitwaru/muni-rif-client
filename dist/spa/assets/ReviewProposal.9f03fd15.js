import{Q as B}from"./QToolbarTitle.bd27c268.js";import{Q as C}from"./QBtnToggle.6263d300.js";import{_ as w,o as n,j as u,f as t,w as p,h as k,t as f,i as c,n as q,r as m,e as g,F as M,k as z,g as x,b1 as b,Q as H}from"./index.e39be684.js";import{Q as S}from"./QCard.f9e0a707.js";import{Q as P}from"./QCircularProgress.97b714c3.js";import{Q as V}from"./QCardSection.1db827b1.js";import{P as L}from"./ProposalHeader.459c8fe0.js";import{P as N,B as A,T as I}from"./BudgetItems.d403963e.js";import"./QBtnGroup.223e6e8a.js";import"./use-form.dc1a9363.js";import"./use-dark.54601180.js";import"./format.2bc25e5f.js";import"./QMarkupTable.c371dead.js";import"./QChip.19e4d28f.js";const D={props:["score","section"],name:"ScoreView"},E={key:0};function j(o,r,s,v,e,d){return s.score?(n(),u("div",E,[t(S,{class:"flex q-my-sm items-center",flat:"",bordered:""},{default:p(()=>[t(V,null,{default:p(()=>[t(P,{"show-value":"","font-size":"12px",value:s.score[s.section.name]/s.section.max_score*100,size:"50px",thickness:.22,color:"teal","track-color":"grey-3",class:"q-ma-md"},{default:p(()=>[k(f(s.score[s.section.name])+"/"+f(s.section.max_score),1)]),_:1},8,["value"])]),_:1}),c("div",null,f(s.score[`${s.section.name}_comment`]||"No comment"),1)]),_:1})])):q("",!0)}var F=w(D,[["render",j]]);const O={props:["score","section","proposal"],name:"ScoreView",components:{ProposalAttachments:N,BudgetItems:A,TeamMembers:I}},R={key:3},U=["innerHTML"];function $(o,r,s,v,e,d){const _=m("ProposalAttachments"),h=m("BudgetItems"),a=m("TeamMembers");return n(),u("div",null,[s.section.name=="attachments"?(n(),g(_,{key:0})):s.section.name=="summary_budget"?(n(),g(h,{key:1})):s.section.name=="team"?(n(),g(a,{key:2})):(n(),u("div",R,[t(S,{flat:"",bordered:"",class:"q-pa-sm q-my-sm"},{default:p(()=>{var l;return[c("div",{style:{overflow:"auto","min-height":"5rem"},innerHTML:((l=s.proposal)==null?void 0:l[s.section.name])||""},null,8,U)]}),_:1})]))])}var G=w(O,[["render",$]]);const J={name:"ReviewProposal",components:{ProposalHeader:L,ScoreView:F,SectionView:G},data(){return{tab:"proposal",sections:[],proposal:{},score:null,content:`
      <p>
        Lorem ipsum dolor sit amet consectetur, adipisicing elit. Obcaecati
        natus animi, et itaque ea tempora, exercitationem nemo nobis eos quos
        corrupti quasi cupiditate recusandae magnam, quis dicta facere dolore
        blanditiis.
      </p>`}},created(){this.getProposal(),this.getSections(),this.$bus.on("score-updated",o=>{this.score[o.section]=o.score})},computed:{percentageScore(){var e,d,_,h;if(((e=this.sections)==null?void 0:e.length)==0||!((d=this.score)!=null&&d.id))return 0;const o=(_=this.sections)==null?void 0:_.map(a=>a.max_score),r=(h=this.sections)==null?void 0:h.map(a=>this.score[a.name]||0);console.log(r);const s=r.reduce((a,l)=>a+l,0),v=o.reduce((a,l)=>a+l,0);return Math.round(s/v*100)},scoresAreValid(){if(this.score&&this.sections){console.log(this.score);for(let o=0;o<this.sections.length;o++){const r=this.sections[o];if(r.max_score>0&&this.score[r.name]===null)return this.$bus.emit("score-updated",!1),!1}}return this.$bus.emit("score-updated",!0),!0}},methods:{getProposal(){this.$api.get(`proposals/${this.$route.params.proposal_id}/`).then(o=>{this.proposal=o.data,this.$proposalStore.setProposal(this.proposal),this.getScore()})},getScore(){var o;this.$api.get(`scores/?user=${((o=this.$authStore.currentUser)==null?void 0:o.id)||0}&proposal=${this.$route.params.proposal_id}`).then(r=>{r.data.length==1&&(this.score=r.data[0])})},getSections(){this.$api.get("sections/").then(o=>{this.sections=o.data,setTimeout(this.calculateTotalPercentageScore,1e3)})}}},K=["id"],W={class:"q-pa-sm"},X={class:"flex"},Y={key:0},Z={class:"q-my-sm"},ee={class:"bg-grey-0"},oe={class:"text-caption text-grey-8"},se=c("hr",{id:"solution",class:"section-separator"},null,-1),te={class:"q-pa-sm",align:"center"},re=c("div",null,"Total Score",-1);function ae(o,r,s,v,e,d){const _=m("accept-review"),h=m("ProposalHeader"),a=m("SectionView"),l=m("score-editor"),T=m("ScoreView");return n(),u("div",null,[t(_,{proposal:e.proposal,score:e.score},null,8,["proposal","score"]),t(h),(n(!0),u(M,null,z(e.sections,i=>{var y;return n(),u("div",{key:i.id},[c("hr",{id:i.name,class:"section-separator"},null,8,K),c("div",W,[t(B,{class:"flex justify-between"},{default:p(()=>[c("div",X,f(i.title),1)]),_:2},1024),i.max_score>0?(n(),u("div",Y,[c("div",null,[t(C,{class:"q-mt-xs",square:"",style:{border:"1px #dddddd solid"},glossy:"",padding:"5px 30px",modelValue:e.tab,"onUpdate:modelValue":r[0]||(r[0]=Q=>e.tab=Q),color:"white","text-color":"black","toggle-text-color":"white",unelevated:"",bordered:"","toggle-color":"red",options:[{label:"Content",value:"proposal"},{label:"Guidelines",value:"guidelines"},{label:"Scores",value:"scores"}]},null,8,["modelValue"])]),x(t(a,{proposal:e.proposal,section:i},null,8,["proposal","section"]),[[b,e.tab=="proposal"]]),i.max_score>0?x((n(),g(l,{key:0,min:0,max:i.max_score,proposal:e.proposal,section:i,score:e.score},null,8,["max","proposal","section","score"])),[[b,e.tab=="scores"]]):q("",!0),x(t(T,{section:i,score:e.score},null,8,["section","score"]),[[b,e.tab=="scores"&&((y=e.score)==null?void 0:y.status)=="COMPLETED"]]),x(c("div",Z,[t(S,{class:"flex no-wrap q-pa-sm",flat:"",bordered:""},{default:p(()=>[t(H,{size:"md",class:"q-pr-sm",name:"info_outline"}),c("div",ee,[c("small",oe,f(i.description),1)])]),_:2},1024)],512),[[b,e.tab=="guidelines"]])])):(n(),g(a,{key:1,proposal:e.proposal,section:i},null,8,["proposal","section"]))])])}),128)),se,c("div",te,[re,t(V,null,{default:p(()=>[t(P,{"show-value":"","font-size":"12px",value:d.percentageScore,size:"100px",thickness:.5,color:"teal","track-color":"grey-3",class:"q-ma-md"},{default:p(()=>[k(f(d.percentageScore)+"% ",1)]),_:1},8,["value"])]),_:1})])])}var be=w(J,[["render",ae]]);export{be as default};
