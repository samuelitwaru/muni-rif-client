import{Q as v}from"./QChip.19e4d28f.js";import{Q as F}from"./QMarkupTable.c371dead.js";import{F as R}from"./FileUploader2.ca087439.js";import{_ as k,r as $,o,j as a,f as b,w as y,i as t,F as c,k as h,t as u,e as m,n as g}from"./index.e39be684.js";const U={name:"ProposalReportsEditor",components:{FileUploader2:R},data(){return{reports:[],reporting_dates:[],isEditing:this.$userHasAnyGroups(["applicant"])&&this.$authStore.currentUser.id==this.$proposalStore.currentProposal.user&&this.$proposalStore.currentProposal.is_selected}},created(){this.getReports(),this.getReportingSchedules()},methods:{getReports(){this.$api.get(`reports/?proposal=${this.$route.params.proposal_id}`).then(e=>{this.reports=e.data,console.log("reports:",e.data)})},getReportingSchedules(){this.$api.get("reporting-dates/").then(e=>{this.reporting_dates=e.data})},validateAttachments(){let e=!0;return this.attachments.filter(p=>{var d;return p.is_required&&!((d=p.files)!=null&&d.length)}).length?e=!1:e=!0,this.$bus.emit("attachments-updated",e),e},deleteReport(e){confirm("Delete this Report?")&&this.$api.delete(`reports/${e}/`).then(r=>{r.status==204&&this.getReports()})},openFile(e){window.open(e)},getFileNameFromUrl(e){const r=e.split("/");return r[r.length-1]}}},C={class:"q-pa-md"},D=t("div",{class:"text-h6"},"Other Reports",-1),E=t("thead",null,[t("tr",null,[t("th",{align:"left"},"Title"),t("th",{align:"left"},"Due Date"),t("th",{align:"left",colspan:"2"},"Files")])],-1),N={class:"flex"},S={key:0,align:"center"},x=t("td",{colspan:"3"}," No report schedules found. ",-1),A=[x];function P(e,r,p,d,i,n){const _=$("FileUploader2");return o(),a("div",C,[D,b(F,{class:"q-my-sm",flat:"",bordered:""},{default:y(()=>[E,t("tbody",null,[(o(!0),a(c,null,h(i.reporting_dates,l=>(o(),a("tr",{key:l.id},[t("td",null,u(l.title),1),t("td",null,u(l.date),1),t("td",null,[t("div",N,[(o(!0),a(c,null,h(i.reports.filter(s=>s.reporting_date===l.id),s=>(o(),m(v,{dense:"",key:s.id,class:"glossy",icon:"attachment",label:n.getFileNameFromUrl(s.file),removable:i.isEditing,clickable:"",onRemove:f=>n.deleteReport(s.id),onClick:f=>n.openFile(s.file)},null,8,["label","removable","onRemove","onClick"]))),128))])]),t("td",null,[i.isEditing?(o(),m(_,{key:0,onFileUploaded:r[0]||(r[0]=s=>n.getReports()),uploadUrl:"/reports/",multiple:!1,formData:{title:l.title,reporting_date:l.id,proposal:e.$route.params.proposal_id}},null,8,["formData"])):g("",!0)])]))),128)),i.reporting_dates.length==0?(o(),a("tr",S,A)):g("",!0)])]),_:1})])}var q=k(U,[["render",P]]);export{q as P};
