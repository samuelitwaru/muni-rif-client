import{l as N,k as K,p as y,C as X,v as Y,m,a5 as Z,G as ee,u as te,_ as A,r as _,o as u,h,a as t,w as l,F as z,i as F,e as S,c as g,f as C,t as q,s as w,j as le,g as re}from"./index.542c6195.js";import{Q as ne}from"./QToolbarTitle.3cc2e02b.js";import{Q as ae}from"./QChip.91c2f2a3.js";import{Q as ie,a as oe,b as se}from"./QLayout.5448aff5.js";import{Q as ue}from"./QHeader.e67e401c.js";import{Q as ce}from"./QDrawer.96f76ee7.js";import{a as B}from"./api.ba4f3ba9.js";import{Q as k}from"./QItemLabel.d3c0ae79.js";import{Q as $,a as b}from"./QItem.419ce596.js";import{Q as P}from"./QList.39042cc1.js";import{Q as R}from"./QSeparator.d1f4a56a.js";import{C as Q}from"./ClosePopup.887bf137.js";import{Q as fe}from"./QBtnDropdown.210e256e.js";import{_ as de}from"./logo.151e68dc.js";import"./use-dark.3250c496.js";import"./scroll.652ffd25.js";import"./use-prevent-scroll.f7d9b58d.js";import"./use-timeout.04e0df1e.js";import"./TouchPan.d6a8bcf5.js";import"./touch.3df10340.js";import"./selection.8c192d65.js";import"./format.3e32b8d9.js";import"./axios.8ac39568.js";import"./focusout.e24870b5.js";import"./focus-manager.b507780d.js";import"./QBtnGroup.6ea4cb74.js";import"./QMenu.349a7bd2.js";import"./use-transition.566a6544.js";import"./uid.42677368.js";const me={ratio:[String,Number]};function he(e,o){return N(()=>{const f=Number(e.ratio||(o!==void 0?o.value:void 0));return isNaN(f)!==!0&&f>0?{paddingBottom:`${100/f}%`}:null})}const ge=16/9;var pe=K({name:"QImg",props:{...me,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:ge},placeholderSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(e,{slots:o,emit:f}){const M=y(e.initialRatio),a=he(e,M);let i=null,c=!1;const n=[y(null),y(H())],s=y(0),d=y(!1),p=y(!1),v=N(()=>`q-img q-img--${e.noNativeMenu===!0?"no-":""}menu`),T=N(()=>({width:e.width,height:e.height})),O=N(()=>`q-img__image ${e.imgClass!==void 0?e.imgClass+" ":""}q-img__image--with${e.noTransition===!0?"out":""}-transition`),V=N(()=>({...e.imgStyle,objectFit:e.fit,objectPosition:e.position}));X(()=>U(),G);function U(){return e.src||e.srcset||e.sizes?{src:e.src,srcset:e.srcset,sizes:e.sizes}:null}function H(){return e.placeholderSrc!==void 0?{src:e.placeholderSrc}:null}function G(r){i!==null&&(clearTimeout(i),i=null),p.value=!1,r===null?(d.value=!1,n[s.value^1].value=H()):d.value=!0,n[s.value].value=r}function j({target:r}){c!==!0&&(i!==null&&(clearTimeout(i),i=null),M.value=r.naturalHeight===0?.5:r.naturalWidth/r.naturalHeight,I(r,1))}function I(r,D){c===!0||D===1e3||(r.complete===!0?E(r):i=setTimeout(()=>{i=null,I(r,D+1)},50))}function E(r){c!==!0&&(s.value=s.value^1,n[s.value].value=null,d.value=!1,p.value=!1,f("load",r.currentSrc||r.src))}function W(r){i!==null&&(clearTimeout(i),i=null),d.value=!1,p.value=!0,n[s.value].value=null,n[s.value^1].value=H(),f("error",r)}function x(r){const D=n[r].value,L={key:"img_"+r,class:O.value,style:V.value,crossorigin:e.crossorigin,decoding:e.decoding,referrerpolicy:e.referrerpolicy,height:e.height,width:e.width,loading:e.loading,fetchpriority:e.fetchpriority,"aria-hidden":"true",draggable:e.draggable,...D};return s.value===r?(L.class+=" q-img__image--waiting",Object.assign(L,{onLoad:j,onError:W})):L.class+=" q-img__image--loaded",m("div",{class:"q-img__container absolute-full",key:"img"+r},m("img",L))}function J(){return d.value!==!0?m("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},ee(o[p.value===!0?"error":"default"])):m("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},o.loading!==void 0?o.loading():e.noSpinner===!0?void 0:[m(te,{color:e.spinnerColor,size:e.spinnerSize})])}return G(U()),Y(()=>{c=!0,i!==null&&(clearTimeout(i),i=null)}),()=>{const r=[];return a.value!==null&&r.push(m("div",{key:"filler",style:a.value})),p.value!==!0&&(n[0].value!==null&&r.push(x(0)),n[1].value!==null&&r.push(x(1))),r.push(m(Z,{name:"q-transition--fade"},J)),m("div",{class:v.value,style:T.value,role:"img","aria-label":e.alt},r)}}});const _e={name:"CallMenu",data(){return{calls:[],currentCall:null,currentUser:this.$authStore.currentUser}},computed:{otherCalls(){return this.currentCall?this.calls.filter(e=>e.id!=this.currentCall.id):[]},menuItems(){return this.$userHasAnyGroups(["applicant"])?[{name:"My Proposals",icon:"note",route:"/applicant/proposals"},{name:"Profile",icon:"person",route:"/account/profile"}]:this.$userHasAnyGroups(["reviewer"])?[{name:"Reviews",icon:"note",route:"/proposal-reviews"},{name:"Profile",icon:"person",route:"/account/profile"}]:this.$userHasAnyGroups(["grants_officer"])?[{name:"All Proposals",icon:"note",route:"/proposals"},{name:"Profile",icon:"person",route:"/account/profile"}]:[]}},created(){B().then(e=>{if(this.calls=e,this.calls.length){var o=this.calls[0];this.setCurrentCall(this.$dataStore.currentCall||o)}else this.setCurrentCall({title:"No Call Found"})})},methods:{navigateTo(e){this.$router.push(e)},changeCurrentCall(e){this.setCurrentCall(e),window.location="/"},setCurrentCall(e){this.currentCall=e,this.$dataStore.setCall(this.currentCall)}}},Ce={key:0},ve={key:0};function ye(e,o,f,M,a,i){const c=_("router-link");return a.currentUser&&e.$userHasAnyGroups(["grants_officer"])?(u(),h("div",Ce,[a.calls.length?(u(),h("div",ve,[t(P,null,{default:l(()=>[(u(!0),h(z,null,F(a.calls,n=>{var s;return S((u(),g($,{key:n.id,active:n.id==((s=a.currentCall)==null?void 0:s.id),"active-class":"bg-primary text-white",clickable:"",onClick:d=>i.changeCurrentCall(n)},{default:l(()=>[t(b,null,{default:l(()=>[t(k,null,{default:l(()=>[C(q(n.title),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["active","onClick"])),[[Q]])}),128))]),_:1}),t(R,{spaced:""})])):w("",!0),t(P,null,{default:l(()=>[t(c,{to:"/calls"},{default:l(()=>[S((u(),g($,{clickable:""},{default:l(()=>[t(b,null,{default:l(()=>[t(k,null,{default:l(()=>[C(" See all calls ...")]),_:1})]),_:1})]),_:1})),[[Q]])]),_:1}),t(c,{to:"/calls/create"},{default:l(()=>[S((u(),g($,{clickable:""},{default:l(()=>[t(b,null,{default:l(()=>[t(k,null,{default:l(()=>[C(" Create New Call ")]),_:1})]),_:1})]),_:1})),[[Q]])]),_:1})]),_:1})])):w("",!0)}var Se=A(_e,[["render",ye]]);const we={name:"CallMenu",data(){return{calls:[],currentCall:null,currentUser:this.$authStore.currentUser}},computed:{otherCalls(){return this.currentCall?this.calls.filter(e=>e.id!=this.currentCall.id):[]},menuItems(){return this.$userHasAnyGroups(["applicant"])?[{name:"My Proposals",icon:"note",route:"/applicant/proposals"},{name:"Profile",icon:"person",route:"/account/profile"}]:this.$userHasAnyGroups(["reviewer"])?[{name:"Reviews",icon:"note",route:"/proposal-reviews"},{name:"Profile",icon:"person",route:"/account/profile"}]:this.$userHasAnyGroups(["grants_officer"])?[{name:"All Proposals",icon:"note",route:"/proposals"},{name:"Profile",icon:"person",route:"/account/profile"}]:[]}},created(){B().then(e=>{if(this.calls=e,this.calls.length){var o=this.calls[0];this.setCurrentCall(this.$dataStore.currentCall||o)}else this.setCurrentCall({title:"No Call Found"})})},methods:{navigateTo(e){this.$router.push(e)},changeCurrentCall(e){this.setCurrentCall(e),window.location="/"},setCurrentCall(e){this.currentCall=e,this.$dataStore.setCall(this.currentCall)}}},ke={key:0},$e={key:0},be={key:0},Qe={key:1};function Me(e,o,f,M,a,i){const c=_("router-link");return a.currentCall?(u(),h("span",ke,[a.currentUser&&e.$userHasAnyGroups(["grants_officer"])?(u(),g(fe,{key:0,split:"",color:"white",flat:"","no-caps":"",icon:"folder",label:a.currentCall.title,onClick:o[0]||(o[0]=n=>this.$router.push(`/calls/${a.currentCall.id}`))},{default:l(()=>[e.$userHasAnyGroups(["grants_officer"])?(u(),h("div",$e,[a.calls.length?(u(),h("div",be,[t(P,null,{default:l(()=>[(u(!0),h(z,null,F(a.calls,n=>{var s;return S((u(),g($,{key:n.id,active:n.id==((s=a.currentCall)==null?void 0:s.id),"active-class":"bg-primary text-white",clickable:"",onClick:d=>i.changeCurrentCall(n)},{default:l(()=>[t(b,null,{default:l(()=>[t(k,null,{default:l(()=>[C(q(n.title),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["active","onClick"])),[[Q]])}),128))]),_:1}),t(R,{spaced:""})])):w("",!0),t(P,null,{default:l(()=>[t(c,{to:"/calls"},{default:l(()=>[S((u(),g($,{clickable:""},{default:l(()=>[t(b,null,{default:l(()=>[t(k,null,{default:l(()=>[C(" See all calls ...")]),_:1})]),_:1})]),_:1})),[[Q]])]),_:1}),t(c,{to:"/calls/create"},{default:l(()=>[S((u(),g($,{clickable:""},{default:l(()=>[t(b,null,{default:l(()=>[t(k,null,{default:l(()=>[C(" Create New Call ")]),_:1})]),_:1})]),_:1})),[[Q]])]),_:1})]),_:1})])):w("",!0)]),_:1},8,["label"])):(u(),h("span",Qe," > "+q(a.currentCall.title),1))])):w("",!0)}var Ne=A(we,[["render",Me]]);const Te={name:"MainLayout",components:{CallMenu:Se,DropdownCallMenu:Ne},data(){return{leftDrawerOpen:!1,calls:[],currentCall:null}},computed:{otherCalls(){return this.currentCall?this.calls.filter(e=>e.id!=this.currentCall.id):[]}},created(){this.$authStore.currentUser||(location.href="/index/account/signin"),this.getCalls()},methods:{toggleLeftDrawer(){this.leftDrawerOpen=!this.leftDrawerOpen},getCalls(){B().then(e=>{if(this.calls=e,this.calls.length){var o=this.calls[0];this.setCurrentCall(this.$dataStore.currentCall||o)}else this.setCurrentCall({title:"No Call Found"}),this.$router.push("/no-call-found")})},changeCurrentCall(e){this.setCurrentCall(e),window.location.reload()},setCurrentCall(e){this.currentCall=e,this.$dataStore.setCall(this.currentCall)},logout(){this.$utilsStore.setLoading(!0),this.$api.get("/accounts/logout/").then(e=>{this.$authStore.clearUserAndToken(),this.$router.push("/login"),this.$utilsStore.setLoading(!1)})}}},De={class:"text-orange-3 q-px-xs"};function Le(e,o,f,M,a,i){const c=_("loading-component"),n=_("DropdownCallMenu"),s=_("router-link"),d=_("CallMenu"),p=_("router-view");return a.currentCall?(u(),g(se,{key:0,view:"hHh Lpr lFf"},{default:l(()=>[t(c),t(ue,{elevated:""},{default:l(()=>[t(ie,null,{default:l(()=>[t(le,{flat:"",dense:"",round:"",icon:"menu","aria-label":"Menu",onClick:i.toggleLeftDrawer},null,8,["onClick"]),t(ne,null,{default:l(()=>[C(" Muni RIF "),t(n)]),_:1}),re("div",De,[t(s,{to:"/account/profile"},{default:l(()=>{var v,T;return[t(ae,{class:"glossy",icon:"person",label:`${(v=e.$authStore.currentUser)==null?void 0:v.first_name} ${(T=e.$authStore.currentUser)==null?void 0:T.last_name}`},null,8,["label"])]}),_:1})])]),_:1})]),_:1}),t(ce,{modelValue:a.leftDrawerOpen,"onUpdate:modelValue":o[0]||(o[0]=v=>a.leftDrawerOpen=v),class:"bg-grey-2",bordered:"",width:220},{default:l(()=>[t(pe,{src:de,"spinner-color":"primary","spinner-size":"72px"}),t(d)]),_:1},8,["modelValue"]),t(oe,null,{default:l(()=>[t(p)]),_:1})]),_:1})):w("",!0)}var ot=A(Te,[["render",Le]]);export{ot as default};
