import{s as v,C as H,m as g,D as P,u as j,z as c,a7 as A,O as G,q as W,_ as J,r as y,o as $,e as k,w as a,f as l,l as K,h as S,i as w,Q as D,t as X,g as N,n as Y}from"./index.e39be684.js";import{Q as Z}from"./QToolbarTitle.bd27c268.js";import{Q as x,a as b}from"./QItem.c0795fab.js";import{Q as z}from"./QItemLabel.aff81a70.js";import{Q as ee}from"./QList.521c8a93.js";import{Q as te}from"./QBtnDropdown.85fcf977.js";import{Q as le,a as ie,b as ae}from"./QLayout.debc0d67.js";import{Q as ne}from"./QHeader.4b49045c.js";import{Q as re}from"./QDrawer.499a1943.js";import{C as B}from"./ClosePopup.3f3723a2.js";import{a as oe}from"./api.f52607fc.js";import{D as se,u as ue}from"./UserMenu.53b7eed2.js";import"./use-dark.54601180.js";import"./QBtnGroup.223e6e8a.js";import"./QMenu.fcff140d.js";import"./use-timeout.65a9f0b9.js";import"./focus-manager.b507780d.js";import"./use-transition.c0c5474a.js";import"./scroll.eaa460d0.js";import"./uid.42677368.js";import"./use-prevent-scroll.92142e4c.js";import"./TouchPan.6abfb632.js";import"./touch.3df10340.js";import"./format.2bc25e5f.js";import"./axios.c31a4c00.js";import"./QChip.19e4d28f.js";import"./QSeparator.13d6beeb.js";const ce={ratio:[String,Number]};function de(e,n){return v(()=>{const u=Number(e.ratio||(n!==void 0?n.value:void 0));return isNaN(u)!==!0&&u>0?{paddingBottom:`${100/u}%`}:null})}const fe=16/9;var me=H({name:"QImg",props:{...ce,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:fe},placeholderSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(e,{slots:n,emit:u}){const h=g(e.initialRatio),f=de(e,h);let i=null,m=!1;const r=[g(null),g(Q())],o=g(0),d=g(!1),s=g(!1),_=v(()=>`q-img q-img--${e.noNativeMenu===!0?"no-":""}menu`),I=v(()=>({width:e.width,height:e.height})),U=v(()=>`q-img__image ${e.imgClass!==void 0?e.imgClass+" ":""}q-img__image--with${e.noTransition===!0?"out":""}-transition`),O=v(()=>({...e.imgStyle,objectFit:e.fit,objectPosition:e.position}));P(()=>q(),L);function q(){return e.src||e.srcset||e.sizes?{src:e.src,srcset:e.srcset,sizes:e.sizes}:null}function Q(){return e.placeholderSrc!==void 0?{src:e.placeholderSrc}:null}function L(t){i!==null&&(clearTimeout(i),i=null),s.value=!1,t===null?(d.value=!1,r[o.value^1].value=Q()):d.value=!0,r[o.value].value=t}function R({target:t}){m!==!0&&(i!==null&&(clearTimeout(i),i=null),h.value=t.naturalHeight===0?.5:t.naturalWidth/t.naturalHeight,M(t,1))}function M(t,p){m===!0||p===1e3||(t.complete===!0?V(t):i=setTimeout(()=>{i=null,M(t,p+1)},50))}function V(t){m!==!0&&(o.value=o.value^1,r[o.value].value=null,d.value=!1,s.value=!1,u("load",t.currentSrc||t.src))}function E(t){i!==null&&(clearTimeout(i),i=null),d.value=!1,s.value=!0,r[o.value].value=null,r[o.value^1].value=Q(),u("error",t)}function T(t){const p=r[t].value,C={key:"img_"+t,class:U.value,style:O.value,crossorigin:e.crossorigin,decoding:e.decoding,referrerpolicy:e.referrerpolicy,height:e.height,width:e.width,loading:e.loading,fetchpriority:e.fetchpriority,"aria-hidden":"true",draggable:e.draggable,...p};return o.value===t?(C.class+=" q-img__image--waiting",Object.assign(C,{onLoad:R,onError:E})):C.class+=" q-img__image--loaded",c("div",{class:"q-img__container absolute-full",key:"img"+t},c("img",C))}function F(){return d.value!==!0?c("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},G(n[s.value===!0?"error":"default"])):c("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},n.loading!==void 0?n.loading():e.noSpinner===!0?void 0:[c(W,{color:e.spinnerColor,size:e.spinnerSize})])}return L(q()),j(()=>{m=!0,i!==null&&(clearTimeout(i),i=null)}),()=>{const t=[];return f.value!==null&&t.push(c("div",{key:"filler",style:f.value})),s.value!==!0&&(r[0].value!==null&&t.push(T(0)),r[1].value!==null&&t.push(T(1))),t.push(c(A,{name:"q-transition--fade"},F)),c("div",{class:_.value,style:I.value,role:"img","aria-label":e.alt},t)}}}),ge="/assets/logo.fac08a4e.png";const he={name:"MainLayout",components:{DropdownCallMenu:se,UserMenu:ue},data(){return{leftDrawerOpen:!0,calls:[],currentCall:null}},computed:{otherCalls(){return this.currentCall?this.calls.filter(e=>e.id!=this.currentCall.id):[]},activeCall(){return this.calls.find(e=>e.id==this.entity.current_call)}},created(){this.$authStore.currentUser||(location.href="/index/account/signin"),this.getEntity(),this.$bus.on("set-active-call",e=>{this.getEntity()})},methods:{toggleLeftDrawer(){this.leftDrawerOpen=!this.leftDrawerOpen},async getEntity(){const e=await this.$api.get("entities/");this.entity=e.data[0],this.$dataStore.setEntity(this.entity),this.getCalls()},getCalls(){oe().then(e=>{if(this.calls=e,this.calls.length)if(this.$userHasAnyGroups(["applicant","reviewer"])){var n=this.calls.find(h=>h.id==this.entity.current_call);n?this.setCurrentCall(n||{title:"No Call Found"}):this.$router.push("/no-call-found")}else{var u=this.calls[0];this.setCurrentCall(this.$dataStore.currentCall||u)}else this.setCurrentCall({title:"No Call Found"}),this.$userHasAnyGroups(["grants_officer"])?this.$router.push("/calls"):this.$router.push("/no-call-found")})},changeCurrentCall(e){this.setCurrentCall(e),window.location.reload()},setCurrentCall(e){this.currentCall=e,this.$dataStore.setCall(this.currentCall)},logout(){this.$utilsStore.setLoading(!0),this.$api.get("/accounts/logout/").then(e=>{this.$router.push("/index/account/signin"),this.$authStore.clearUserAndToken(),this.$utilsStore.setLoading(!1)})}}},ve={class:"text-orange-3 q-px-xs"},_e={class:"q-pa-sm",align:"center"},pe={align:"center"};function Ce(e,n,u,h,f,i){const m=y("loading-component"),r=y("DropdownCallMenu"),o=y("UserMenu"),d=y("router-view");return f.currentCall?($(),k(ae,{key:0,view:"hHh Lpr lFf"},{default:a(()=>[l(m),l(ne,{elevated:""},{default:a(()=>[l(le,null,{default:a(()=>{var s,_;return[l(K,{flat:"",dense:"",round:"",icon:"menu","aria-label":"Menu",onClick:i.toggleLeftDrawer},null,8,["onClick"]),l(Z,null,{default:a(()=>[S(" Muni RIF "),w("span",null,[l(D,{name:"arrow_right",size:"md"}),S(" "+X(i.activeCall.title),1)])]),_:1}),w("div",ve,[l(te,{split:"",color:"grey-2","text-color":"black",rounded:"",icon:"person",to:"/account/profile",label:`${(s=e.$authStore.currentUser)==null?void 0:s.first_name} ${(_=e.$authStore.currentUser)==null?void 0:_.last_name}`},{default:a(()=>[l(ee,null,{default:a(()=>[N(($(),k(x,{clickable:"",to:"/account/profile"},{default:a(()=>[l(b,{side:""},{default:a(()=>[l(D,{name:"person"})]),_:1}),l(b,null,{default:a(()=>[l(z,null,{default:a(()=>[S("Profile")]),_:1})]),_:1})]),_:1})),[[B]]),N(($(),k(x,{clickable:"",onClick:i.logout},{default:a(()=>[l(b,{side:""},{default:a(()=>[l(D,{name:"logout"})]),_:1}),l(b,null,{default:a(()=>[l(z,null,{default:a(()=>[S("Logout")]),_:1})]),_:1})]),_:1},8,["onClick"])),[[B]])]),_:1})]),_:1},8,["label"])])]}),_:1})]),_:1}),l(re,{modelValue:f.leftDrawerOpen,"onUpdate:modelValue":n[0]||(n[0]=s=>f.leftDrawerOpen=s),class:"bg-grey-2",bordered:"",width:300},{default:a(()=>[w("div",_e,[l(r)]),w("div",pe,[l(me,{src:ge,"spinner-color":"primary","spinner-size":"72px",width:"100px"})]),l(o)]),_:1},8,["modelValue"]),l(ie,null,{default:a(()=>[l(d)]),_:1})]),_:1})):Y("",!0)}var Ge=J(he,[["render",Ce]]);export{Ge as default};
